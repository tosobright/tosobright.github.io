<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>191101-python-opc-lv</title>
    <url>/2019/11/02/191101-python-opc-lv/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>OPC（Object Linking and Embedding（OLE） for Process Control）是基于微软的 DCOM 的通信，用于过程控制和制造业自动化系统。</p>
<ul>
<li>OPC DA（Data Access 协议，是最基本的 OPC 协议）</li>
<li>OPC HDA（Historical Data Access 协议，有数据库）</li>
<li>OPC UA（OPC UA: Unified Architecture 统一架构协议）</li>
</ul>
<h1 id="NI"><a href="#NI" class="headerlink" title="NI"></a>NI</h1><p>NI LabVIEW 内的网络变量部署后，会在“NI 分布式系统管理器”中出现，这是基于 OPC 通信的，可以使用 OPC 读取与写入。</p>
<p><img src="https://note.youdao.com/yws/public/resource/f6cfd1f15d4b8136a208b63d64543feb/xmlnote/B7E9F01E2BFA4934851D33D4C93FCEF9/5691" alt="image"></p>
<h1 id="Python（OpenOPC）"><a href="#Python（OpenOPC）" class="headerlink" title="Python（OpenOPC）"></a>Python（OpenOPC）</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> OpenOPC</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">gateway=<span class="string">'127.0.0.1'</span></span><br><span class="line">opchost=<span class="string">'127.0.0.1'</span></span><br><span class="line">opcserv=<span class="string">'National Instruments.Variable Engine.1'</span></span><br><span class="line">taglist=[<span class="string">'test.Variable1'</span>]</span><br><span class="line"><span class="comment">#taglist=['12.OPC1.Simulation Examples.Functions.Sine1',</span></span><br><span class="line"><span class="comment">#'12.OPC1.Simulation Examples.Functions.Sine2']</span></span><br><span class="line">opc=OpenOPC.open_client(gateway)</span><br><span class="line">opc.connect(opcserv,opchost)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    v=opc.read(taglist)</span><br><span class="line">    <span class="keyword">print</span> v[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> v[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'-------------------------------------------------------'</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opc.close()</span><br></pre></td></tr></table></figure>

<h1 id="测试本地"><a href="#测试本地" class="headerlink" title="测试本地"></a>测试本地</h1><ul>
<li>无需 OpenOPC 网关服务</li>
<li>Python2.7 OpenOPC</li>
</ul>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import OpenOPC</span><br><span class="line">&gt;&gt;&gt; opc = OpenOPC.client()</span><br><span class="line">&gt;&gt;&gt; opc.connect('National Instruments.Variable Engine.<span class="number">1</span>')</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span> opc.read('test.var')</span><br><span class="line">(<span class="number">3</span>.<span class="number">0</span>, 'Good', '<span class="number">10</span>/<span class="number">31</span>/<span class="number">19</span> <span class="number">00</span>:<span class="number">53</span>:<span class="number">20</span>')</span><br></pre></td></tr></table></figure>

<h1 id="测试远程"><a href="#测试远程" class="headerlink" title="测试远程"></a>测试远程</h1><ul>
<li><p>OPC 客户端</p>
<ol>
<li>win10 系统</li>
<li>Python2.7 OpenOPC</li>
</ol>
</li>
<li><p>OPC 服务端</p>
<ol>
<li>winxp</li>
<li>安装 OpenOPC 网关服务<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">OpenOPC</span>\<span class="title">bin</span>&gt; <span class="title">OpenOPCService.exe</span> -<span class="title">install</span></span></span><br><span class="line"><span class="function"><span class="title">Installing</span> <span class="title">service</span> <span class="title">OpenOpcService</span></span></span><br><span class="line"><span class="function"><span class="title">Service</span> <span class="title">installed</span></span></span><br><span class="line"><span class="function"><span class="title">Starting</span> <span class="title">the</span> <span class="title">service</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">OpenOPC</span>\<span class="title">bin</span>&gt; <span class="title">net</span> <span class="title">start</span> <span class="title">zzzOpenOpcService</span></span></span><br><span class="line"><span class="function"><span class="title">Stopping</span> <span class="title">the</span> <span class="title">service</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">OpenOPC</span>\<span class="title">bin</span>&gt; <span class="title">net</span> <span class="title">stop</span> <span class="title">zzzOpenOpcService</span></span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>测试代码</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">Python <span class="number">2</span>.<span class="number">7</span>.<span class="number">17</span> (v2.<span class="number">7</span>.<span class="number">17</span>:c2f86d86e6, Oct <span class="number">19</span> <span class="number">2019</span>, <span class="number">20</span>:<span class="number">49</span>:<span class="number">36</span>) [MSC v.<span class="number">1500</span> <span class="number">32</span> bit (Intel)] on win32</span><br><span class="line"><span class="built_in">Type</span> "<span class="built_in">help</span>", "copyright", "credits" or "license" <span class="keyword">for</span> <span class="built_in">more</span> information.</span><br><span class="line">&gt;&gt;&gt; import OpenOPC</span><br><span class="line">&gt;&gt;&gt; opc = OpenOPC.open_client('<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">220</span>')</span><br><span class="line">&gt;&gt;&gt; opc</span><br><span class="line">&lt;DynamicProxy <span class="keyword">for</span> PYRO://<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">220</span>:<span class="number">7766</span>/c0a802dc076c1cbada8377276cdfc7f0&gt;</span><br><span class="line">&gt;&gt;&gt; opc.connect('National Instruments.Variable Engine.<span class="number">1</span>','<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">220</span>')</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span> opc.read('test.var')</span><br><span class="line">(<span class="number">3</span>.<span class="number">0</span>, 'Good', '<span class="number">10</span>/<span class="number">31</span>/<span class="number">19</span> <span class="number">00</span>:<span class="number">53</span>:<span class="number">20</span>')</span><br><span class="line">&gt;&gt;&gt; opc.write(('test.var2',<span class="number">5</span>.<span class="number">0</span>))</span><br><span class="line">'Success'</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span> opc.read('test.var2')</span><br><span class="line">(<span class="number">5</span>.<span class="number">0</span>, 'Good', '<span class="number">10</span>/<span class="number">31</span>/<span class="number">19</span> <span class="number">00</span>:<span class="number">54</span>:<span class="number">44</span>')</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h1><ol>
<li>使用 OpenOPC 安装包，安装网关服务</li>
<li>网卡顺序会导致返回 IP 错误（print OpenOPC.open_client(gateway)）修改网卡的跃点数来修改次序</li>
<li>防火墙关闭或者将 7766 端口加入防火墙设置（OpenOPC）</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
        <tag>python</tag>
        <tag>opc</tag>
      </tags>
  </entry>
  <entry>
    <title>PyQT使用多语言</title>
    <url>/2019/10/21/191021-pyqt-QTranslator/</url>
    <content><![CDATA[<h1 id="源代码处理"><a href="#源代码处理" class="headerlink" title="源代码处理"></a>源代码处理</h1><p>在代码中需要转换处加入 self.tr（）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.ui.txt_CMD.setPlainText(self.tr(<span class="string">u'CommandLog'</span>))</span><br></pre></td></tr></table></figure>

<h1 id="生成-ts-文件"><a href="#生成-ts-文件" class="headerlink" title="生成 ts 文件"></a>生成 ts 文件</h1><p>将 py 文件转换为 ts 文件</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> "**\_\_\_**python build translate**\_\_\_**"</span><br><span class="line"><span class="built_in">cd</span> src\app</span><br><span class="line">"D:\Python2\Lib\site-packages\PyQt4\pylupdate4.exe" windows_main.py -ts ..\Lang\zh_CN.ts</span><br><span class="line">"D:\Python2\Lib\site-packages\PyQt4\pylupdate4.exe" layout\ui_layout_main.py -ts ..\Lang\zh_CN.ts</span><br><span class="line">"D:\Python2\Lib\site-packages\PyQt4\pylupdate4.exe" layout\ui_layout_product.py -ts ..\Lang\zh_CN.ts</span><br><span class="line">"D:\Python2\Lib\site-packages\PyQt4\pylupdate4.exe" layout\ui_layout_comm.py -ts ..\Lang\zh_CN.ts</span><br></pre></td></tr></table></figure>

<h1 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h1><p>使用 linguist.exe 编辑翻译</p>
<h1 id="生成翻译文件"><a href="#生成翻译文件" class="headerlink" title="生成翻译文件"></a>生成翻译文件</h1><p>发布为 qm 文件<br>或者使用指令转换</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> "**\_\_\_**python build translate**\_\_\_**"</span><br><span class="line"><span class="built_in">cd</span> src\app</span><br><span class="line">"D:\Python2\Lib\site-packages\PyQt4\lrelease.exe" ..\Lang\zh_CN.ts</span><br></pre></td></tr></table></figure>

<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><p>在主程序中加载</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 加载翻译</span></span><br><span class="line">trans = QtCore.QTranslator()</span><br><span class="line"><span class="keyword">print</span> trans.load(</span><br><span class="line"><span class="string">"F:\\Python\\PythonStudy\\ScopeModbus\\src\\Lang\\zh_CN.qm"</span>)</span><br><span class="line">QtApp.installTranslator(trans)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>qt</tag>
      </tags>
  </entry>
  <entry>
    <title>Git命令学习191016</title>
    <url>/2019/10/16/191016-git/</url>
    <content><![CDATA[<h1 id="Git-基本常用命令如下"><a href="#Git-基本常用命令如下" class="headerlink" title="Git 基本常用命令如下"></a>Git 基本常用命令如下</h1><ul>
<li>mkdir： XX (创建一个空目录 XX 指目录名)</li>
<li>pwd： 显示当前目录的路径。</li>
<li>git init 把当前的目录变成可以管理的 git 仓库，生成隐藏.git 文件。</li>
<li>git add XX 把 xx 文件添加到暂存区去。</li>
<li>git commit –m “XX” 提交文件 –m 后面的是注释。</li>
<li>git status 查看仓库状态</li>
<li>git diff XX 查看 XX 文件修改了那些内容</li>
<li>git log 查看历史记录</li>
<li>git reset –hard HEAD^ 或者 git reset –hard HEAD~ 回退到上一个版本</li>
<li>(如果想回退到 100 个版本，使用 git reset –hard HEAD~100 )</li>
<li>cat XX 查看 XX 文件内容</li>
<li>git reflog 查看历史记录的版本号 id</li>
<li>git checkout – XX 把 XX 文件在工作区的修改全部撤销。</li>
<li>git rm XX 删除 XX 文件</li>
<li>git remote add origin <a href="https://github.com/tosobright/test.git" target="_blank" rel="noopener">https://github.com/tosobright/test.git</a> 关联一个远程库</li>
<li>git push –u(第一次要用-u 以后不需要) origin master 把当前 master 分支推送到远程库</li>
<li>git clone <a href="https://github.com/tosobright/test.git" target="_blank" rel="noopener">https://github.com/tosobright/test.git</a> 从远程库中克隆</li>
<li>git checkout –b dev 创建 dev 分支 并切换到 dev 分支上</li>
<li>git branch 查看当前所有的分支</li>
<li>git checkout master 切换回 master 分支</li>
<li>git merge dev 在当前的分支上合并 dev 分支</li>
<li>git branch –d dev 删除 dev 分支</li>
<li>git branch name 创建分支</li>
<li>git stash 把当前的工作隐藏起来 等以后恢复现场后继续工作</li>
<li>git stash list 查看所有被隐藏的文件列表</li>
<li>git stash apply 恢复被隐藏的文件，但是内容不删除</li>
<li>git stash drop 删除文件</li>
<li>git stash pop 恢复文件的同时 也删除文件</li>
<li>git remote 查看远程库的信息</li>
<li>git remote –v 查看远程库的详细信息</li>
<li>git push origin master Git 会把 master 分支推送到远程库对应的远程分支上</li>
</ul>
<h1 id="git-初始化流程"><a href="#git-初始化流程" class="headerlink" title="git 初始化流程"></a>git 初始化流程</h1><ul>
<li>添加全局</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config –global user.name &quot;tosobright&quot;</span><br><span class="line">git config –global user.email &quot;tosobright@gmail.com&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加密钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;tosobright@gmail.com&quot;</span><br><span class="line"></span><br><span class="line">密钥在用户名下的&quot;.ssh&quot;文件夹下的&quot;id_rsa.pub&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>验证密钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line"></span><br><span class="line">Hi tosobright! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>

<h1 id="git-操作流程"><a href="#git-操作流程" class="headerlink" title="git 操作流程"></a>git 操作流程</h1><ul>
<li>新建本地仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;first&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加远程仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote add origin https://github.com/tosobright/blog.git</span><br></pre></td></tr></table></figure>

<ul>
<li>推送到远程仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">本地的master分支推送到origin主机，同时指定origin为默认主机</span><br><span class="line">后面就可以不加任何参数使用git push了，-u 参数指定一个默认主机</span><br><span class="line"></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<ul>
<li>拉取远程仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git fetch [remote-name] (获取仓库所有更新，但不自动合并当前分支)</span><br><span class="line">git pull (获取仓库所有更新，并自动合并到当前分支)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用硬盘或 U 盘作为远程仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">建立一个裸仓库</span><br><span class="line">git clone --bare (仓库文件夹名)  (文件夹名.git)</span><br><span class="line">添加远程仓库</span><br><span class="line">git remote add local /e/repository/文件夹名.git</span><br><span class="line">git push --set-upstream local master</span><br></pre></td></tr></table></figure>

<ul>
<li>克隆仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/tosobright/blog.git</span><br><span class="line"></span><br><span class="line">git clone /e/repository/文件夹名.git</span><br></pre></td></tr></table></figure>

<ul>
<li>版本提交记录查看</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>

<ul>
<li>不可逆提交还原</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git reset --hard (commitID)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Python+QT开发的Modbus采集软件</title>
    <url>/2019/10/15/191015-python-scopemodbus/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>ScopeModbus 是基于 Python2.7 和 PyQT4 开发的 modbus 通信采集软件，已在 windows、deepin linux 和树莓派上测试！</p>
<p>目前已开源</p>
<ul>
<li><a href="https://github.com/tosobright/ScopeModbus" target="_blank" rel="noopener">Github</a></li>
<li><a href="https://gitee.com/tosobright/ScopeModbus" target="_blank" rel="noopener">Gitee</a></li>
</ul>
<h1 id="PyQT-UI-开发"><a href="#PyQT-UI-开发" class="headerlink" title="PyQT UI 开发"></a>PyQT UI 开发</h1><ul>
<li><p>QT 设计师</p>
<p>使用 QT 设计师设计 layout，再使用 pyuic 进行转换</p>
<ul>
<li><p>python 转换代码”~QT_UI_Conv.py”</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="string">'.'</span>):</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">'.ui'</span>):</span><br><span class="line">            os.system(<span class="string">"D:\Python\Python27\python.exe"</span> <span class="string">' "D:\Python\Python27\Lib\site-packages\PyQt4\uic\pyuic.py" -o ui_%s.py %s'</span> %</span><br><span class="line">                      (file.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">0</span>], file))</span><br><span class="line">            <span class="comment"># print "D:\Python\Python27\python.exe" ' "D:\Python\Python27\Lib\site-packages\PyQt4\uic\pyuic.py" -o ui_%s.py %s' % (</span></span><br><span class="line">            <span class="comment">#    file.rsplit('.', 1)[0], file)</span></span><br><span class="line">        <span class="keyword">elif</span> file.endswith(<span class="string">'.qrc'</span>):</span><br><span class="line">            os.system(<span class="string">'"D:\Python\Python27\Lib\site-packages\PyQt4\pyrcc4.exe" -o %s_rc.py %s'</span> %</span><br><span class="line">                      (file.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">0</span>], file))</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用批处理命令处理 ui 文件夹下的所有 layout 文件,并将生成的文件复制到源代码中的 layout，生成的文件统一命名为 <code>ui_layout_(*).py</code></p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> "_______python build_______"</span><br><span class="line"><span class="built_in">cd</span> ui</span><br><span class="line"><span class="built_in">echo</span> "UI build..."</span><br><span class="line">"D:\Python\Python27\python.exe" ~QT_UI_Conv.py</span><br><span class="line"><span class="built_in">echo</span> "<span class="built_in">Copy</span> image resouce..."</span><br><span class="line"><span class="built_in">copy</span> pyimg_rc.py ..\src\app\layout\pyimg_rc.py</span><br><span class="line"><span class="built_in">echo</span> "<span class="built_in">Copy</span> ui resouce..."</span><br><span class="line"><span class="built_in">copy</span> ui*.py ..\src\app\layout</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>UI 调用</p>
<p>在主程序体中，调用生成的 class</p>
<p>导入即可<code>from layout.ui_layout_main import Ui_MainWindow</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWindow</span><span class="params">(QtGui.QMainWindow)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MyWindow, self).__init__()</span><br><span class="line">        <span class="comment"># 这里需要注意self.ui已经将Ui_MainWindow类实例</span></span><br><span class="line">        <span class="comment"># 化，因此继承了该类的所有属性，后面更改设置属性都用self.ui“冠名”</span></span><br><span class="line">        <span class="comment"># 主UI</span></span><br><span class="line">        self.ui = Ui_MainWindow()</span><br><span class="line">        self.ui.setupUi(self)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><p>采集程序既要采集数据，也要显示数据，需使用到多线程</p>
<ul>
<li><p>采集线程</p>
<p>采集线程与主线程通信，进行数据交互</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 采集线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AcqThread</span><span class="params">(QtCore.QThread)</span>:</span></span><br><span class="line">    signal_acqdata = QtCore.pyqtSignal(str, list)  <span class="comment"># 信号</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></span><br><span class="line">        super(AcqThread, self).__init__(parent)</span><br><span class="line">        self.bol_working = <span class="literal">True</span></span><br><span class="line">        self.bol_emit = <span class="literal">False</span></span><br><span class="line">        self.int_cyc = <span class="number">1</span>  <span class="comment"># 单位为s</span></span><br><span class="line">        self.num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> self.bol_working:</span><br><span class="line">            <span class="comment"># print "Working", self.thread()</span></span><br><span class="line">            <span class="keyword">if</span> self.bol_emit:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.cmdtxt.setUpdatesEnabled(<span class="literal">False</span>)</span><br><span class="line">                    v = []</span><br><span class="line">                    <span class="keyword">for</span> item <span class="keyword">in</span> self.productpar:</span><br><span class="line">                        func = item[<span class="string">'func'</span>]</span><br><span class="line">                        startaddr = item[<span class="string">'startaddr'</span>]</span><br><span class="line">                        length = item[<span class="string">'length'</span>]</span><br><span class="line">                        d = self.mb.read(func, startaddr, length)</span><br><span class="line">                        <span class="comment">#print func,startaddr,length,d</span></span><br><span class="line">                        <span class="keyword">if</span> item[<span class="string">'type'</span>] == <span class="string">'int'</span>:</span><br><span class="line">                            dv = mbf.ReadInt(d)</span><br><span class="line">                        <span class="keyword">elif</span> item[<span class="string">'type'</span>] == <span class="string">'float'</span>:</span><br><span class="line">                            dv = mbf.ReadFloat(d)</span><br><span class="line">                        <span class="keyword">elif</span> item[<span class="string">'type'</span>] == <span class="string">'list'</span>:</span><br><span class="line">                            dv = mbf.ReadInt(d)</span><br><span class="line">                        <span class="keyword">elif</span> item[<span class="string">'type'</span>] == <span class="string">'bool'</span>:</span><br><span class="line">                            <span class="keyword">if</span> mbf.ReadInt(d) == <span class="number">1</span>:</span><br><span class="line">                                dv = <span class="literal">True</span></span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                dv = <span class="literal">False</span></span><br><span class="line">                        v.append(dv)</span><br><span class="line">                    <span class="comment">#print v</span></span><br><span class="line">                    self.cmdtxt.setUpdatesEnabled(<span class="literal">True</span>)</span><br><span class="line">                    self.num += <span class="number">1</span></span><br><span class="line">                    self.signal_acqdata.emit(</span><br><span class="line">                        <span class="string">"Running:"</span>+str(self.num), v)  <span class="comment"># 发送信号</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    self.cmdtxt.setUpdatesEnabled(<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            self.sleep(self.int_cyc)</span><br></pre></td></tr></table></figure>
</li>
<li><p>时间线程</p>
<p>系统时间显示放入单独的线程内</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 时间线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeThread</span><span class="params">(QtCore.QThread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></span><br><span class="line">        super(TimeThread, self).__init__(parent)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>, time.localtime())</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            self.txt_time.setText(t)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTimeObj</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        self.txt_time = obj</span><br></pre></td></tr></table></figure>
</li>
<li><p>主线程</p>
<p>加载线程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load thread</span></span><br><span class="line"><span class="comment"># 创建新线程</span></span><br><span class="line">self.threadAcq = AcqThread()</span><br><span class="line"><span class="comment"># thread2 = myThread(2, "Thread-2", 2)</span></span><br><span class="line"><span class="comment"># 连接信号</span></span><br><span class="line">self.threadAcq.signal_acqdata.connect(self.Graph_Update)</span><br><span class="line"><span class="comment"># 开启线程</span></span><br><span class="line">self.threadAcq.start()</span><br><span class="line">self.threadAcq.CommandTxt(self.ui.txt_CMD)</span><br><span class="line"></span><br><span class="line">self.threadTime = TimeThread()</span><br><span class="line">self.threadTime.getTimeObj(self.Txt_time)</span><br><span class="line">self.threadTime.start()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Modbus"><a href="#Modbus" class="headerlink" title="Modbus"></a>Modbus</h1><ul>
<li><p>Modbus RTU</p>
<p>这里采用的是 modbus rtu，是修改自<code>modbus_tk</code>这个标准库，只取了里面的 RTU 部分</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @author: Toso</span></span><br><span class="line"><span class="comment"># @created: 2019-05-08T13:40:09.624Z+08:00</span></span><br><span class="line"><span class="comment"># @comment: ______________</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> serial</span><br><span class="line"><span class="keyword">import</span> serial.tools.list_ports</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> MBdefines <span class="keyword">as</span> defines</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> MBFormat</span><br><span class="line"><span class="keyword">from</span> PyQt4 <span class="keyword">import</span> QtCore</span><br><span class="line"></span><br><span class="line">PY2 = sys.version_info[<span class="number">0</span>] == <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MB</span><span class="params">(QtCore.QObject)</span>:</span></span><br><span class="line">    MBrecord = QtCore.pyqtSignal(str)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ComAutoFind</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.comboBox_Port = []</span><br><span class="line">        <span class="comment"># 先获取所以有USB串口挂载的设备</span></span><br><span class="line">        self.scomList = list(serial.tools.list_ports.comports())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(len(self.scomList) &lt;= <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> self.tr(<span class="string">u"No Port Find"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> self.scomList:</span><br><span class="line">                self.comboBox_Port.append(item.device)</span><br><span class="line">        <span class="keyword">return</span> self.comboBox_Port</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">Open</span><span class="params">(self, DevAddr, Port, Baudrate, Parity, Bytesize, Stopbits, Timeout)</span>:</span></span><br><span class="line">          <span class="keyword">try</span>:</span><br><span class="line">              self.slaveAddr = DevAddr</span><br><span class="line">              self.serial = serial.Serial(port=Port,</span><br><span class="line">                                          baudrate=Baudrate,</span><br><span class="line">                                          bytesize=Bytesize,</span><br><span class="line">                                          parity=Parity,</span><br><span class="line">                                          stopbits=Stopbits,</span><br><span class="line">                                          xonxoff=<span class="number">0</span>)</span><br><span class="line">              self.serial.timeout = Timeout</span><br><span class="line">              self.ConnType = <span class="string">'Serial'</span></span><br><span class="line">              <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">          <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">              <span class="keyword">raise</span> err</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">Log</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">          self.MBrecord.emit(msg)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># 3 0 1 (23,)</span></span><br><span class="line">      <span class="comment"># 3 2 2 (34, 63)</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self, Func, Start, Length)</span>:</span></span><br><span class="line">          <span class="keyword">try</span>:</span><br><span class="line">              <span class="keyword">return</span> self.execute(</span><br><span class="line">                  self.slaveAddr, Func, Start, Length)</span><br><span class="line">          <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">              <span class="keyword">raise</span> err</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, Func, Start, val)</span>:</span></span><br><span class="line">          <span class="keyword">try</span>:</span><br><span class="line">              <span class="keyword">return</span> self.execute(self.slaveAddr, Func, Start, output_value=val)</span><br><span class="line">          <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">              <span class="keyword">raise</span> err</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">          <span class="keyword">try</span>:</span><br><span class="line">              self.ConnType</span><br><span class="line">          <span class="keyword">except</span>:</span><br><span class="line">              self.ConnType = <span class="string">''</span></span><br><span class="line">          <span class="keyword">try</span>:</span><br><span class="line">              <span class="keyword">if</span> self.ConnType == <span class="string">'Serial'</span>:</span><br><span class="line">                  self.serial.close()</span><br><span class="line">              <span class="keyword">elif</span> self.ConnType == <span class="string">'TCP'</span>:</span><br><span class="line">                  self.sock.close()</span><br><span class="line">          <span class="keyword">except</span>:</span><br><span class="line">              <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主窗体调用 modbus</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># modbus通信class</span></span><br><span class="line">self.mb = MB()</span><br><span class="line">self.ports = self.mb.ComAutoFind()</span><br><span class="line"><span class="comment"># self.mb.Log(self.ui.txt_CMD)</span></span><br><span class="line">self.mb.MBrecord.connect(self.LogRecord)</span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>qt</tag>
        <tag>modbus</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/10/08/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>Diary</category>
      </categories>
      <tags>
        <tag>Testing</tag>
      </tags>
  </entry>
  <entry>
    <title>python-12306</title>
    <url>/2018/10/10/181010-12306/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>使用 python2.7 开发，登录网站，获取数据，模拟数据，邮箱通知！</p>
<p>用于 python 爬虫学习</p>
<p>涉及相关 python 库</p>
<ul>
<li>PIL</li>
<li>bs4</li>
<li>prettytable</li>
<li>json</li>
<li>re</li>
<li>urllib</li>
<li>urllib2</li>
<li>smtplib</li>
</ul>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><ul>
<li>Python2.7</li>
<li>Fiddler 4</li>
<li>Vs code</li>
</ul>
<h1 id="开源"><a href="#开源" class="headerlink" title="开源"></a>开源</h1><ul>
<li><a href="https://github.com/tosobright/ticket_12306" target="_blank" rel="noopener">Github</a></li>
<li><a href="https://gitee.com/tosobright/ticket_12306" target="_blank" rel="noopener">Gitee</a></li>
</ul>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><ol>
<li><p>浏览器头文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 浏览器headers</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"kyfw.12306.cn"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>: <span class="string">"https://kyfw.12306.cn/otn/passport?redirect=/otn/"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers2 = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"kyfw.12306.cn"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>: <span class="string">"https://kyfw.12306.cn/otn/login/init"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>网站功能地址</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#########登录###########</span></span><br><span class="line">init_url = <span class="string">'https://kyfw.12306.cn/otn/login/init'</span></span><br><span class="line">captcha_url = <span class="string">'https://kyfw.12306.cn/passport/captcha/captcha-image?&#123;&#125;'</span></span><br><span class="line">login_url = <span class="string">'https://kyfw.12306.cn/passport/web/login'</span></span><br><span class="line">check_captcha_url = <span class="string">'https://kyfw.12306.cn/passport/captcha/captcha-check'</span></span><br><span class="line">uamtk_url = <span class="string">'https://kyfw.12306.cn/passport/web/auth/uamtk'</span></span><br><span class="line">auth_url = <span class="string">'https://kyfw.12306.cn/otn/uamauthclient'</span></span><br><span class="line">initmy12306_url = <span class="string">'https://kyfw.12306.cn/otn/index/initMy12306'</span></span><br><span class="line"><span class="comment">#########查票###########</span></span><br><span class="line">left_tickets_sel_init = <span class="string">'https://kyfw.12306.cn/otn/leftTicket/init'</span></span><br><span class="line">left_tickets_url = <span class="string">'https://kyfw.12306.cn/otn/leftTicket/queryZ?'</span></span><br><span class="line"><span class="comment">#########下单###########</span></span><br><span class="line">checkuser_url = <span class="string">'https://kyfw.12306.cn/otn/login/checkUser'</span></span><br><span class="line">submit_order_url = <span class="string">'https://kyfw.12306.cn/otn/leftTicket/submitOrderRequest'</span></span><br><span class="line">confirm_passenger_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/initDc'</span></span><br><span class="line">get_passenger_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/getPassengerDTOs'</span></span><br><span class="line">check_order_info_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/checkOrderInfo'</span></span><br><span class="line">get_queue_count_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/getQueueCount'</span></span><br><span class="line">get_pass_code_new_url = <span class="string">'https://kyfw.12306.cn/otn/passcodeNew/getPassCodeNew'</span></span><br><span class="line">confirm_order_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/confirmSingleForQueue'</span></span><br><span class="line">wait_oder_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/queryOrderWaitTime'</span></span><br><span class="line">get_result_order_url = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/resultOrderForDcQueue'</span></span><br><span class="line">resultOrderForDcQueue = <span class="string">'https://kyfw.12306.cn/otn/confirmPassenger/resultOrderForDcQueue'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>手动验证码地址</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">captcha_point = &#123;</span><br><span class="line">    <span class="string">'1'</span>: <span class="string">'40,43'</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="string">'110,43'</span>,</span><br><span class="line">    <span class="string">'3'</span>: <span class="string">'180,43'</span>,</span><br><span class="line">    <span class="string">'4'</span>: <span class="string">'260,43'</span>,</span><br><span class="line">    <span class="string">'5'</span>: <span class="string">'40,117'</span>,</span><br><span class="line">    <span class="string">'6'</span>: <span class="string">'110,117'</span>,</span><br><span class="line">    <span class="string">'7'</span>: <span class="string">'180,117'</span>,</span><br><span class="line">    <span class="string">'8'</span>: <span class="string">'260,117'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他配置文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">##############################################</span></span><br><span class="line"><span class="comment">#需要修改的配置文件</span></span><br><span class="line"><span class="comment">##############################################</span></span><br><span class="line"><span class="comment"># 12306账号信息</span></span><br><span class="line">logininfo = &#123;</span><br><span class="line">    <span class="string">'username'</span>: <span class="string">'tosobo'</span>,               <span class="comment">#修改   帐号</span></span><br><span class="line">    <span class="string">'password'</span>: <span class="string">''</span>,           <span class="comment">#修改   帐号密码</span></span><br><span class="line">    <span class="string">'appid'</span>: <span class="string">'otn'</span></span><br><span class="line">&#125;</span><br><span class="line">loginname = <span class="string">u'沙'</span>                     <span class="comment">#修改   帐号名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#购票信息</span></span><br><span class="line">From_Station = <span class="string">'武汉'</span>                   <span class="comment">#修改    起点站</span></span><br><span class="line">To_Station = <span class="string">'深圳'</span>                     <span class="comment">#修改    终点站</span></span><br><span class="line">Train_Date = <span class="string">'2019-02-12'</span>               <span class="comment">#修改    订票日期</span></span><br><span class="line">TrainNumber = [<span class="string">'G1007'</span>,<span class="string">'G1009'</span>,<span class="string">'G1013'</span>,<span class="string">'G73'</span>,<span class="string">'G71'</span>,<span class="string">'G1015'</span>,<span class="string">'G79'</span>,<span class="string">'G1017'</span>,<span class="string">''</span>]              <span class="comment">#修改   车次，为空刷所有</span></span><br><span class="line">SeatType = <span class="string">'二等座'</span>                     <span class="comment">#修改   座次类型</span></span><br><span class="line">TicketName = [<span class="string">'沙'</span>,<span class="string">'娟'</span>]          <span class="comment">#修改   购票人名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通知邮箱</span></span><br><span class="line">Email = <span class="string">'tosobright@qq.com'</span>             <span class="comment">#修改</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><ul>
<li><p>打开登陆页面</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.init_url, headers=config.headers))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    html = response.read()</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="keyword">print</span> soup.find(id=<span class="string">"login_user"</span>).text.strip().encode(<span class="string">'gbk'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送验证码</p>
<ul>
<li><p>获取验证码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">captcha_data = &#123;</span><br><span class="line">    <span class="string">"login_site"</span>: <span class="string">"E"</span>,</span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"login"</span>,</span><br><span class="line">    <span class="string">"rand"</span>: <span class="string">"sjrand"</span>,</span><br><span class="line">    <span class="string">"0.17231872703389062"</span>: <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">param = urlencode(captcha_data)</span><br><span class="line">url = config.captcha_url.format(param)</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    url, headers=config.headers))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    file = BytesIO(response.read())</span><br><span class="line">    img = Image.open(file)</span><br><span class="line">    img.show()</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取验证码输入坐标</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">positions = raw_input(<span class="string">"输入验证码(以','分割)："</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">pos = positions.rstrip(<span class="string">'\r'</span>).strip().split(<span class="string">','</span>)</span><br><span class="line">temp = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> pos:</span><br><span class="line">    temp += config.captcha_point[item] + <span class="string">','</span></span><br><span class="line">pos_res = temp.rstrip(<span class="string">','</span>)</span><br><span class="line"><span class="keyword">print</span> pos_res</span><br></pre></td></tr></table></figure>
</li>
<li><p>核对验证码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">captcha_postdata = &#123;</span><br><span class="line">    <span class="string">"answer"</span>: pos_res,</span><br><span class="line">    <span class="string">"login_site"</span>: <span class="string">"E"</span>,</span><br><span class="line">    <span class="string">"rand"</span>: <span class="string">"sjrand"</span></span><br><span class="line">&#125;</span><br><span class="line">captcha_postdata = urlencode(captcha_postdata)</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(config.check_captcha_url,</span><br><span class="line">                                          headers=config.headers2), data=captcha_postdata)</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    result_message = result.get(<span class="string">"result_message"</span>)</span><br><span class="line">    result_message = result_message.encode(<span class="string">'gbk'</span>)</span><br><span class="line">    <span class="keyword">print</span> result_message</span><br><span class="line">    <span class="keyword">if</span> result.get(<span class="string">"result_code"</span>) == <span class="string">"4"</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"captcha OK"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>发送登录信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.login_url, headers=config.headers), data=urlencode(config.logininfo))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    print(result.get(<span class="string">'result_message'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    <span class="keyword">if</span> result.get(<span class="string">'result_code'</span>) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.uamtk_url, headers=config.headers), data=urlencode(&#123;<span class="string">"appid"</span>: <span class="string">"otn"</span>&#125;))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    print(<span class="string">"uamtk:"</span> + result.get(<span class="string">"result_message"</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    newapptk = result.get(<span class="string">"newapptk"</span>)</span><br><span class="line"></span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.auth_url, headers=config.headers), data=urlencode(&#123;<span class="string">"tk"</span>: newapptk&#125;))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    print(<span class="string">"auth:"</span> + result.get(<span class="string">"result_message"</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    print(<span class="string">"username:"</span> + result.get(<span class="string">"username"</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line"></span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.initmy12306_url, headers=config.headers))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    html = response.read()</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    name = soup.find(id=<span class="string">"login_user"</span>).text.strip()</span><br><span class="line">    <span class="keyword">print</span> name.encode(<span class="string">'gbk'</span>)</span><br><span class="line">    <span class="keyword">if</span> name == config.loginname:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="获取站点代码"><a href="#获取站点代码" class="headerlink" title="获取站点代码"></a>获取站点代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">station_url = <span class="string">'https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9069'</span></span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">        station_url, headers=config.headers))</span><br><span class="line">jstxt = response.read().split(<span class="string">'\''</span>)[<span class="number">1</span>]</span><br><span class="line">station = jstxt.split(<span class="string">'@'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> station:</span><br><span class="line">    <span class="keyword">if</span> item != <span class="string">''</span>:</span><br><span class="line">        v = item.split(<span class="string">'|'</span>)</span><br><span class="line">        dict[v[<span class="number">1</span>]] = v[<span class="number">2</span>]</span><br><span class="line">print(<span class="string">'GetStation Suc...'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="查询余票"><a href="#查询余票" class="headerlink" title="查询余票"></a>查询余票</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.left_tickets_sel_init, headers=config.headers))</span><br><span class="line"><span class="comment"># time.sleep(1000)</span></span><br><span class="line"><span class="comment"># https://kyfw.12306.cn/otn/leftTicket/queryA?leftTicketDTO.train_date=2018-10-01&amp;leftTicketDTO.from_station=SZQ&amp;leftTicketDTO.to_station=WHN&amp;purpose_codes=ADULT</span></span><br><span class="line">left_tickets_url = config.left_tickets_url + \</span><br><span class="line">    <span class="string">'leftTicketDTO.train_date='</span> + config.Train_Date + \</span><br><span class="line">    <span class="string">'&amp;leftTicketDTO.from_station='</span> + station.GetStationDict(config.From_Station) + \</span><br><span class="line">    <span class="string">'&amp;leftTicketDTO.to_station='</span> + station.GetStationDict(config.To_Station) + \</span><br><span class="line">    <span class="string">'&amp;purpose_codes=ADULT'</span></span><br><span class="line"><span class="keyword">print</span> left_tickets_url</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    left_tickets_url, headers=config.headers))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    r = response.read()</span><br><span class="line">    jdict = json.loads(r)</span><br><span class="line">    raw_trains = jdict[<span class="string">'data'</span>]</span><br><span class="line">    raw_trains = raw_trains[<span class="string">'result'</span>]</span><br><span class="line">    pt = PrettyTable()</span><br><span class="line">    pt._set_field_names(<span class="string">"车次,车站,时间,经历时,一等座,二等座,软卧,硬卧,硬座,无座"</span>.split(<span class="string">','</span>))</span><br><span class="line">    train_dict = []</span><br><span class="line">    <span class="keyword">for</span> raw_train <span class="keyword">in</span> raw_trains:</span><br><span class="line">        <span class="comment"># split切割之后得到的是一个列表</span></span><br><span class="line">        data_list = raw_train.split(<span class="string">"|"</span>)</span><br><span class="line">        dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        orderurlstr = unquote(data_list[<span class="number">0</span>])</span><br><span class="line">        dict[<span class="string">'orderurlstr'</span>] = orderurlstr</span><br><span class="line">        stationTrainCode = data_list[<span class="number">2</span>]</span><br><span class="line">        dict[<span class="string">'stationTrainCode'</span>] = stationTrainCode</span><br><span class="line">        train_no = data_list[<span class="number">3</span>]</span><br><span class="line">        dict[<span class="string">'train_no'</span>] = train_no</span><br><span class="line">        from_station_code = data_list[<span class="number">6</span>]</span><br><span class="line">        dict[<span class="string">'from_station_code'</span>] = from_station_code</span><br><span class="line">        to_station_code = data_list[<span class="number">7</span>]</span><br><span class="line">        dict[<span class="string">'to_station_code'</span>] = to_station_code</span><br><span class="line">        from_station_name = station.GetStationName(from_station_code)</span><br><span class="line">        dict[<span class="string">'from_station_name'</span>] = from_station_name</span><br><span class="line">        to_station_name = station.GetStationName(to_station_code)</span><br><span class="line">        dict[<span class="string">'to_station_name'</span>] = to_station_name</span><br><span class="line">        start_time = data_list[<span class="number">8</span>]</span><br><span class="line">        dict[<span class="string">'start_time'</span>] = start_time</span><br><span class="line">        arrive_time = data_list[<span class="number">9</span>]</span><br><span class="line">        dict[<span class="string">'arrive_time'</span>] = arrive_time</span><br><span class="line">        time_duration = data_list[<span class="number">10</span>]</span><br><span class="line">        dict[<span class="string">'time_duration'</span>] = time_duration</span><br><span class="line">        train_location = data_list[<span class="number">15</span>]</span><br><span class="line">        dict[<span class="string">'train_location'</span>] = train_location</span><br><span class="line">        first_class_seat = data_list[<span class="number">31</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'first_class_seat'</span>] = first_class_seat</span><br><span class="line">        second_class_seat = data_list[<span class="number">30</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'second_class_seat'</span>] = second_class_seat</span><br><span class="line">        soft_sleep = data_list[<span class="number">23</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'soft_sleep'</span>] = soft_sleep</span><br><span class="line">        hard_sleep = data_list[<span class="number">28</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'hard_sleep'</span>] = hard_sleep</span><br><span class="line">        hard_seat = data_list[<span class="number">29</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'hard_seat'</span>] = hard_seat</span><br><span class="line">        no_seat = data_list[<span class="number">33</span>] <span class="keyword">or</span> <span class="string">"--"</span></span><br><span class="line">        dict[<span class="string">'no_seat'</span>] = no_seat</span><br><span class="line"></span><br><span class="line">        pt.add_row([</span><br><span class="line">            <span class="comment"># 对特定文字添加颜色</span></span><br><span class="line">            train_no,</span><br><span class="line">            <span class="string">'\n'</span>.join([station.GetStationName(from_station_code),</span><br><span class="line">                        station.GetStationName(to_station_code)]),</span><br><span class="line">            <span class="string">'\n'</span>.join([start_time, arrive_time]),</span><br><span class="line">            time_duration,</span><br><span class="line">            first_class_seat,</span><br><span class="line">            second_class_seat,</span><br><span class="line">            soft_sleep,</span><br><span class="line">            hard_sleep,</span><br><span class="line">            hard_seat,</span><br><span class="line">            no_seat</span><br><span class="line">        ])</span><br><span class="line">        train_dict.append(dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(pt)</span></span><br><span class="line">    <span class="keyword">print</span> train_dict</span><br><span class="line">    <span class="keyword">return</span> train_dict</span><br></pre></td></tr></table></figure>

<h2 id="检查用户登录情况"><a href="#检查用户登录情况" class="headerlink" title="检查用户登录情况"></a>检查用户登录情况</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.checkuser_url, headers=config.headers), data=urlencode(&#123;<span class="string">"_json_att"</span>: <span class="string">""</span>&#125;))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'flag'</span>]:</span><br><span class="line">        print(<span class="string">'用户在线验证成功'</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'检查到用户不在线，请重新登陆'</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="初次提交订单"><a href="#初次提交订单" class="headerlink" title="初次提交订单"></a>初次提交订单</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;<span class="string">"secretStr"</span>: train_number_str,</span><br><span class="line">        <span class="string">"train_date"</span>: config.Train_Date,</span><br><span class="line">        <span class="string">"back_train_date"</span>: datetime.datetime.now().strftime(<span class="string">"%Y-%m-%d"</span>),</span><br><span class="line">        <span class="string">"tour_flag"</span>: <span class="string">"dc"</span>,</span><br><span class="line">        <span class="string">"purpose_codes"</span>: <span class="string">"ADULT"</span>,</span><br><span class="line">        <span class="string">"query_from_station_name"</span>: config.From_Station,</span><br><span class="line">        <span class="string">"query_to_station_name"</span>: config.To_Station,</span><br><span class="line">        <span class="string">"undefined"</span>: <span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.submit_order_url, headers=config.headers), data=urlencode(data))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">'status'</span>]:</span><br><span class="line">        print(<span class="string">'初次提交订单成功'</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> result[<span class="string">'messages'</span>] != []:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'messages'</span>][<span class="number">0</span>] == <span class="string">"车票信息已过期，请重新查询最新车票信息"</span>:</span><br><span class="line">            print(<span class="string">'车票信息已过期，请重新查询最新车票信息'</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ticketInfoOutData"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"提交失败"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="获取旅客信息"><a href="#获取旅客信息" class="headerlink" title="获取旅客信息"></a>获取旅客信息</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"_json_att"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"REPEAT_SUBMIT_TOKEN"</span>: reSubmitTk</span><br><span class="line">&#125;</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.get_passenger_url, headers=config.headers), data=urlencode(data))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">'messages'</span>] != []:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'messages'</span>][<span class="number">0</span>] == <span class="string">'系统忙，请稍后重试'</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'systembusy'</span></span><br><span class="line">    passengerAllInfoList = result[<span class="string">'data'</span>][<span class="string">'normal_passengers'</span>]</span><br><span class="line">    print(<span class="string">"获取联系人信息成功"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    <span class="keyword">return</span> passengerAllInfoList</span><br></pre></td></tr></table></figure>

<h2 id="核对订单"><a href="#核对订单" class="headerlink" title="核对订单"></a>核对订单</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">passengerTicketStr = <span class="string">""</span></span><br><span class="line">oldPassengerStr = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> passengerslist:</span><br><span class="line">    passengerTicketStr += seat.GetSeatType(config.SeatType) + <span class="string">',0,1,'</span> + \</span><br><span class="line">        item[<span class="string">'passenger_name'</span>] + <span class="string">',1,'</span> + \</span><br><span class="line">        item[<span class="string">'passenger_id_no'</span>] + <span class="string">','</span> + item[<span class="string">'mobile_no'</span>] + <span class="string">',N_'</span></span><br><span class="line">    oldPassengerStr += item[<span class="string">'passenger_name'</span>] + \</span><br><span class="line">        <span class="string">',1,'</span> + item[<span class="string">'passenger_id_no'</span>]+<span class="string">',1_'</span></span><br><span class="line"></span><br><span class="line">passengerTicketStr = passengerTicketStr.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">oldPassengerStr = oldPassengerStr.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"cancel_flag"</span>: <span class="string">"2"</span>,</span><br><span class="line">    <span class="string">"bed_level_order_num"</span>: <span class="string">"000000000000000000000000000000"</span>,</span><br><span class="line">    <span class="string">"passengerTicketStr"</span>: passengerTicketStr,</span><br><span class="line">    <span class="string">"oldPassengerStr"</span>: oldPassengerStr,</span><br><span class="line">    <span class="string">"tour_flag"</span>: <span class="string">"dc"</span>,</span><br><span class="line">    <span class="string">"tour_flag"</span>: <span class="string">"dc"</span>,</span><br><span class="line">    <span class="string">"randCode"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"whatsSelect"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"_json_att"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"REPEAT_SUBMIT_TOKEN"</span>: reSubmitTk</span><br><span class="line">&#125;</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.check_order_info_url, headers=config.headers), data=urlencode(data))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'submitStatus'</span>]:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'ifShowPassCode'</span>] == <span class="string">'N'</span>:</span><br><span class="line">            print(<span class="string">"checkOrder"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'ifShowPassCode'</span>] == <span class="string">'Y'</span>:</span><br><span class="line">            GetBuyImage()</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Need Random Code"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"checkOrderFail"</span>)</span><br><span class="line">        print(result[<span class="string">'data'</span>][<span class="string">'errMsg'</span>].encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="获取队列"><a href="#获取队列" class="headerlink" title="获取队列"></a>获取队列</h2><ul>
<li><p>开始进入购票队列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">thatdaydata = datetime.datetime.strptime(config.Train_Date, <span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">train_date_f = <span class="string">"&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125; 00:00:00 GMT+0800 (中国标准时间)"</span>.format(thatdaydata.strftime(<span class="string">'%a'</span>),</span><br><span class="line">                                                                thatdaydata.strftime(</span><br><span class="line">    <span class="string">'%b'</span>), config.Train_Date.split(<span class="string">'-'</span>)[<span class="number">2</span>],</span><br><span class="line">    config.Train_Date.split(<span class="string">'-'</span>)[<span class="number">0</span>])</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"train_date"</span>: train_date_f,</span><br><span class="line">    <span class="string">"train_no"</span>: trainInfo[<span class="string">'train_no'</span>],</span><br><span class="line">    <span class="string">"stationTrainCode"</span>: trainInfo[<span class="string">'stationTrainCode'</span>],</span><br><span class="line">    <span class="string">"seatType"</span>: seat.GetSeatType(config.SeatType),</span><br><span class="line">    <span class="string">"fromStationTelecode"</span>: trainInfo[<span class="string">'from_station_code'</span>],</span><br><span class="line">    <span class="string">"toStationTelecode"</span>: trainInfo[<span class="string">'to_station_code'</span>],</span><br><span class="line">    <span class="string">"leftTicket"</span>: leftTicketStr,</span><br><span class="line">    <span class="string">"purpose_codes"</span>: <span class="string">"00"</span>,</span><br><span class="line">    <span class="string">"train_location"</span>: trainInfo[<span class="string">'train_location'</span>],</span><br><span class="line">    <span class="string">"_json_att"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"REPEAT_SUBMIT_TOKEN"</span>: reSubmitTk</span><br><span class="line">&#125;</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.get_queue_count_url, headers=config.headers), data=urlencode(data))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"NetWorkError"</span></span><br><span class="line"><span class="keyword">if</span> result[<span class="string">'status'</span>]:</span><br><span class="line">    print(<span class="string">"进入队列成功"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"进入队列失败"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>确认单人队列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">passengerTicketStr = <span class="string">""</span></span><br><span class="line">oldPassengerStr = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> passengerslist:</span><br><span class="line">    passengerTicketStr += seat.GetSeatType(config.SeatType) + <span class="string">',0,1,'</span> + \</span><br><span class="line">        item[<span class="string">'passenger_name'</span>] + <span class="string">',1,'</span> + \</span><br><span class="line">        item[<span class="string">'passenger_id_no'</span>] + <span class="string">','</span> + item[<span class="string">'mobile_no'</span>]+<span class="string">',N_'</span></span><br><span class="line">    oldPassengerStr += item[<span class="string">'passenger_name'</span>] + \</span><br><span class="line">        <span class="string">',1,'</span> + item[<span class="string">'passenger_id_no'</span>]+<span class="string">',1_'</span></span><br><span class="line"></span><br><span class="line">passengerTicketStr = passengerTicketStr.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">oldPassengerStr = oldPassengerStr.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"passengerTicketStr"</span>: passengerTicketStr,</span><br><span class="line">    <span class="string">"oldPassengerStr"</span>: oldPassengerStr,</span><br><span class="line">    <span class="string">"randCode"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"purpose_codes"</span>: <span class="string">"00"</span>,</span><br><span class="line">    <span class="string">"key_check_isChange"</span>: keyIsChange,</span><br><span class="line">    <span class="string">"leftTicketStr"</span>: leftTicketStr,</span><br><span class="line">    <span class="string">"train_location"</span>: traininfo[<span class="string">'train_location'</span>],</span><br><span class="line">    <span class="string">"choose_seats"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"seatDetailType"</span>: <span class="string">"000"</span>,</span><br><span class="line">    <span class="string">"whatsSelect"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"roomType"</span>: <span class="string">"00"</span>,</span><br><span class="line">    <span class="string">"dwAll"</span>: <span class="string">"N"</span>,</span><br><span class="line">    <span class="string">"_json_att"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"REPEAT_SUBMIT_TOKEN"</span>: reSubmitTk</span><br><span class="line">&#125;</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(</span><br><span class="line">    config.confirm_order_url, headers=config.headers), data=urlencode(data))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"NetWorkError"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'data'</span> <span class="keyword">in</span> result.keys():</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'submitStatus'</span>] <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">"确认提交订单成功"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> result[<span class="string">'data'</span>][<span class="string">'errMsg'</span>] == <span class="string">u"验证码输入错误！"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"wrongCode"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"提交订单失败"</span>.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="等待队列"><a href="#等待队列" class="headerlink" title="等待队列"></a>等待队列</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">orderId = <span class="string">''</span></span><br><span class="line">url = config.wait_oder_url + <span class="string">'?random=&#123;&#125;&amp;tourFlag=dc&amp;_json_att=&amp;REPEAT_SUBMIT_TOKEN=&#123;&#125;'</span>.format(</span><br><span class="line">    int(time.time()*<span class="number">1000</span>), reSubmitTk)</span><br><span class="line">response = urllib2.urlopen(urllib2.Request(url, headers=config.headers))</span><br><span class="line"><span class="keyword">if</span> response.getcode() == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = json.loads(response.read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">'status'</span>]:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'queryOrderWaitTimeStatus'</span>]:</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'data'</span>][<span class="string">'waitTime'</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">print</span> result[<span class="string">'data'</span>][<span class="string">'waitTime'</span>]</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">            <span class="keyword">elif</span> result[<span class="string">'data'</span>][<span class="string">'waitTime'</span>] == <span class="number">-1</span>:</span><br><span class="line">                orderId = result[<span class="string">'data'</span>][<span class="string">'orderId'</span>]</span><br><span class="line">                <span class="keyword">print</span> orderId</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"请登录12306，完成后续支付"</span></span><br><span class="line">                <span class="keyword">return</span> orderId</span><br><span class="line">            <span class="keyword">elif</span> result[<span class="string">'data'</span>][<span class="string">'waitTime'</span>] == <span class="number">-2</span>:</span><br><span class="line">                <span class="keyword">print</span> result[<span class="string">'data'</span>][<span class="string">'msg'</span>].encode(<span class="string">'gbk'</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'error'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'error'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br></pre></td></tr></table></figure>

<h2 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h2><pre><code><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SMTP 服务</span></span><br><span class="line">mail_host = <span class="string">"smtp.126.com"</span>  <span class="comment">#设置服务器</span></span><br><span class="line">mail_port = <span class="number">25</span></span><br><span class="line">mail_user = <span class="string">""</span>    <span class="comment">#用户名</span></span><br><span class="line">mail_pass = <span class="string">""</span>   <span class="comment">#口令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#收发信息</span></span><br><span class="line">FromEmail = <span class="string">'tipinfo@126.com'</span></span><br><span class="line">ToEmails = [config.Email,]  <span class="comment"># 接收邮件，可设置为你的QQ邮箱或者其他邮箱</span></span><br><span class="line"></span><br><span class="line">EmailTitle = <span class="string">'12306有票了'</span></span><br><span class="line">EmailContent = <span class="string">'快来付款！'</span></span><br><span class="line"></span><br><span class="line">msg = MIMEMultipart()</span><br><span class="line">msg[<span class="string">'From'</span>] = <span class="string">"&#123;&#125;"</span>.format(FromEmail)</span><br><span class="line">msg[<span class="string">'To'</span>] = <span class="string">","</span>.join(ToEmails)</span><br><span class="line">msg[<span class="string">'Subject'</span>] = EmailTitle</span><br><span class="line"></span><br><span class="line">msg.attach(MIMEText(EmailContent, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#attach1 = MIMEText(open('f:\getweather.log', 'rb').read(), 'base64', 'utf-8')</span></span><br><span class="line"><span class="comment">#attach1["Content-Type"] = 'pplication/octet-stream'</span></span><br><span class="line"><span class="comment">#attach1["Content-Disposition"] = 'attrachment;filename="getweather.txt"'</span></span><br><span class="line"><span class="comment">#msg.attach(attach1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    server = smtplib.SMTP(mail_host, mail_port)</span><br><span class="line">    server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line">    server.login(mail_user,mail_pass)</span><br><span class="line">    server.sendmail(FromEmail, ToEmails, msg.as_string())</span><br><span class="line">    server.quit()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"邮件发送成功"</span></span><br><span class="line"><span class="keyword">except</span> smtplib.SMTPException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Error: 无法发送邮件"</span></span><br><span class="line">    <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure></code></pre>]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>12306</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW MATP</title>
    <url>/2017/02/08/170208-labview-matp/</url>
    <content><![CDATA[<h1 id="MATP-介绍"><a href="#MATP-介绍" class="headerlink" title="MATP 介绍"></a>MATP 介绍</h1><ol>
<li>《SplashScreen》MATP 的引导是以 VB6.0 进行编写，VB6.0 开发的引导界面，主要是小巧，可以快速启动</li>
<li>《LV_Main》LabVIEW 为测试主体语言，LV_Main 中的 MyLib 为个人积累的库文件，界面可缩放，后期可支持多语言！<br>MATP 是一个基于 LabVIEW 的多功能自动测试平台，支持 4UUT，10 个测试项目并行运行！<br>MATP 的 debug 是一个基于 LabVIEW 的调试平台，完善中<br>LabVIEW 的源代码密码为：<a href="mailto:tosobright@gmail.com" target="_blank" rel="noopener">tosobright@gmail.com</a></li>
<li>《WebSite》asp.net（vb.net）为网页 web 查看数据开发语言</li>
<li>《WebServer_cassinidev-94877》开源 webserver 进行的二次开发 web 服务器，可替代 IIS</li>
<li>《FlowCollect》B4A 为 android APP 开发语言，有一 Demo，包含数据库连接，规划中</li>
<li>使用者需使用 SQLSERVER 数据库，如无数据库，可以安装 sqlexpress，数据库可参考本人的数据库连接</li>
<li>《USER.sql》SQLSERVER User Table 创建 SQL 语句</li>
<li>APP 文件夹为打包后的程序，可直接运行，但需注册 msadodc.ocx、mswinsck.ocx，安装 LabVIEW2016 RunTime，.net4.0.</li>
</ol>
<h1 id="SplashScreen"><a href="#SplashScreen" class="headerlink" title="SplashScreen"></a>SplashScreen</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">Case</span> Num_TimeSelect</span><br><span class="line">    <span class="keyword">Case</span> <span class="number">0</span>  <span class="comment">'注册信息确认</span></span><br><span class="line">        GetHardwareInfo</span><br><span class="line">        GetMachineSN</span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"RegInfo Comfirm..."</span></span><br><span class="line">        <span class="comment"><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span>'RegForm.Show</span></span><br><span class="line">        <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">        Shell <span class="string">"taskkill /f /im "</span> &amp; <span class="string">"MATP.exe"</span></span><br><span class="line">        Shell <span class="string">"taskkill /f /im MATPDebug.exe"</span></span><br><span class="line">        Shell <span class="string">"taskkill /f /im matpwebserver.exe"</span></span><br><span class="line">        Tcpserver</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Case</span> <span class="number">1</span> <span class="comment">'数据库参数确认，并连接数据库</span></span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"Connect Database..."</span></span><br><span class="line">        waitms <span class="number">200</span></span><br><span class="line">        Timer1.Enabled = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">Dim</span> inipath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">        inipath = App.path + <span class="string">"\data\config.ini"</span></span><br><span class="line">        <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> inifile</span><br><span class="line">        SQL_Server = GetPrivateStringValue(<span class="string">"SQLSERVER"</span>, <span class="string">"ServerPar.Server"</span>, inipath)</span><br><span class="line">        SQL_Server = Replace(SQL_Server, <span class="string">"\\"</span>, <span class="string">"\"</span>)</span><br><span class="line">        SQL_DB = GetPrivateStringValue(<span class="string">"SQLSERVER"</span>, <span class="string">"ServerPar.Database"</span>, inipath)</span><br><span class="line">        SQL_User = GetPrivateStringValue(<span class="string">"SQLSERVER"</span>, <span class="string">"ServerPar.User"</span>, inipath)</span><br><span class="line">        SQL_Pwd = GetPrivateStringValue(<span class="string">"SQLSERVER"</span>, <span class="string">"ServerPar.Pwd"</span>, inipath)</span><br><span class="line">        SQL_Port = GetPrivateStringValue(<span class="string">"SQLSERVER"</span>, <span class="string">"ServerPar.Port"</span>, inipath)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">If</span> SQL_Server = <span class="string">""</span> <span class="keyword">Or</span> SQL_DB = <span class="string">""</span> <span class="keyword">Or</span> SQL_User = <span class="string">""</span> <span class="keyword">Or</span> SQL_Pwd = <span class="string">""</span> <span class="keyword">Then</span></span><br><span class="line">            Database.Show</span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">Dim</span> SQL_ConnectStr <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">        SQL_ConnectStr = <span class="string">"provider=SQLOlEDB.1;persist security info= false;uid="</span> + SQL_User + <span class="string">";pwd="</span> + SQL_Pwd + <span class="string">";Initial Catalog="</span> + SQL_DB + <span class="string">";Data Source="</span> + SQL_Server</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Dim</span> sqlcon <span class="keyword">As</span> <span class="keyword">New</span> ADODB.Connection</span><br><span class="line">        <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> sqlerr</span><br><span class="line">        sqlcon.Open SQL_ConnectStr</span><br><span class="line"></span><br><span class="line">        sqlcon.Close</span><br><span class="line"></span><br><span class="line">        Timer1.Enabled = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Case</span> <span class="number">2</span> <span class="comment">'启动主程序</span></span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"MATP Loading..."</span></span><br><span class="line">        Timer1.Enabled = <span class="literal">False</span></span><br><span class="line">        APPstart <span class="string">"\MATP.exe"</span></span><br><span class="line">        waitms <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Case</span> <span class="number">3</span> <span class="comment">'启动调试程序</span></span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"DebugServer Loading..."</span></span><br><span class="line">        Timer1.Enabled = <span class="literal">False</span></span><br><span class="line">        APPstart <span class="string">"\MATPDebug.exe"</span></span><br><span class="line">        waitms <span class="number">500</span></span><br><span class="line">        TcpClient.Connect</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Case</span> <span class="number">4</span> <span class="comment">'启动webserver</span></span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"MatpWebServer Loading..."</span></span><br><span class="line">        Timer1.Enabled = <span class="literal">False</span></span><br><span class="line">        APPstart <span class="string">"\matpwebserver.exe"</span></span><br><span class="line">        Shell <span class="string">"taskkill /f /im MATPDebug.exe"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Case</span> <span class="number">5</span> <span class="comment">'显示主界面</span></span><br><span class="line">        Lbl_LoadInfo.Caption = <span class="string">"MatpShow"</span></span><br><span class="line">        TcpClient.SendData <span class="string">"S"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br></pre></td></tr></table></figure>

<h1 id="LV-Main"><a href="#LV-Main" class="headerlink" title="LV_Main"></a>LV_Main</h1><p>LabVIEW 开发测试主体程序</p>
<h1 id="WebSite"><a href="#WebSite" class="headerlink" title="WebSite"></a>WebSite</h1><p>采用的是 asp.net</p>
<h1 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h1><p>采用 B4A</p>
<h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><p>不更新</p>
<h1 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h1><p>现在最好是采用前后端分离的方式</p>
<ul>
<li>后端提供 RestfulAPI，可以使用 Python 或者 Java</li>
<li>前端使用 vue.js</li>
<li>APP 使用 HTML5 或者 uni-app 这类</li>
</ul>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
        <tag>ASP.NET</tag>
        <tag>b4a</tag>
        <tag>SQL Server</tag>
      </tags>
  </entry>
  <entry>
    <title>无线温湿度分布式实时采集</title>
    <url>/2016/04/22/160422-TH-WIFI/</url>
    <content><![CDATA[<ol>
<li><p>目的：<br>为了能够让管理者实时监控无尘车间的温湿度环境，让产线能在规定的环境范围内运转。</p>
</li>
<li><p>硬件：<br>MCU：stm8s103</p>
<p>温湿度传感器：DHT11（视温湿度要求而定）</p>
<p>无线模块：ESP8266</p>
<p>服务器：PC</p>
</li>
<li><p>软件：<br> 3.1 下位机：</p>
<p>下位机通过 DHT11 采集当前区域的温湿度值，并按照设定的时间间隔（60s），自动上传到 LabVIEW 服务器</p>
<p>3.2 上位机：<br>采用 LabVIEW 进行服务器数据的采集，并将数据保存至 MariDB!可通过网页查看最新的温湿度数据，超过设定的温湿度值，可通过 email 进行报警！</p>
<p>3.3 手机查看</p>
<p>可用 B4A，实现远端数据的查看！</p>
<p>3.4 WEB</p>
<p>通过 CGI 可实现 web 浏览当前数据</p>
</li>
<li><p>扩展</p>
<p>可通过此模式实现生产流程数据的采集以做生产管控</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>B4A获取系统时间</title>
    <url>/2016/04/17/160417-b4a-getsystime/</url>
    <content><![CDATA[<p>1.可参考 B4A 手册<a href="http://www.b4x.com/android/help/core.html#datetime" target="_blank" rel="noopener">http://www.b4x.com/android/help/core.html#datetime</a></p>
<p>2.由于获取到的 week 是数字，我们需要定义一个 week 数组</p>
<p>Dim Str_Week() As String = Array As String(“星期日”,”星期一”,”星期二”,”星期三”,”星期四”,”星期五”,”星期六”)</p>
<p>3.获取系统的年月日、星期、时间<br>Dim date As String<br>date = DateTime.Date(DateTime.Now) &amp; “ “ &amp;Str_Week(DateTime.GetDayOfWeek(DateTime.Now) - 1)&amp; “ “ &amp; DateTime.Time(DateTime.Now)<br>Lbl_Status10.Text = date</p>
<p>4.其他的格式化可参考 B4A 的手册</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>B4A</tag>
      </tags>
  </entry>
  <entry>
    <title>B4A实现listview的高亮选择</title>
    <url>/2016/04/17/160417-b4a-listview-hilight/</url>
    <content><![CDATA[<p>在使用 B4A 中，我们需要实现 B4A 的高亮选中，但是自带的 listview 是没有这个的功能的，这里通过 listview 的 2 种添加模式，进行实现！</p>
<p>1.设置 listview 的属性</p>
<pre><code>Dim lstview As ListView
  lstview .Color = Colors.DarkGray
  lstview .SingleLineLayout.Label.TextColor = Colors.White
  lstview .TwoLinesLayout.Label.TextColor = Colors.Red
  lstview .TwoLinesLayout.SecondLabel.TextColor = Colors.Green</code></pre><p>2.我们在 listview 里面加入列表<br>Dim lst() As String = Array As String(“123”,”456”,”789”)</p>
<pre><code>For ii = 0 To lst.length - 1
    lstview.AddSingleLine(lst(ii-1))
Next</code></pre><p>3.当我们点击 list 时会触发 event</p>
<pre><code>Sub lstview_ItemClick (Position As Int, Value As Object)</code></pre><p>4.我们需先 clear 所有列表</p>
<pre><code>lstview.Clear</code></pre><p>5.然后再重新加入列表，不过当 event 中的 Position 和 list 序号相同时，我们使用添加 2 行的方法</p>
<pre><code>For ii = 0 To lst.length - 1
    If(ii = Position ) Then
        lstview.AddTwoLines(&quot;当前选择为&quot; , lst(ii))
    Else
        lstview.AddSingleLine(lst(ii-1))
    End If
Next

lstview.SetSelection(Position)</code></pre><p>6.这样就实现了 list 的高亮</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>B4A</tag>
      </tags>
  </entry>
  <entry>
    <title>B4A实现声音的播放MediaPlayer</title>
    <url>/2016/04/17/160417-b4a-mediaplayer/</url>
    <content><![CDATA[<ol>
<li><p>首先，需在库文件里面选择 Audio</p>
</li>
<li><p>在变量中定义一个 mediaplayer</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Dim</span> MediaPlayer <span class="keyword">As</span> MediaPlayer</span><br></pre></td></tr></table></figure>
</li>
<li><p>播放 MP3</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Sub</span> PlayMP3(FileName <span class="keyword">As</span> <span class="built_in">String</span>,PlayLoop <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">  MediaPlayer.Initialize<span class="comment">'初始化</span></span><br><span class="line">  MediaPlayer.Load(File.DirAssets,FileName)</span><br><span class="line">  MediaPlayer.Play<span class="comment">'播放</span></span><br><span class="line">  <span class="keyword">If</span>(PlayLoop = <span class="literal">True</span>) <span class="keyword">Then</span></span><br><span class="line">    MediaPlayer.Looping=<span class="literal">True</span><span class="comment">'True:播放完自动重新开始 False:播放完停下</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  Bol_Play = <span class="literal">True</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>停止播放</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Sub</span> StopMp3()</span><br><span class="line">  <span class="keyword">If</span> Bol_Play = <span class="literal">True</span> <span class="keyword">Then</span>	MediaPlayer.<span class="keyword">Stop</span></span><br><span class="line">  Bol_Play = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>B4A</tag>
      </tags>
  </entry>
  <entry>
    <title>B4A屏幕常亮和取消常亮</title>
    <url>/2016/04/17/160417-b4a-phonewake/</url>
    <content><![CDATA[<p>B4A 是一个 Basic 语言编辑，可生成 android 的工具！</p>
<p>对于设置 android 界面的常亮，需要用到 B4A 的 Phone 库，Link：<a href="http://www.b4x.com/android/help/phone.html" target="_blank" rel="noopener">http://www.b4x.com/android/help/phone.html</a></p>
<p>在 Phone 里面有个 PhoneWakeState</p>
<p>首先，我们需要定义一个 PhoneWakeState</p>
<p>Dim PhoneWakeState As PhoneWakeState</p>
<p>如果需要屏幕常量，则</p>
<p>PhoneWakeState.KeepAlive(True)</p>
<p>如果需要取消，则</p>
<p>PhoneWakeState.ReleaseKeepAlive</p>
<p>通过这 2 个的调用，就可以实现 Activity 的常亮</p>
<p>如果你有多个 activity，则需在每个 activity 里面增加</p>
<p>PhoneWakeState.KeepAlive(True)</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>B4A</tag>
      </tags>
  </entry>
  <entry>
    <title>B4A实现CRC16校验（Modbus）</title>
    <url>/2016/04/17/160417-b4a-modbus-crc16/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>循环冗余校验（Cyclic Redundancy Check， CRC）是一种根据网络数据包或计算机文件等数据产生简短固定位数校验码的一种信道编码技术，主要用来检测或校验数据传输或者保存后可能出现的错误。它是利用除法及余数的原理来作错误侦测的。</p>
<pre><code>1．设置CRC寄存器，并给其赋值FFFF(hex)。
2．将数据的第一个8-bit字符与16位CRC寄存器的低8位进行异或，并把结果存入CRC寄存器。
3．CRC寄存器向右移一位，MSB补零，移出并检查LSB。
4．如果LSB为0，重复第三步；若LSB为1，CRC寄存器与多项式码相异或。
注意：该步检查LSB应该是右移前的LSB，即第3步前的LSB。
5．重复第3与第4步直到8次移位全部完成。此时一个8-bit数据处理完毕。
6．重复第2至第5步直到所有数据全部处理完成。
7．最终CRC寄存器的内容即为CRC值。</code></pre><h1 id="B4A"><a href="#B4A" class="headerlink" title="B4A"></a>B4A</h1><p>这里提供一个 Modbus 的 CRC16 校验计算，亲测可用！</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Sub</span> CRC16(buf() <span class="keyword">As</span> <span class="built_in">Byte</span>, lbuf <span class="keyword">As</span> <span class="built_in">Short</span>) <span class="keyword">As</span> <span class="built_in">Byte</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> CRC(<span class="number">2</span>) <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line">    <span class="keyword">Dim</span> crcval <span class="keyword">As</span> <span class="built_in">Short</span></span><br><span class="line">    crcval = <span class="number">0xffff</span></span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> lbuf - <span class="number">1</span></span><br><span class="line">    	crcval = Bit.<span class="keyword">Xor</span>(crcval,Bit.<span class="keyword">And</span>( buf(i),<span class="number">0xff</span>))</span><br><span class="line">    	<span class="keyword">For</span> j = <span class="number">0</span> <span class="keyword">To</span> <span class="number">7</span></span><br><span class="line">    		<span class="keyword">If</span> Bit.<span class="keyword">And</span>(crcval, <span class="number">1</span>) &gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    			crcval =Bit.<span class="keyword">And</span>( Bit.ShiftRight(crcval,<span class="number">1</span>),<span class="number">0x7fff</span>)</span><br><span class="line">    			crcval=Bit.<span class="keyword">Xor</span>(crcval, <span class="number">0xa001</span>)</span><br><span class="line">    		<span class="keyword">Else</span></span><br><span class="line">    			crcval =Bit.<span class="keyword">And</span>( Bit.ShiftRight(crcval,<span class="number">1</span>),<span class="number">0x7fff</span>)</span><br><span class="line">    		<span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    	<span class="keyword">Next</span>    <span class="comment">'j</span></span><br><span class="line">    <span class="keyword">Next</span>        <span class="comment">'i</span></span><br><span class="line">    CRC(<span class="number">0</span>) = Bit.<span class="keyword">And</span>(crcval, <span class="number">0xff</span>)</span><br><span class="line">    CRC(<span class="number">1</span>) = Bit.<span class="keyword">And</span>(crcval, <span class="number">0xff00</span>) / <span class="number">256</span></span><br><span class="line">    <span class="keyword">Return</span> CRC</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<p>下面这个是 modbus 返回计算校验</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Sub</span> MB_Read(Func <span class="keyword">As</span> <span class="built_in">Byte</span>) <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line">  <span class="keyword">Dim</span> addr <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line">  <span class="keyword">Dim</span> crcval(<span class="number">2</span>) <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line">  <span class="keyword">If</span>(MB_RecvDataLength &lt;= <span class="number">1</span> ) <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  addr = Main.Int_DevAddr</span><br><span class="line">  <span class="keyword">If</span>(MB_RecvData(<span class="number">0</span>) &lt;&gt; addr ) <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  <span class="keyword">If</span>(MB_RecvData(<span class="number">1</span>) &lt;&gt; Func ) <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  crcval = CRC16(MB_RecvData,MB_RecvDataLength <span class="number">-2</span>)</span><br><span class="line">  <span class="keyword">If</span>(crcval(<span class="number">0</span>) &lt;&gt; MB_RecvData(MB_RecvDataLength - <span class="number">2</span>) <span class="keyword">Or</span> crcval(<span class="number">1</span>) &lt;&gt; MB_RecvData(MB_RecvDataLength - <span class="number">1</span>) ) <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  MB_RecvDataLength = <span class="number">0</span></span><br><span class="line">  <span class="keyword">Return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>B4A</tag>
      </tags>
  </entry>
  <entry>
    <title>Jlink V8 固件修复（the connected emulate is a J-link clone）</title>
    <url>/2014/08/08/140808-jlink-v8-repair/</url>
    <content><![CDATA[<p>关于 JLINK 固件丢失或升级固件后提示 Clone 的解决办法</p>
<p>本人用的 JLINK 仿真器（某宝上买的），在使用 IAR7.2 时，提示要升级固件，升级后就出现 the connected emulate is a J-link clone 的提示。</p>
<p>在网上找了许多关于修复的资料，本人反复试验，总算找到比较好的解决方案，操作步骤如下：</p>
<p>1.首先使用 winHEX 打开 V8.bin 固件,并且找到以 0xFF00 为起始地址的 4 个 Bytes 并将其修改为 0xFFFFFFFF,<br>并在下面不远的地方找到 GDBFull，其相对应的十六进制的代码 47 44 42 46 75 6C 6C 改成 47 44 42 46 55 4C 4C<br>（将小写的改成大写的，目的是跳过 GDBFull）并且保存此修改好的固件文件。</p>
<p>2.请参照《JLINK V8 固件烧录指导.pdf》进行固件烧写。(烧写固件使用 J-LINK V8.bin)</p>
<p>3.安装 Setup_JLinkARM_V450l（若安装其它版本的，仍建议安装此版本，已安装版本不用卸载，否则可能会出现刚烧写好固件就提示 Clone 的情况）。<br>连接仿真器到电脑上，打开 J-Link Commander（刚安装版本的），提示升级时点击取消<br>若仿真器正确识别，就可以在命令行键入命令如下：<br>exec setsn=XXXXXXXX (XXXXXXXX 代表 16 进制，值随意设定)</p>
<p>4.关闭 J-Link Commander，就可以使用其它版本的 JLINK 软件对仿真器进行固件升级了（不会再出现仿真器 Clone 的提示了）。<br>使用 J-Link Configurator，进行固件升级。</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>ARM</tag>
        <tag>JLINK</tag>
      </tags>
  </entry>
  <entry>
    <title>通信接口电平信号</title>
    <url>/2014/05/05/140505-elec-comm/</url>
    <content><![CDATA[<h1 id="RS485"><a href="#RS485" class="headerlink" title="RS485"></a>RS485</h1><p>+2V ～+6V 表示“0”，- 6V ～- 2V 表示“1”。</p>
<h1 id="RS232"><a href="#RS232" class="headerlink" title="RS232"></a>RS232</h1><p>在 TxD 和 RxD 上：<br>逻辑 1(MARK)=-3V ～-15V<br>逻辑 0(SPACE)=+3 ～+15V</p>
<h1 id="TTL-电平"><a href="#TTL-电平" class="headerlink" title="TTL 电平"></a>TTL 电平</h1><p>输出高电平&gt;2.4V,输出低电平&lt;0.4V。在室温下，一般输出高电平是 3.5V，输出低电平是 0.2V。最小输入高电平和低电平：输入高电平&gt;=2.0V，输入低电平&lt;=0.8V，噪声容限是 0.4V。</p>
<h1 id="CMOS-电平"><a href="#CMOS-电平" class="headerlink" title="CMOS 电平"></a>CMOS 电平</h1><p>1 逻辑电平电压接近于电源电压，0 逻辑电平接近于 0V。而且具有很宽的噪声容限。</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>232</tag>
        <tag>485</tag>
        <tag>TTL</tag>
        <tag>CMOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Halcon算子學習——Object</title>
    <url>/2013/04/30/130430-halcon-object/</url>
    <content><![CDATA[<p>Halcon 算子學習——Object<br>1.Information<br>1.1 count_obj — Number of objects in a tuple.</p>
<p>count_obj(Objects : : : Number)<br>統計一個元祖中的對象<br>1.2 get_channel_info — Informations about the components of an image object.</p>
<p>get_channel_info(Object : : Request, Channel : Information)</p>
<p>一副目標圖像組成部份的信息<br>1.3 get_obj_class — Name of the class of an image object.</p>
<p>get_obj_class(Object : : : Class) 1.4 get_image_pointer1 — Access the pointer of a channel.</p>
<p>一副目標圖像類的名稱<br>1.4 test_equal_obj — Compare image objects regarding equality.</p>
<p>test_equal_obj(Objects1, Objects2 : : : IsEqual)<br>比較目標圖像的平等性<br>2.Manipulation（操作）<br>2.1 clear_obj — Delete an iconic object from the HALCON database.</p>
<p>clear_obj(Objects : : : )</p>
<p>刪除 Halcon 數據庫中的圖形對象<br>2.2 concat_obj — Concatenate two iconic object tuples.</p>
<p>concat_obj(Objects1, Objects2 : ObjectsConcat : : )<br>連接兩個目標元組的圖標<br>2.3 copy_obj — Copy an iconic object in the HALCON database.</p>
<p>copy_obj(Objects : ObjectsSelected : Index, NumObj : )<br>複製一個 Halcon 數據庫中的圖標對象<br>2.4 gen_empty_obj — Create an empty object tuple.</p>
<p>gen_empty_obj( : EmptyObject : : )<br>創建一個空的對象數組<br>2.5 integer_to_obj — Convert an “integer number” into an iconic object.</p>
<p>integer_to_obj( : Objects : SurrogateTuple : )<br>轉換一個整數到一個圖形對象<br>2.6 obj_diff — Calculate the difference of two object tuples.</p>
<p>obj_diff(Objects, ObjectsSub : ObjectsDiff : : )<br>計算 2 個對象數組的不同<br>2.7 obj_to_integer — Convert an iconic object into an “integer number.”</p>
<p>obj_to_integer(Objects : : Index, Number : SurrogateTuple)<br>integer_to_obj 的逆運算，將圖形對象轉換為整數<br>2.8 select_obj — Select objects from an object tuple.</p>
<p>select_obj(Objects : ObjectSelected : Index : )<br>從一個對象數組中選擇對象</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
        <tag>Halcon</tag>
      </tags>
  </entry>
  <entry>
    <title>Halcon算子學習——File</title>
    <url>/2013/04/07/130407-halcon-file/</url>
    <content><![CDATA[<p>1.Images（圖像）</p>
<p>1.1 deserialize_image — Deserialize a serialized image object.<br>deserialize_image( : Image : SerializedItemHandle : )<br>圖像反序列化：將一個已經序列化的圖像反序列化<br>1.2 read_image — Read an image with different file formats.<br>read_image( : Image : FileName : )<br>讀取圖像：讀取一張圖（不同格式）<br>1.3 read_sequence — Read images.<br>read_sequence( : Image : HeaderSize, SourceWidth, SourceHeight, StartRow, StartColumn, DestWidth, DestHeight, PixelType, BitOrder, ByteOrder, Pad, Index, FileName : )<br>讀圖<br>1.4 serialize_image— Serialize an image object.<br>serialize_image(Image : : : SerializedItemHandle)<br>圖像序列化：將一張圖序列化<br>1.5 write_image— Write images in graphic formats.<br>write_image(Image : : Format, FillColor, FileName : )<br>保存圖像：將圖像保存<br>2.Misc（混雜）<br>2.1 copy_file — Copy a file to a new location.</p>
<p>copy_file( : : SourceFile, DestinationFile : )<br>文件複製<br>2.2 delete_file — Delete a file.</p>
<p>delete_file( : : FileName : )<br>文件刪除<br>2.3 file_exists — Check whether file exists.</p>
<p>file_exists( : : FileName : FileExists)<br>檢查文件是否存在<br>2.4 list_files — List all files in a directory.</p>
<p>list_files( : : Directory, Options : Files)<br>列出一個目錄中的所有文件<br>2.5 make_dir — Make a directory.</p>
<p>make_dir( : : DirName : )<br>創建一個目錄<br>2.6 read_world_file — Read the geo coding from an ARC/INFO world file.</p>
<p>read_world_file( : : FileName : WorldTransformation)<br>讀取一個 ARC/INFO 文件<br>2.7 remove_dir — Delete an empty directory.</p>
<p>remove_dir( : : DirName : )<br>刪除一個目錄<br>3.Object（對象）<br>3.1 deserialize_object — Deserialize a serialized iconic object.</p>
<p>deserialize_object( : Object : SerializedItemHandle : )<br>反序列化一個圖形變量對象<br>3.2 serialize_object — Serialize an iconic object.</p>
<p>serialize_object(Object : : : SerializedItemHandle)<br>序列化一個圖形變量對象<br>4.Region（像元集）<br>region 即是一堆元的集合。 region 中的像元不一定要相连，如果要让相连接的像元成为一个 region ，只要呼叫运算子 connection 即可。<br>4.1 deserialize_region — Deserialize a serialized region.</p>
<p>deserialize_region( : Region : SerializedItemHandle : )<br>反序列化一個已序列化的 region<br>4.2 read_region — Read binary images or HALCON regions.</p>
<p>read_region( : Region : FileName : )<br>讀二進制圖像或 Halcon regions<br>4.3 serialize_region — Serialize a region.</p>
<p>serialize_region(Region : : : SerializedItemHandle)<br>序列化一個 region<br>4.4 write_region — Write regions to a file.</p>
<p>write_region(Region : : FileName : )<br>保存 regions<br>5.Text（文本）<br>5.1 close_all_files — Close all open files.</p>
<p>close_all_files( : : : )<br>關閉所有打開文件<br>5.2 close_file — Closing a text file.</p>
<p>close_file( : : FileHandle : )<br>關閉一個文本文件<br>5.3 fnew_line — Create a line feed.</p>
<p>fnew_line( : : FileHandle : )<br>創建一行<br>5.4 fread_char — Read a character from a file.</p>
<p>fread_char( : : FileHandle : Char)<br>從一個文件讀一個字符<br>5.5 fread_line — Read a line from a file.</p>
<p>fread_line( : : FileHandle : OutLine, IsEOF)<br>從一個文件讀一行<br>5.6 fread_string — Read strings from a file.</p>
<p>fread_string( : : FileHandle : OutString, IsEOF)<br>從一個文件讀取字符串<br>5.7 fwrite_string — Write values in a file.</p>
<p>fwrite_string( : : FileHandle, String : )<br>寫入文件<br>5.8 open_file — Open a file in ASCII or a binary format.</p>
<p>open_file( : : FileName, FileType : FileHandle)<br>打開文件<br>6.Tuple（數組）<br>Tuples 就像一个数组，其中的数据型态可为整数，浮点数或是字符串。当我们计算一个 region 的某些特征时，会传回一个 结果，如果计算的是一群 region ，会传回一个 tuple ，其中含有每个 region 的特征计算结果。 Control tuple 的指标由０开始。<br>6.1 deserialize_tuple — Deserialize a serialized tuple.</p>
<p>deserialize_tuple( : : SerializedItemHandle : Tuple)<br>反序列化一個已序列化的數組<br>6.2 read_tuple — Read a tuple from a file.</p>
<p>read_tuple( : : FileName : Tuple)<br>從一個文件讀取數組<br>6.3 serialize_tuple — Serialize a tuple.</p>
<p>serialize_tuple( : : Tuple : SerializedItemHandle)<br>序列化一個數組<br>6.4 write_tuple — Write a tuple to a file.</p>
<p>write_tuple( : : Tuple, FileName : )<br>寫數組到一個文件<br>7.XLD（輪廓數據）<br>　　 XLD 包含了所有等值线以及多边型的数据。 XLD 对象中除了点坐标数据，还包含了全域或区域属性，例如 edge 方向，或是分割时的 regression 参数等等。<br>7.1 deserialize_xld — Deserialize a serialized XLD object.</p>
<p>deserialize_xld( : XLD : SerializedItemHandle : )<br>反序列化一個已序列化的 XLD<br>7.2 read_contour_xld_arc_info — Read XLD contours to a file in ARC/INFO generate format.</p>
<p>read_contour_xld_arc_info( : Contours : FileName : )<br>從一個 ARC/INFO 文件讀取 XLD 輪廓<br>7.3 read_contour_xld_dxf — Read XLD contours from a DXF file.</p>
<p>read_contour_xld_dxf( : Contours : FileName, GenParamNames, GenParamValues : DxfStatus)<br>從一個 DXF 文件讀取 XLD 輪廓<br>7.4 read_polygon_xld_arc_info — Read XLD polygons from a file in ARC/INFO generate format.</p>
<p>read_polygon_xld_arc_info( : Polygons : FileName : )<br>從一個 ARC/INFO 文件讀取 XLD 多邊形<br>7.5 read_polygon_xld_dxf — Read XLD polygons from a DXF file.</p>
<p>read_polygon_xld_dxf( : Polygons : FileName, GenParamNames, GenParamValues : DxfStatus)<br>從一個 DXF 文件讀取 XLD 輪廓<br>7.6 serialize_xld — Serialize an XLD object.</p>
<p>serialize_xld(XLD : : : SerializedItemHandle)<br>序列化一個 XLD<br>7.7 write_contour_xld_arc_info — Write XLD contours to a file in ARC/INFO generate format.</p>
<p>write_contour_xld_arc_info(Contours : : FileName : )<br>將 XLD 輪廓寫入 ARC/INFO 文件<br>7.8 write_contour_xld_dxf — Write XLD contours to a file in DXF format.</p>
<p>write_contour_xld_dxf(Contours : : FileName : )<br>將 XLD 輪廓寫入 DXF 文件<br>7.9 write_polygon_xld_arc_info — Write XLD polygons to a file in ARC/INFO generate format.</p>
<p>write_polygon_xld_arc_info(Polygons : : FileName : )<br>將 XLD 多邊形寫入 ARC/INFO 文件<br>7.10 write_polygon_xld_dxf — Write XLD polygons to a file in DXF format.</p>
<p>write_polygon_xld_dxf(Polygons : : FileName : )<br>將 XLD 多邊形寫入 DXF 文件</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
        <tag>Halcon</tag>
      </tags>
  </entry>
  <entry>
    <title>Halcon算子學習——image</title>
    <url>/2013/04/07/130407-halcon-image/</url>
    <content><![CDATA[<p>1.Access (取出)<br>1.1 get_grayval — Access the gray values of an image object.</p>
<p>get_grayval(Image : : Row, Column : Grayval)<br>獲取圖像中一點的灰度值<br>1.2 get_grayval_contour_xld — Return gray values of an image at the positions of an XLD contour.</p>
<p>get_grayval_contour_xld(Image, Contour : : Interpolation : Grayval)<br>返回一張圖中 XLD 輪廓位置的灰度值（需要先行生成 XLD）<br>XLD(eXtended Line Description 的縮寫)<br>Interpolation（插補）：nearest_neighbor、bilinear、bicubic 和 bicubic_clipped<br>1.3 get_grayval_interpolated — Return gray values of an image at the positions given by tuples of rows and columns.</p>
<p>get_grayval_interpolated(Image : : Row, Column, Interpolation : Grayval)<br>返回一張圖中給定的行列數組位置的灰度值（無需生成 XLD）<br>1.4 get_image_pointer1 — Access the pointer of a channel.</p>
<p>get_image_pointer1(Image : : : Pointer, Type, Width, Height)<br>返回圖像第一通道的指針。<br>1.5 get_image_pointer1_rect — Access to the image data pointer and the image data inside the smallest rectangle of the domain of the input image.</p>
<p>get_image_pointer1_rect(Image : : : PixelPointer, Width, Height, VerticalPitch, HorizontalBitPitch, BitsPerPixel)<br>獲取圖像矩形域的指針<br>1.6 get_image_pointer3 — Access the pointers of a colored image.</p>
<p>get_image_pointer3(ImageRGB : : : PointerRed, PointerGreen, PointerBlue, Type, Width, Height)<br>獲取彩色圖像的指針<br>1.7 get_image_size — Return the size of an image.</p>
<p>get_image_size(Image : : : Width, Height)<br>獲取圖像 size<br>1.8 get_image_time — Request time at which the image was created.</p>
<p>get_image_time(Image : : : MSecond, Second, Minute, Hour, Day, YDay, Month, Year)<br>獲取圖像生成時間<br>1.9 get_image_type — Return the type of an image.</p>
<p>get_image_type(Image : : : Type)<br>獲取圖像類型</p>
<p>2.Acquisition（抓取）<br>2.1 close_all_framegrabbers — Close all image acquisition devices.</p>
<p>close_all_framegrabbers( : : : )<br>關閉所有圖像獲取設備<br>2.2 close_framegrabber — Close specified image acquisition device.</p>
<p>close_framegrabber( : : AcqHandle : )<br>關閉指定圖像獲取設備<br>2.3 get_framegrabber_callback — Query callback function of an image acquisition device.</p>
<p>get_framegrabber_callback( : : AcqHandle, CallbackType : CallbackFunction, UserContext)<br>查詢圖像獲取設備的囘調函數<br>2.4 get_framegrabber_lut — Query look-up table of the image acquisition device.</p>
<p>get_framegrabber_lut( : : AcqHandle : ImageRed, ImageGreen, ImageBlue)<br>查詢圖像獲取設備的查找表。<br>2.5 get_framegrabber_param — Query specific parameters of an image acquisition device.</p>
<p>get_framegrabber_param( : : AcqHandle, Param : Value)<br>查詢圖像獲取設備的指定參數<br>2.6 grab_data — Synchronous grab of images and preprocessed image data from the specified image acquisition device.</p>
<p>grab_data( : Image, Region, Contours : AcqHandle : Data)<br>2.7 grab_data_async — Asynchronous grab of images and preprocessed image data from the specified image acquisition device.</p>
<p>grab_data_async( : Image, Region, Contours : AcqHandle, MaxDelay : Data)<br>2.8 grab_image — Synchronous grab of an image from the specified image acquisition device.</p>
<p>grab_image( : Image : AcqHandle : )<br>2.9 grab_image_async — Asynchronous grab of an image from the specified image acquisition device.</p>
<p>grab_image_async( : Image : AcqHandle, MaxDelay : )<br>2.10 grab_image_start — Start an asynchronous grab from the specified image acquisition device.</p>
<p>grab_image_start( : : AcqHandle, MaxDelay : )<br>2.11 info_framegrabber — Query information about the specified image acquisition interface.</p>
<p>info_framegrabber( : : Name, Query : Information, ValueList)<br>2.12 open_framegrabber — Open and configure an image acquisition device.</p>
<p>open_framegrabber( : : Name, HorizontalResolution, VerticalResolution, ImageWidth, ImageHeight, StartRow, StartColumn, Field, BitsPerChannel, ColorSpace, Generic, ExternalTrigger, CameraType, Device, Port, LineIn : AcqHandle)<br>2.13 set_framegrabber_callback — Register a callback function for an image acquisition device.</p>
<p>set_framegrabber_callback( : : AcqHandle, CallbackType, CallbackFunction, UserContext : )<br>2.14 set_framegrabber_lut — Set look-up table of the image acquisition device.</p>
<p>set_framegrabber_lut( : : AcqHandle, ImageRed, ImageGreen, ImageBlue : )<br>2.15 set_framegrabber_param — Set specific parameters of an image acquistion device.</p>
<p>set_framegrabber_param( : : AcqHandle, Param, Value : )<br>3.Channel（通道）<br>3.1 access_channel — Access a channel of a multichannel image.</p>
<p>access_channel(MultiChannelImage : Image : Channel : )<br>取出一張多通道圖像中的一個通道<br>3.2 append_channel — Append additional matrices (channels) to the image.</p>
<p>append_channel(MultiChannelImage, Image : ImageExtended : : )<br>追加通道到圖像<br>3.3 channels_to_image — Convert one-channel images into a multichannel image</p>
<p>channels_to_image(Images : MultiChannelImage : : )<br>將多個單通道圖像轉化為一個多通道圖像<br>3.4 compose2 — Convert two images into a two-channel image.</p>
<p>compose2(Image1, Image2 : MultiChannelImage : : )<br>將兩張圖像轉化到一個雙通道圖像<br>3.5 compose3 — Convert 3 images into a three-channel image.</p>
<p>compose3(Image1, Image2, Image3 : MultiChannelImage : : )<br>將三張圖轉化為一個 3 通道圖<br>3.6 compose4 — Convert 4 images into a four-channel image.</p>
<p>compose4(Image1, Image2, Image3, Image4 : MultiChannelImage : : )<br>3.7 compose5 — Convert 5 images into a five-channel image.</p>
<p>compose5(Image1, Image2, Image3, Image4, Image5 : MultiChannelImage : : )<br>3.8 compose6 — Convert 6 images into a six-channel image.</p>
<p>compose6(Image1, Image2, Image3, Image4, Image5, Image6 : MultiChannelImage : : )<br>3.9 compose7 — Convert 7 images into a seven-channel image.</p>
<p>compose7(Image1, Image2, Image3, Image4, Image5, Image6, Image7 : MultiChannelImage : : )<br>3.10 count_channels — Count channels of image.</p>
<p>count_channels(MultiChannelImage : : : Channels)<br>計算出圖像的通道數<br>3.11 decompose2 — Convert a two-channel image into two images.</p>
<p>decompose2(MultiChannelImage : Image1, Image2 : : )<br>將一個雙通道圖像轉化為兩張圖像<br>3.12 decompose3 — Convert a three-channel image into three images.</p>
<p>decompose3(MultiChannelImage : Image1, Image2, Image3 : : )<br>3.13 decompose4 — Convert a four-channel image into four images.</p>
<p>decompose4(MultiChannelImage : Image1, Image2, Image3, Image4 : : )<br>3.14 decompose5 — Convert a five-channel image into five images.</p>
<p>decompose5(MultiChannelImage : Image1, Image2, Image3, Image4, Image5 : : )</p>
<p>3.15 decompose6 — Convert a six-channel image into six images.</p>
<p>decompose6(MultiChannelImage : Image1, Image2, Image3, Image4, Image5, Image6 : : )<br>3.16 decompose7 — Convert a seven-channel image into seven images.</p>
<p>decompose7(MultiChannelImage : Image1, Image2, Image3, Image4, Image5, Image6, Image7 : : )<br>3.17 image_to_channels — Convert a multichannel image into One-channel images</p>
<p>image_to_channels(MultiChannelImage : Images : : )<br>將一個多通道圖像轉化為單通道圖像數組<br>4.Creation（創立，生成）<br>4.1 copy_image — Copy an image and allocate new memory for it.</p>
<p>copy_image(Image : DupImage : : )<br>將一張圖像拷貝到新內存<br>4.2 gen_image1 — Create an image from a pointer to the pixels.</p>
<p>gen_image1( : Image : Type, Width, Height, PixelPointer : )<br>從像素指針生成圖像<br>4.3 gen_image1_extern — Create an image from a pointer on the pixels with storage management.</p>
<p>gen_image1_extern( : Image : Type, Width, Height, PixelPointer, ClearProc : )<br>4.4 gen_image1_rect — Create an image with a rectangular domain from a pointer on the pixels (with storage management).</p>
<p>gen_image1_rect( : Image : PixelPointer, Width, Height, VerticalPitch, HorizontalBitPitch, BitsPerPixel, DoCopy, ClearProc : )<br>4.5 gen_image3 — Create an image from three pointers to the pixels (red/green/blue).</p>
<p>gen_image3( : ImageRGB : Type, Width, Height, PixelPointerRed, PixelPointerGreen, PixelPointerBlue : )<br>4.6 gen_image3_extern — Create a three-channel image from three pointers on the pixels with storage management.</p>
<p>gen_image3_extern( : Image : Type, Width, Height, PointerRed, PointerGreen, PointerBlue, ClearProc : )<br>4.7 gen_image_const — Create an image with constant gray value.</p>
<p>gen_image_const( : Image : Type, Width, Height : )<br>以一個灰度常量創建圖像<br>4.8 gen_image_gray_ramp — Create a gray value ramp.</p>
<p>gen_image_gray_ramp( : ImageGrayRamp : Alpha, Beta, Mean, Row, Column, Width, Height : )<br>創建一個灰度斜面圖像</p>
<p>4.9 gen_image_interleaved — Create a three-channel image from a pointer to the interleaved pixels.</p>
<p>gen_image_interleaved( : ImageRGB : PixelPointer, ColorFormat, OriginalWidth, OriginalHeight, Alignment, Type, ImageWidth, ImageHeight, StartRow, StartColumn, BitsPerChannel, BitShift : )<br>4.10 gen_image_proto — Create an image with a specified constant gray value.</p>
<p>gen_image_proto(Image : ImageCleared : Grayval : )<br>以一個灰度值創建圖像，圖像 size 源於輸入參數 Image<br>4.11 gen_image_surface_first_order — Create a tilted gray surface with first order polynomial.</p>
<p>gen_image_surface_first_order( : ImageSurface : Type, Alpha, Beta, Gamma, Row, Col, Width, Height : )<br>4.12 gen_image_surface_second_order — Create a curved gray surface with second order polynomial.</p>
<p>gen_image_surface_second_order( : ImageSurface : Type, Alpha, Beta, Gamma, Delta, Epsilon, Zeta, Row, Col, Width, Height : )<br>4.13 region_to_bin — Convert a region into a binary byte-image.</p>
<p>region_to_bin(Region : BinImage : ForegroundGray, BackgroundGray, Width, Height : )<br>4.14 region_to_label — Convert regions to a label image.</p>
<p>region_to_label(Region : ImageLabel : Type, Width, Height : )<br>4.15 region_to_mean — Paint regions with their average gray value.</p>
<p>region_to_mean(Regions, Image : ImageMean : : )<br>5.Domain（範圍）<br>5.1 add_channels — Add gray values to regions.</p>
<p>add_channels(Regions, Image : GrayRegions : : )<br>添加灰度值到 region 區域<br>5.2 change_domain — Change definition domain of an image.</p>
<p>change_domain(Image, NewDomain : ImageNew : : )<br>改變圖像的定義範圍<br>5.3 full_domain — Expand the domain of an image to maximum.</p>
<p>full_domain(Image : ImageFull : : )<br>擴散圖像範圍<br>5.4 get_domain — Get the domain of an image.</p>
<p>get_domain(Image : Domain : : )<br>獲取圖像範圍<br>5.5 rectangle1_domain — Reduce the domain of an image to a rectangle.</p>
<p>rectangle1_domain(Image : ImageReduced : Row1, Column1, Row2, Column2 : )<br>去除圖像的方形範圍<br>5.6 reduce_domain — Reduce the domain of an image.</p>
<p>reduce_domain(Image, Region : ImageReduced : : )<br>去除圖像範圍<br>6.Features（特徵）</p>
<p>6.1 area_center_gray — Compute the area and center of gravity of a region in a gray value image.</p>
<p>area_center_gray(Regions, Image : : : Area, Row, Column)<br>計算灰度圖像中 region 的面積和中心點<br>6.2 cooc_feature_image — Calculate a co-occurrence matrix and derive gray value features thereof.</p>
<p>cooc_feature_image(Regions, Image : : LdGray, Direction : Energy, Correlation, Homogeneity, Contrast)<br>計算一個同時出現的矩陣并得出相關灰度值特徵。<br>6.3 cooc_feature_matrix — Calculate gray value features from a co-occurrence matrix.</p>
<p>cooc_feature_matrix(CoocMatrix : : : Energy, Correlation, Homogeneity, Contrast)<br>從一個同時出現的矩陣計算灰度值特徵<br>6.4 elliptic_axis_gray — Compute the orientation and major axes of a region in a gray value image.</p>
<p>elliptic_axis_gray(Regions, Image : : : Ra, Rb, Phi)<br>在一個灰度值圖像中計算一個區域的方位和主軸。<br>6.5 entropy_gray — Determine the entropy and anisotropy of images.</p>
<p>entropy_gray(Regions, Image : : : Entropy, Anisotropy)<br>確定一個圖像的熵和各向異性。<br>6.6 estimate_noise — Estimate the image noise from a single image.</p>
<p>estimate_noise(Image : : Method, Percent : Sigma)<br>從一個單一圖像估計圖像噪聲<br>6.7 fit_surface_first_order — Calculate gray value moments and approximation by a first order surface (plane).</p>
<p>fit_surface_first_order(Regions, Image : : Algorithm, Iterations, ClippingFactor : Alpha, Beta, Gamma)<br>通過一個一階表面（平面）計算灰度值力矩和近似值。<br>6.8 fit_surface_second_order — Calculate gray value moments and approximation by a second order surface.</p>
<p>fit_surface_second_order(Regions, Image : : Algorithm, Iterations, ClippingFactor : Alpha, Beta, Gamma, Delta, Epsilon, Zeta)<br>通過一個二階表面（平面）計算灰度值力矩和近似值。<br>6.9 fuzzy_entropy — Determine the fuzzy entropy of regions.</p>
<p>fuzzy_entropy(Regions, Image : : Apar, Cpar : Entropy)<br>確定區域的模糊熵<br>6.10 fuzzy_perimeter — Calculate the fuzzy perimeter of a region.</p>
<p>fuzzy_perimeter(Regions, Image : : Apar, Cpar : Perimeter)<br>計算一個區域的模糊周長<br>6.11 gen_cooc_matrix — Calculate the co-occurrence matrix of a region in an image.</p>
<p>gen_cooc_matrix(Regions, Image : Matrix : LdGray, Direction : )<br>在一個圖像中計算一個區域中同時出現的矩陣<br>6.12 gray_features — Calculates gray value features for a set of regions.</p>
<p>gray_features(Regions, Image : : Features : Value)<br>計算一個設置區域的灰度值特徵<br>6.13 gray_histo — Calculate the gray value distribution.</p>
<p>gray_histo(Regions, Image : : : AbsoluteHisto, RelativeHisto)<br>計算灰度值分佈<br>6.14 gray_histo_abs — Calculate the gray value distribution.</p>
<p>gray_histo_abs(Regions, Image : : Quantization : AbsoluteHisto)<br>計算灰度值分佈<br>6.15 gray_histo_range — Calculate the gray value distribution of a single channel image within a certain gray value range.</p>
<p>gray_histo_range(Regions, Image : : Min, Max, NumBins : Histo, BinSize)<br>計算一個單通道圖像在一定灰度值範圍內的灰度值分佈<br>6.16 gray_projections — Calculate horizontal and vertical gray-value projections.</p>
<p>gray_projections(Region, Image : : Mode : HorProjection, VertProjection)<br>計算水平和垂直灰度值預測<br>6.17 histo_2dim — Calculate the histogram of two-channel gray value images.</p>
<p>histo_2dim(Regions, ImageCol, ImageRow : Histo2Dim : : )<br>計算兩通道灰度值圖像的直方圖<br>6.18 intensity — Calculate the mean and deviation of gray values.</p>
<p>intensity(Regions, Image : : : Mean, Deviation)<br>計算灰度值的平均值和偏差<br>6.19 min_max_gray — Determine the minimum and maximum gray values within regions.</p>
<p>min_max_gray(Regions, Image : : Percent : Min, Max, Range)<br>計算區域內的最大和最小灰度值<br>6.20 moments_gray_plane — Calculate gray value moments and approximation by a plane.</p>
<p>moments_gray_plane(Regions, Image : : : MRow, MCol, Alpha, Beta, Mean)<br>通過一個平面計算灰度值力矩和近似值<br>6.21 plane_deviation — Calculate the deviation of the gray values from the approximating image plane.</p>
<p>plane_deviation(Regions, Image : : : Deviation)<br>從近似像平面計算灰度值的偏差<br>6.22 select_gray — Select regions based on gray value features.</p>
<p>select_gray(Regions, Image : SelectedRegions : Features, Operation, Min, Max : )<br>基於灰度值特徵選擇區域<br>6.23 shape_histo_all — Determine a histogram of features along all threshold values.</p>
<p>shape_histo_all(Region, Image : : Feature : AbsoluteHisto, RelativeHisto)<br>通過閾值確定一個特徵直方圖<br>6.24 shape_histo_point — Determine a histogram of features along all threshold values.</p>
<p>shape_histo_point(Region, Image : : Feature, Row, Column : AbsoluteHisto, RelativeHisto)<br>通過閾值確定一個特徵直方圖<br>7.Format（格式）<br>7.1 change_format — Change image size.</p>
<p>change_format(Image : ImagePart : Width, Height : )<br>改變圖像的 size<br>7.2 crop_domain — Cut out of defined gray values.</p>
<p>crop_domain(Image : ImagePart : : )<br>去除指定的灰度值<br>7.3 crop_domain_rel — Cut out an image area relative to the domain.</p>
<p>crop_domain_rel(Image : ImagePart : Top, Left, Bottom, Right : )<br>去除和定義域有關的圖像區域<br>7.4 crop_part — Cut out a rectangular image area.</p>
<p>crop_part(Image : ImagePart : Row, Column, Width, Height : )<br>去除一個矩形圖像區域<br>7.5 crop_rectangle1 — Cut out a rectangular image area.</p>
<p>crop_rectangle1(Image : ImagePart : Row1, Column1, Row2, Column2 : )<br>去除一個矩形圖像區域（矩形的選擇與 crop_part 不同）<br>7.6 tile_channels — Tile multiple images into a large image.</p>
<p>tile_channels(Image : TiledImage : NumColumns, TileOrder : )<br>把多重圖像拼成一個大圖像<br>7.7 tile_images — Tile multiple image objects into a large image.</p>
<p>tile_images(Images : TiledImage : NumColumns, TileOrder : )<br>把多重圖像目標拼成一個大圖像<br>7.8 tile_images_offset — Tile multiple image objects into a large image with explicit positioning information.</p>
<p>tile_images_offset(Images : TiledImage : OffsetRow, OffsetCol, Row1, Col1, Row2, Col2, Width, Height : )<br>把多重圖像目標拼成一個有確定的位置信息的大圖像<br>8.Manipulation（操作）<br>8.1 overpaint_gray — Overpaint the gray values of an image.</p>
<p>overpaint_gray(ImageDestination, ImageSource : : : )<br>重新繪製一個圖像的灰度值<br>8.2 overpaint_region — Overpaint regions in an image.</p>
<p>overpaint_region(Image, Region : : Grayval, Type : )<br>重新繪製一個圖像的區域<br>8.3 paint_gray — Paint the gray values of an image into another image.</p>
<p>paint_gray(ImageSource, ImageDestination : MixedImage : : )<br>把一個圖像的灰度值畫在另一個圖像上<br>8.4 paint_region — Paint regions into an image.</p>
<p>paint_region(Region, Image : ImageResult : Grayval, Type : )<br>把區域畫在一個圖像中<br>8.5 paint_xld — Paint XLD objects into an image.</p>
<p>paint_xld(XLD, Image : ImageResult : Grayval : )<br>把 XLD 目標化在一個圖像中<br>8.6 set_grayval — Set single gray values in an image.</p>
<p>set_grayval(Image : : Row, Column, Grayval : )<br>在一個圖像中設置一個點的灰度值<br>9.Type Conversion（類型轉換）<br>9.1 complex_to_real — Convert a complex image into two real images.</p>
<p>complex_to_real(ImageComplex : ImageReal, ImageImaginary : : )<br>把一個複數圖像轉化為兩個圖像（一個是實部，另一個是虛部，可參考 z=a+bi）<br>9.2 convert_image_type — Convert the type of an image.</p>
<p>convert_image_type(Image : ImageConverted : NewType : )<br>轉換圖像類型<br>NewType (input_control) string → (string)</p>
<p>Desired image type (i.e., type of the gray values).</p>
<p>Default value: ‘byte’</p>
<p>List of values: ‘int1’, ‘int2’, ‘uint2’, ‘int4’, ‘int8’, ‘byte’, ‘real’, ‘direction’, ‘cyclic’, ‘complex’</p>
<p>List of values (for compute devices): ‘int1’, ‘int2’, ‘uint2’, ‘int4’, ‘byte’, ‘real’, ‘direction’, ‘cyclic’, ‘complex’<br>9.3 real_to_complex — Convert two real images into a complex image.</p>
<p>real_to_complex(ImageReal, ImageImaginary : ImageComplex : : )<br>將兩個圖像（實部和虛部）轉換為一個複數圖像，complex_to_real 的逆運算<br>9.4 real_to_vector_field — Convert two real-valued images into a vector field image.</p>
<p>real_to_vector_field(Row, Col : VectorField : Type : )<br>把兩個實值圖像轉換為一個矢量域圖像<br>9.5 vector_field_to_real — Convert a vector field image into two real-valued images.</p>
<p>vector_field_to_real(VectorField : Row, Col : : )<br>real_to_vector_field 的逆運算</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
        <tag>Halcon</tag>
      </tags>
  </entry>
  <entry>
    <title>基於快速傅利葉變換的瑕疵檢測</title>
    <url>/2013/04/07/130407-image-fft-flaw/</url>
    <content><![CDATA[<ul>
<li><p>This program demonstrates how to detect small texture</p>
</li>
<li><p>defects on the surface of plastic items by using the fast</p>
</li>
<li><p>fourier transform (FFT).</p>
</li>
<li><p>First, we construct a suitable filter using Gaussian</p>
</li>
<li><p>filters. Then, the images and the filter are convolved</p>
</li>
<li><p>by using fast fourier transforms. Finally, the defects</p>
</li>
<li><p>are detected in the filtered images by using</p>
</li>
<li><p>morphology operators.</p>
</li>
</ul>
<p>這個程序是通過 FFT 來檢測物體表面的瑕疵。首先，我們要用高斯濾波器來構造一個合適的濾波器。然後，圖像和濾波器通過 FFT 被轉換。最後通過形態學操作在被濾波的圖像上進行檢測。</p>
<p>-</p>
<ul>
<li>Initializations</li>
</ul>
<p>初始化</p>
<p>dev_update_off ()</p>
<p>dev_close_window ()</p>
<p>read_image (Image, ‘plastics/plastics_01’)</p>
<p>get_image_size (Image, Width, Height)</p>
<p>dev_open_window (0, 0, Width, Height, ‘black’, WindowHandle)</p>
<p>set_display_font (WindowHandle, 14, ‘mono’, ‘true’, ‘false’)</p>
<p>dev_set_draw (‘margin’)</p>
<p>dev_set_line_width (3)</p>
<p>dev_set_color (‘red’)</p>
<p>-</p>
<ul>
<li>Optimize the fft speed for the specific image size</li>
</ul>
<p>為特殊圖像尺寸定制 FFT 速度。</p>
<p>optimize_rft_speed (Width, Height, ‘standard’)</p>
<p>-</p>
<ul>
<li><p>Construct a suitable filter by combining two gaussian</p>
</li>
<li><p>filters</p>
</li>
</ul>
<p>通過 2 個高斯濾波器來構造一個合適的濾波器</p>
<p>Sigma1 := 10.0</p>
<p>Sigma2 := 3.0</p>
<p>gen_gauss_filter (GaussFilter1, Sigma1, Sigma1, 0.0, ‘none’, ‘rft’, Width, Height)</p>
<p>gen_gauss_filter (GaussFilter2, Sigma2, Sigma2, 0.0, ‘none’, ‘rft’, Width, Height)</p>
<p>sub_image (GaussFilter1, GaussFilter2, Filter, 1, 0)</p>
<p>-</p>
<ul>
<li>Process the images iteratively</li>
</ul>
<p>重複處理圖像</p>
<p>NumImages := 11</p>
<p>for Index := 1 to NumImages by 1</p>
<pre><code>*</code></pre><ul>
<li>Read an image and convert it to gray values</li>
</ul>
<p>讀取圖像并轉化為灰度圖像</p>
<pre><code>read_image (Image, &apos;plastics/plastics_&apos; + Index$&apos;02&apos;)</code></pre><p>rgb1_to_gray (Image, Image)</p>
<ul>
<li>Perform the convolution in the frequency domain</li>
</ul>
<p>在頻率域生成捲積</p>
<pre><code>rft_generic (Image, ImageFFT, &apos;to_freq&apos;, &apos;none&apos;, &apos;complex&apos;, Width)

convol_fft (ImageFFT, Filter, ImageConvol)

rft_generic (ImageConvol, ImageFiltered, &apos;from_freq&apos;, &apos;n&apos;, &apos;real&apos;, Width)

*</code></pre><ul>
<li>Process the filtered image</li>
</ul>
<p>處理被濾波圖像</p>
<pre><code>gray_range_rect (ImageFiltered, ImageResult, 11, 11)

min_max_gray (ImageResult, ImageResult, 0, Min, Max, Range)

threshold (ImageResult, RegionDynThresh, max([5.55,Max * 0.8]), 255)

connection (RegionDynThresh, ConnectedRegions)

select_shape (ConnectedRegions, SelectedRegions, &apos;area&apos;, &apos;and&apos;, 4, 99999)

union1 (SelectedRegions, RegionUnion)

closing_circle (RegionUnion, RegionClosing, 10)

connection (RegionClosing, ConnectedRegions1)

select_shape (ConnectedRegions1, SelectedRegions1, &apos;area&apos;, &apos;and&apos;, 10, 99999)

area_center (SelectedRegions1, Area, Row, Column)

*</code></pre><ul>
<li>Display the results</li>
</ul>
<p>顯示結果</p>
<pre><code>dev_display (Image)

Number := |Area|

if (Number)

    gen_circle_contour_xld (ContCircle, Row, Column, gen_tuple_const(Number,30), gen_tuple_const(Number,0), gen_tuple_const(Number,rad(360)), &apos;positive&apos;, 1)

    ResultMessage := [&apos;Not OK&apos;,Number + &apos; defect(s) found&apos;]

    Color := [&apos;red&apos;,&apos;black&apos;]

    dev_display (ContCircle)

else

    ResultMessage := &apos;OK&apos;

    Color := &apos;forest green&apos;

endif

disp_message (WindowHandle, ResultMessage, &apos;window&apos;, 12, 12, Color, &apos;true&apos;)

if (Index != NumImages)

    disp_continue_message (WindowHandle, &apos;black&apos;, &apos;true&apos;)

    stop ()

endif</code></pre><p>endfor</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
        <tag>Halcon</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像的代數運算</title>
    <url>/2013/03/20/130220-algebra-transform/</url>
    <content><![CDATA[<ol>
<li><p>概念<br>代数运算是指两幅输入图像之间进行点对点的加、减、乘、除运算得到输出图像的过程。<br>如果记输入图像为 A(x,y)和 B(x,y)，输出图像为 C(x,y)，则有如下四种形式：<br>(1) C(x,y) = A(x,y)+ B(x,y)<br>(2) C(x,y) = A(x,y)- B(x,y)<br>(3) C(x,y) = A(x,y)×B(x,y)<br>(4) C(x,y) = A(x,y)/B(x,y)</p>
</li>
<li><p>加运算<br>2.1 去除“叠加性”噪音<br>对于原图象 f(x,y),有一个噪音图像集 { g i (x ,y) } i =1,2,…M 其中：g i (x ,y) = f(x,y) + h(x,y)iM 个图像的均值定义为：g(x,y) = 1/M (g0(x,y)+g1(x,y)+…+ g M (x ,y))<br>当：噪音 h(x,y)i 为互不相关，且均值为 0 时，上述图象均值将降低噪音的影响。</p>
<p>2.2 生成图象叠加效果<br>可以得到各种图像合成的效果，也可以用于两张图片的衔接。</p>
</li>
<li><p>減運算<br>3.1 消除背景影响<br>即去除不需要的叠加性图案<br>设：背景图像 b(x ,y)，前景背景混合图像 f(x ,y) g(x,y)=f(x,y)–b(x,y) g(x,y) 为去除了背景图像<br>3.2 差影法<br>指把同一景物在不同时间拍摄的图像或同一景物在不同波段的图像相减;<br>差值图像提供了图像间的差异信息，能用于指导动态监测、运动目标检测和跟踪、图像背景消除及目标识别等。<br>差影法在自动现场监测中的应用<br>在银行金库内，摄像头每隔一固定时间拍摄一幅图像，并与上一幅图像做差影，如果图像差别超过了预先设置的阈值，则表明可能有异常情况发生，应自动或以某种方式报警；用于遥感图像的动态监测，差值图像可以发现森林火灾、洪水泛滥，监测灾情变化等；也可用于监测河口、海岸的泥沙淤积及监视江河、湖泊、海岸等的污染；利用差值图像还能鉴别出耕地及不同的作物覆盖情况。<br>应用举例：<br>(a)差影法可以用于混合图像的分离<br>(b) 检测同一场景两幅图像之间的变化<br>3.3 图像的减法运算也可应用于求图像梯度函数<br>應用：梯度幅度在边缘处很高；在均匀的肌肉纤维的内部，梯度幅度很低。</p>
</li>
<li><p>乘运算<br>图像的局部显示（利用掩膜圖像來獲得感興趣物體）</p>
</li>
<li><p>除运算<br>常用于遥感图像处理中</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像平滑</title>
    <url>/2013/02/27/130227-image-smooth/</url>
    <content><![CDATA[<p>图像在传输过程中，由于传输信道、采样系统质量较差，或受各种干扰的影响，而造成图像毛糙，此时，就需对图像进行平滑处理。<br>图像平滑包括空域法和頻域法兩大類。在空域法中，圖像平滑的常用方法是均值濾波（平滑線性濾波器）或中值濾波（統計排序濾波器、非線性），而在頻域法中則設計各種頻率濾波器進行低通濾波處理。<br>一般我們說圖像平滑主要指空域法的圖像平滑。<br>平滑滤波对图像的低频分量进行增强，同时可以削弱图像的高频分量，因此一般用于消除图像中的随机噪声，从而起到图像平滑的作用。常用方法：均值濾波和中值滤波法。對於均值濾波採用一個有奇數點的滑動窗口在圖像上滑動，窗口中心點所對應像素的灰度值用窗口內所有像素的平均值代替，在取均值過程中，如果窗口規定了各個像素點所占的權重，也就是各個像素點的係數，則成為加權均值濾波，對於中值濾波，窗口中心點所對應像素的灰度值用窗口內所有像素的中間值代替。</p>
<ol>
<li>均值滤波（邻域平均法）<br>邻域平均法是简单的空域处理方法。这种方法的基本思想是用几个像素灰度的平均来代替一个像素原来的灰度值，实现图像的平滑。<br>邻域平均法常见的方法有：简单平均法、邻域加权平均方法。</li>
<li>中值滤波<br>均值滤波属于低通滤波的处理方法。它在抑制噪声的同时使图像变得模糊，即图像的细节(例如边缘信息)被削弱，如果既要抑制噪声又要保持细节可以使用中值滤波。<br>中值濾波是一種非線性的信號處理方法，與其對應的中值濾波器也是一種非線性的濾波器。中值濾波對數字圖像進行處理可以直觀地認為在圖像畫面中開一個窗口（可以為 3<em>3、5</em>5 窗口），它應該包含奇數個像素，按像素的灰度值從小到大排列起來，然後用中間的灰度值來代替原排列的中心值。<br>中值濾波的特性：<br> (1) 对大的边缘高度，中值滤波较邻域均值好得多，而对于较小边缘高度，两种滤波只有很少差别。<br>（2） 中值滤波是非线性的。<br>（3） 中值滤波在抑制图像随机脉冲噪声方面甚为有效。且运算速度快，便于实时处理。<br>（4） 中值滤波去除孤立线或点干扰，而保留空间清晰度较平滑滤波为好；但对高斯噪声则不如平滑滤波。</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像銳化</title>
    <url>/2013/02/27/130227-image-sharpening/</url>
    <content><![CDATA[<p>銳化處理的主要目的是突出圖像中的細節或者增強被模糊了的細節，這種模糊不是由於錯誤操作，就是特殊圖像獲取方法的固有影響。<br>在空間域用像素領域平均法可以使圖像模糊，均值處理與積分相類似，而銳化處理可以用空間微分來完成，來增強圖像邊緣和其他突變并削弱灰度變化緩慢區域。<br>從頻率域來考慮，圖像模糊的實質是因為其高頻分量被衰減，因此可以用高通濾波器來使圖像變得清晰。圖像銳化常採用的有微分運算和頻域高通濾波法，這裡主要針對微分運算法。<br>能夠進行銳化處理的圖像必須要求有較高的信噪比，否則圖像銳化后，圖像信噪比更低，因為銳化會使噪聲收到比信號還強的增強，必須謹慎處理。一般先去除或減輕干擾噪聲后，才能進行銳化處理。<br>微分運算法主要有梯度法和拉普拉斯算子。 1.基於一階微分的圖像增強——梯度法<br>對於圖像 f(x,y)，它的梯度是一個矢量，表示為</p>
<p>這個向量的模值有下式給出：</p>
<p>在實際操作中，常用絕對值代替平方與平方根運算近似梯度的模值：</p>
<p>這個公式計算起來較為簡單並且保持有灰度的相對變化，但各向同性特性通常就不存在了。</p>
<p>對數字圖像而言，用微分運算不方便，一般用查分運算來近似，常用的差分有：</p>
<p>2.基於二階微分的圖像增強——拉普拉斯算子<br>對一個連續函數 f(x,y),它在位置(x,y)的拉普拉斯值定義如下：</p>
<p>在數字圖像中，計算函數的拉普拉斯值也可借助各種模板實現。常用的兩種如下:</p>
<p>3.圖像銳化算法主要包括三方面內容：</p>
<p>3.1 選取合適的梯度算子（拉普拉斯、羅伯茨、索貝爾）</p>
<p>3.2 根據所選用的梯度算子對圖像各點的灰度值進行計算，得出各像素點的梯度值<br>3.3 根據各像素點的梯度值選取合適的處理方法（使用梯度替換原灰度還是重新置為其他值）</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像的幾何變換（幾何運算）</title>
    <url>/2013/02/17/130217-geometry-transform/</url>
    <content><![CDATA[<ol>
<li><p>基礎<br>圖像的幾何變換，是指使用戶獲得或設計的原始圖像按照需要產生大小、形狀和位置的變換。<br>圖像幾何變換的一個重要應用時消除由於攝像機導致的數字圖像的幾何畸變。另一個應用時對相似的圖像進行配準，以便進行圖像比較，典型的應用時利用圖像相減來檢測運動或變化。<br>1.1 齊次座標<br>1.2 矩陣</p>
</li>
<li><p>平移<br>只是改變圖像在屏幕上的位置，圖像本身并不發生變化。</p>
</li>
<li><p>旋轉<br>以圖像的中心為原點，將圖像上的所有像素都選裝一個相同的角度。</p>
</li>
<li><p>縮放</p>
</li>
<li><p>轉置<br>將圖像像素的 x 座標和 y 座標互換。</p>
</li>
<li><p>鏡像<br>水平鏡像和垂直鏡像</p>
</li>
<li><p>差值算法<br>7.1 最近邻差值<br>7.2 雙線性插值<br>7.3 雙三次插值：三次捲積法</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像的正交變換</title>
    <url>/2013/02/17/130217-orthogonal-transform/</url>
    <content><![CDATA[<p>數字圖像處理的方法主要分為空域法和頻域法。</p>
<p>在頻域法處理中最為關鍵的預處理便是變換處理。這種變換一般是線性變換，其基本線性運算式是嚴格可逆的，並且滿足一定的正交條件，這裡的正交條件一般都是通過構造完備的正交函數集來實現的。</p>
<p>1.正交函數的概念</p>
<p>一組實值的連續函數{Sn(t)}={S0(t),S1(t),S2(t),…},在 0≤t≤T 區間內，如果滿足下式：<br>T k m=n<br>∫ =kSn(t)·Sm(t)dt={<br>0 0 m≠n<br>稱之為{Sn(t)}在區間 0≤t≤T 內是正交的。m，n 是正實數，k 是與 m，n 無關的非負常數。如果 K=1，成為歸一化正交。任一祖非歸一化的正交函數總可以變換為歸一化正交函數。<br>如果 f(t)是定義在(0,T)區間上的實值信號，利用正交函數可表示為下式：<br>f(t)= ∑ CnSn(t)<br>n=0<br>式中 Cn 是第 n 項係數。</p>
<p>2.傅利葉變換</p>
<p>2.1 定義<br>設 f(x)為 x 的函數，如果 f(x)滿足下面的狄里克萊條件：<br>（1）具有有限個間斷點；<br> （2）具有有限個極值點；<br>（3）絕對可積。<br>則有下列二式成立：<br>+∞<br>F(u)=∫f(x)e-j2πuxdx<br>-∞<br>+∞<br>f(x)=∫F(u)ej2πuxdx<br>-∞<br>式中 x 為時域變量，u 為頻域變量。<br>2.2 性質</p>
<p>（1）可分性<br>在多維傅利葉變換中，通常都是利用可分性來降維。<br>（2）線性<br>（3）共軛對稱性<br>（4）旋轉性<br>（5）比例變換特性<br>（6）帕斯維爾定理（能量保持定理）<br>（7）相關定理<br>（8）捲積定理<br>在一些涉及相關活著捲積的運算中，一般都利用此性質將求它們在時域的捲積轉化為求頻域內的乘積來簡化預案算過程。</p>
<p>3.離散傅立葉變換</p>
<p>3.1 概論<br>離散傅利葉變換時直接處理離散時間信號的傅利葉變換。<br>3.2 性質<br>（1）線性<br>（2）對稱性<br>（3）時間移位<br>（4）頻率移位<br>（5）週期性<br>（6）偶函數<br>（7）奇函數<br>（8）捲積定理<br>（9）相關定理<br>（10）帕斯維爾定理</p>
<p>3.3 二維傅利葉變換</p>
<p>一副靜止的數字圖像可看做是二維數據陣列。因此，數字圖像處理主要是二維數據處理。</p>
<p>3.4 快速傅利葉變換</p>
<p>4.沃爾什-哈達瑪變換</p>
<p>5.離散餘弦變換</p>
<p>6.離散 K-L 變換</p>
<p>7.小波變換</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>灰度變換（點運算）</title>
    <url>/2013/02/01/130201-gray-transform/</url>
    <content><![CDATA[<p>圖像的灰度變換處理時圖像增強處理技術中一種非常基礎、直接的空間域圖像處理方法。灰度變換是根據某種目標條件按一定變換關係逐點改變原圖像中每一個像素灰度值的方法。灰度變換處理法也叫做點運算法，可以看做是“從像素到像素”的複製操作。<br>假設原圖像像素的灰度值為 f(x,y),處理后為 g(x,y)，則灰度增強可表示為：</p>
<pre><code>g(x,y)=T[f(x,y)]</code></pre><p>根據 g(x,y)=T[f(x,y)]，可以將灰度變換分為線性變換和非線性變換。</p>
<ol>
<li><p>二值化和閾值處理<br>圖像二值化變換時簡單的非線性變換，它在增強圖像的可讀性的同時是以丟棄原有圖像數據位代價的。<br>閾值處理的操作過程是先由用戶指定或通過算法生成一個閾值，如果圖像中某像素的灰度值小於該閾值，則將該像素的灰度值設置為 0（黑）或者 255（白）。<br>閾值化的變換函數表達式如下：</p>
<pre><code>            0,        x&lt;T
f(x)={
            255,        x&gt;T</code></pre><p>其中 T 為指定閾值。<br>閾值處理為非線性變換，主要有非零元素取一法、固定閾值法和雙固定閾值法。</p>
<p>1.1 非零元素取一法<br>非零取一就是對於灰度圖像 f，若某像素灰度值為零，則其灰度值不變，仍為零；對於灰度值不為零的像素，將其像素值全部變為 255.<br>非零元素取一法的閾值 T=1.<br>非零元素取一法的變換函數表達式為：</p>
<pre><code>            0,        x&lt;1
f(x)={
            255,        x&gt;1</code></pre><p>1.2 固定閾值法<br>固定閾值法就是為灰度圖像 f 設定一個閾值 T，把灰度值小於給定閾值 T 的像素置 0，大於閾值 T 的像素置為 255，從而對灰度圖像實現二值化變換。<br>固定閾值法的變換函數表達式為：</p>
<pre><code>            0,        x&lt;T
f(x)={
            255,        x&gt;T</code></pre><p>其中 T 為指定的閾值。<br>1.3 雙固定閾值法<br>雙固定閾值法預先設置了兩個閾值 T1 和 T2，T1&lt;T2，當對圖像進行處理時，如果某個像素的灰度值小於 T1 則置 0（或者 255）；如果大於 T1 並且小於 T2 時，則置 255（或者置 0）；如果大於 T2 時，則置 0（或者 255）。<br>可根據具體情況選擇雙固定閾值使用 0 255 0 型或是 255 0 255 型。</p>
</li>
<li><p>灰度的線性變換<br>灰度的線性變化是將圖像中所有點的灰度按照線性灰度變換函數進行變換。<br>在曝光不足或者過度的情況下，圖像灰度可能會局限在一個很小的範圍內。這時在顯示器上看到的將是一個模糊不清、似乎沒有灰度層次的圖像。用一個線性單值函數，對圖像內的每一個像素做線性擴展，將有效地改善圖像視覺效果。<br>令原圖像 f(x,y)的灰度範圍為[z1,z2]，線性變換后圖像 g(x,y)的範圍為[z’1,z’2]。<br>g(x,y)域 f(x,y)之間存在以下關係：</p>
<pre><code>                      z&apos;2-z&apos;1
g(x,y)=z&apos;1+————(f(x,y)-z1)
                      z2-z1</code></pre><p>由於|z’2-z’1|總是大於|z2-z1|,所以對離散圖像來說，儘管變換前後像素個數相同，但不同像素之間的灰度差變大，對比度變大，圖像觀看質量必然優於變換前。對於連續圖像，如果背景與目標物的灰度只差很小，在[a,b] 區間內量化可能進入同一灰度級內而不能分辨。<br>由此可見，對輸入圖像灰度作線性擴張或壓縮，映射函數為一個直線方程，該線性灰度變換函數是一個一維線性函數。<br>灰度變換方程為：</p>
<pre><code>g(x,y)=t[f(x,y)]=af(x,y)+b</code></pre><p>當 a&gt;1 時，輸出圖像的對比度將增加；<br>當 a&lt;1 時，輸出圖像的對比度將減小；<br>當 a=1 且 b≠0 時，整個圖像更暗或更亮；<br>當 a=1，b=0 時，輸出圖像和輸入圖像相同；<br>當 a=-1，b=255 時，輸出圖像的灰度正好反轉；<br>當 a&lt;0 且 b&gt;0 時，暗區域將變亮，亮區域將變暗，點運算完成圖像求補運算。</p>
</li>
<li><p>窗口灰度變換處理<br>窗口灰度變換處理時限定一個窗口範圍，該窗口中的灰度值保存不變；小於該窗口下限的灰度值直接設置為 0；大於該窗口上限的灰度值直接設置為 255.<br>灰度窗口變換的函數表達式為：</p>
<pre><code>              0,        x&lt;L
f(x)={    x,        L≤x≤U
              255,        x&gt;U</code></pre><p>式中 L 表示窗口下限，U 表示窗口上限。</p>
</li>
<li><p>分段線性變換<br>分段線性變換時將圖像灰度區間分成兩段乃至多段，來分別作線性變換。其可以根據用戶的取藥，拉伸特徵物體的灰度細節，相對抑制不敢興趣的灰度級。</p>
</li>
<li><p>非線性變換——對數變換<br>對數變換表達式為：</p>
<pre><code>s=c log（1+r）</code></pre><p>其中 c 是一個常數，并假設 r≥0.<br>此變換使一窄帶低灰度輸入圖像值映射為一寬帶輸出值。相對的是輸入灰度的高調整值。可以利用這種變換來擴展被壓縮的高值圖像中的暗像素。相對的是反對數變換的調整值。</p>
</li>
<li><p>非線性變換——冪次變換<br>冪次變換表達式為：</p>
<pre><code>s=crr</code></pre><p>式中 c、r 為正常數。<br>冪次曲綫中 r 的部份值把輸入窄帶暗值映射到寬帶輸出值。相反，輸入高值時也成立。</p>
</li>
<li><p>灰度直方圖<br>直方圖反映了圖像的灰度分佈情況，主要用在圖像分割、圖像灰度變換等處理過程中。<br>直方圖的橫座標為灰度，用 r 表示；縱座標是灰度值像素的個數，用 H 表示。</p>
</li>
<li><p>灰度直方圖分佈均衡化<br>直方圖均衡方法是對在圖像中像素個數多的灰度級進行展寬，而對像素個數少的灰度級進行縮減，從而達到清晰圖像的目的。通過點運算使輸入圖像轉換為在每一灰度級上都有相同的像素點的數目，即輸出圖像的直方圖是平的。</p>
</li>
<li><p>灰度直方圖匹配<br>直方圖匹配變換時為了滿足不同的處理需要而提出的。對不同的圖像，甚至對同一副圖像的匹配函數都是不同的，在調用匹配變換函數前，必須指定匹配變換后的直方圖形式，用指定匹配變換后的直方圖作為變換之後的直方圖。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vison</tag>
      </tags>
  </entry>
  <entry>
    <title>圖像增強</title>
    <url>/2013/01/31/130131-image-enhace/</url>
    <content><![CDATA[<h1 id="圖像增強"><a href="#圖像增強" class="headerlink" title="圖像增強"></a>圖像增強</h1><p>爲了使圖像更適合人的視覺特性或機器的識別系統而去改善圖像質量，其並不能增強原始圖像的信息，只能增強對某種信息的辨別能力，而可能損失一些其他信息。<br>主要分成兩大類：一類是頻域處理法，一類是時域處理法。</p>
<h1 id="頻域處理法"><a href="#頻域處理法" class="headerlink" title="頻域處理法"></a>頻域處理法</h1><p>基礎是捲積定理。<br>它通過傅里葉變換改變頻域，實現對圖像的增強處理。<br>有捲積定理可知，如果原始圖像時 f(x,y)，處理后的圖像是 g(x,y)，而 h(x,y)是處理系統的衝擊響應，則有</p>
<pre><code>g(x,y)=h(x,y)*f(x,y)</code></pre><p>G(u,v),H(u,v),F(u,v)分別表示 g(x,y),h(x,y),f(x,y)的傅立葉變換，則有</p>
<pre><code>G(u,v)=H(u,v)·F(u,v)</code></pre><p>故有：</p>
<pre><code>g(x,y)=F-1[H(u,v)·F(u,v)]</code></pre><p>頻域處理法中的關鍵是要設計一個適當的濾波系統傳遞函數 H(u,v)。凡是要保留的頻率分量，其對應的 H(u,v)=1 或 k(k 是不等於 1 的常數)；凡是抑制或衰減的頻率分量，其對應的 H(u,v)=0 或 w(0&lt;w&lt;1)</p>
<h1 id="時域處理法"><a href="#時域處理法" class="headerlink" title="時域處理法"></a>時域處理法</h1><p>直接對圖像中的像素進行處理，基本上是以灰度映射變換為基礎。<br>常用的有图像平滑和图像锐化。圖像平滑有邻域平均法和中值滤波；圖像銳化有梯度法和拉普拉斯算子。</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>四種圖像格式的組成</title>
    <url>/2013/01/31/130131-vision-pic/</url>
    <content><![CDATA[<h1 id="BMP-格式"><a href="#BMP-格式" class="headerlink" title="BMP 格式"></a>BMP 格式</h1><p>位圖文件由文件頭(BITMAPFILEHEADER)、位圖信息頭(BITMAPINFOHEADER)、顏色信息(RGBQUAD)和圖形數據(IMAGEDATA)四部份組成。</p>
<ol>
<li>文件頭主要包含文件的大小、文件類型、圖像數據偏離文件頭的長度等信息；</li>
<li>位圖信息頭包含圖像的尺寸信息、圖形用幾個比特數值來表示一個像素、圖像是否壓縮、圖像所用的顏色數等信息；</li>
<li>顏色信息包含圖像所用到的顏色表，顯示圖像時需用到這個顏色表來生成調色板，但如果圖像為真彩色，即圖像的每個像素用 24 個比特來表示，文件中就沒有這一塊信息，也就不需要操作調色板。</li>
<li>文件中的數據塊表示圖像的相應的像素值。<br>圖像的像素值在文件中的存放順序為從左到右，從下到上，也就是說，在 BMP 文件中首先存放的是圖像的最後一行像素，最後才存儲圖像的第一個，但對于同一行的像素，則是先左邊后右邊的順序存儲的；例外一個需要關注的細節是：文件存儲圖像的每一行像素值時，如果存儲該行像素值所占的字節數為 4 的倍數，則正常存儲；否則需要在後端補 0，湊足 4 的倍數。<br>對於 2 色位圖，用 1 位就可以表示該像素的顏色（0 黑，1 白）；<br>對於 16 色位圖，用 4 為可以表示一個像素的顏色；<br>對於 256 色位圖，1 個字節剛好可以表示 1 個像素；<br>對於真彩色圖，3 個字節才能表示 1 個像素。</li>
</ol>
<h1 id="TIFF-格式"><a href="#TIFF-格式" class="headerlink" title="TIFF 格式"></a>TIFF 格式</h1><p>TIFF 圖像文件由文件頭、標識信息區和圖像數據區組成。</p>
<ol>
<li>文件頭（Image File Header）由字節分類域、版本域和偏移域。<br>字節分類域標誌了 TIFF 文件被創建時的字節分類，一般包含 2 個字節“MM”或者“II”。“MM”表示為摩托羅拉格式，“II”表示為英特爾格式。<br>版本域包含一個特定的十進制數 4210，他可以用來進一步確認該文件為 TIFF 文件，幾乎沒有變化。<br>偏移域包含了從文件的起始部份到圖像文件目錄 IFD 的字節偏移。</li>
<li>文件目錄（IFD）<br>一個 TIFF 文件可能有一個或者多個 IFD，每個 IFD 的起始位置都是偶字節數，說明文件包含了不只一副圖像。若文件內只存儲一副圖像，則將標誌信息請內容置 0，表示文件內務其他標誌信息區，只存儲單幅的 TIFF 圖像文件結構。如果有多個 IFD 存在，則文件內存放多幅圖像，則在第一個標誌信息區末端的標誌參數，僵尸一個非 0 的長整數值，表示下一個標誌信息區在文件中的地址，只有最後一個標誌信息區的末端才會出現值為 0 的長整數，表示圖像文件內不再有其他的標誌信息區和圖像數據區。 3.數據區塊<br>圖像數據的排列時以圖像的左上角為座標原點，兩個座標軸的方向分別是從左到右和從上到下。</li>
</ol>
<h1 id="JPEG-格式"><a href="#JPEG-格式" class="headerlink" title="JPEG 格式"></a>JPEG 格式</h1><p>JPEG 有以下 8 部份組成：</p>
<ol>
<li>圖像開始 SOI 標記</li>
<li>APP0 標記（Marker）<ul>
<li>APP0 長度（length）</li>
<li>標誌符（identifier）</li>
<li>版本號（version）</li>
<li>X 和 Y 的密度單位（units=0：無單位；units=1：點數/inch；units=2：點數/cm）</li>
<li>X 方向像素密度（X density）</li>
<li>Y 方向像素密度（Y density）</li>
<li>縮略圖水平像素數目（thumbnail horizontal pixels）</li>
<li>縮略圖垂直像素數目（thumbnail vertical pixels）</li>
<li>縮略圖 RGB 位圖（thumbnail RGB bitmap）</li>
</ul>
</li>
<li>APPn 標記（Markers），其中 n=1~15（任選）<ul>
<li>APPn 長度（length）</li>
<li>應用詳細信息（application specific information）</li>
</ul>
</li>
<li>一個或者多個量化表 DQT（define quantization table）<ul>
<li>量化表長度（quantization table length）</li>
<li>量化表數目（quantization table number）</li>
<li>量化表（quantization table）</li>
</ul>
</li>
<li>幀圖像開始 SOF0（start of frame）<ul>
<li>幀開始長度（start of frame length）</li>
<li>精度（precision），每個顏色分量每個像素的位數（bits per pixel per color component）</li>
<li>圖像高度（image height）</li>
<li>圖像寬度（image width）</li>
<li>顏色分量數（number of color components）</li>
<li>顏色分量（for each component）包括 ID 號、垂直方向的樣本因子（vertical sample factor）、水平方向的樣本因子（horizontal sample factor）、量化表號（quantization table）等</li>
</ul>
</li>
<li>一個或者多個哈夫曼表 DHT（difine huffman table）</li>
</ol>
<ul>
<li>哈夫曼表的長度（Huffman table length）</li>
<li>類型、AC 或者 DC（Type，AC or DC）</li>
<li>索引（Index）</li>
<li>位表（bits table）</li>
<li>值表（value table） 7.掃描開始 SOS（start of scan）</li>
<li>掃描開始長度（start of scan length）</li>
<li>顏色分量數（number of color components）</li>
<li>顏色分量 包括 ID 號、交流係數表號（AC table）、直流係數表號（DC table）等</li>
<li>壓縮圖像數據（compressed image data） 8.圖像結束 EOI（end of image）</li>
</ul>
<h1 id="PNG-格式"><a href="#PNG-格式" class="headerlink" title="PNG 格式"></a>PNG 格式</h1><p>PNG 圖像有一個 8 字節的 PNG 文件署名（PNG file signature）域和按照特定結構組成的 3 個以上的數據塊（chunk）組成。數據塊定義了 2 種類型，一種為關鍵數據塊（critical chunk），這是標準數據塊，另一種為輔助數據塊（ancillary chunks），可選數據塊。</p>
<ol>
<li><p>關鍵數據塊</p>
<ul>
<li>圖像文件頭數據塊 IHDR</li>
<li>圖像調色板數據塊 PLTE</li>
<li>圖像數據塊 IDAT</li>
<li>圖像結束數據 IEND</li>
</ul>
</li>
<li><p>輔助數據塊</p>
<ul>
<li>背景顏色數據塊 bKGD -基色和白色度數據塊 cHRM</li>
<li>圖像 γ 數據塊 gAMA</li>
<li>圖像直方圖數據塊 hIST</li>
<li>物理像素尺寸數據塊 pHYs</li>
<li>樣本有效位數據塊 sBIT</li>
<li>文本信息數據塊 tEXt</li>
<li>圖像最後修改時間數據塊 tIME</li>
<li>圖像透明數據塊 tRNS</li>
<li>壓縮文本數據塊 zTXt</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW CVI RS232代碼</title>
    <url>/2013/01/31/130131-labcvi-232/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><ul>
<li>使用 labcvi 编写，这类工具很多，练手用</li>
<li>使用 labivewcvi 自带控件</li>
<li>串口调试工具</li>
<li>没有更多功能</li>
<li>相关<ol>
<li>CVI 的语法与 C 一样</li>
<li>CVI 封装了各种驱动，适合熟悉 C 语言的人进行快速开发</li>
<li>CVI 具有 LabVIEW 控件</li>
</ol>
</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Title:       COM</span></span><br><span class="line"><span class="comment">// Purpose:     A short description of the application.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created on:  2012-3-27 at 18:17:57 by Lenovo User.</span></span><br><span class="line"><span class="comment">// Copyright:   Lenovo (Beijing) Limited. All Rights Reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Include files</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;formatio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ansi_c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cvirte.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;userint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;rs232.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;userint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"COM.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"toolbox.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Constants</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Types</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Static global variables</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> panelHandle;</span><br><span class="line"><span class="keyword">int</span> comport,</span><br><span class="line">    baudrate,</span><br><span class="line">    portindex,</span><br><span class="line">    parity,</span><br><span class="line">    databits,</span><br><span class="line">    stopbits,</span><br><span class="line">    RS232Error,</span><br><span class="line"> stringsize,</span><br><span class="line"> comport_open,</span><br><span class="line"> openbool;</span><br><span class="line"> bytes_sent,</span><br><span class="line"> checkval,</span><br><span class="line"> senddatanum,</span><br><span class="line"> recedatanum;</span><br><span class="line"><span class="keyword">char</span> devicename[<span class="number">30</span>],</span><br><span class="line">     send_data[<span class="number">2000</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Static functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Global variables</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// Global functions</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReceiveData</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">senddata</span> <span class="params">(<span class="keyword">void</span>)</span> </span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DisplayRS232Error</span> <span class="params">(<span class="keyword">void</span>)</span> </span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadctrlval</span><span class="params">(<span class="keyword">void</span>)</span> </span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">openrs232</span><span class="params">(<span class="keyword">void</span>)</span> </span>;</span><br><span class="line"><span class="comment">/// HIFN The main entry-point function.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* initialize and load resources */</span></span><br><span class="line">    nullChk (InitCVIRTE (<span class="number">0</span>, argv, <span class="number">0</span>));</span><br><span class="line">    errChk (panelHandle = LoadPanel (<span class="number">0</span>, <span class="string">"COM.uir"</span>, PANEL));</span><br><span class="line"></span><br><span class="line"> loadctrlval();</span><br><span class="line"> <span class="comment">//GetCtrlVal (PANEL, PANEL_open, &amp;comport_open);  (ON:1;OFF:0)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* display the panel and run the user interface */</span></span><br><span class="line">    errChk (DisplayPanel (panelHandle));</span><br><span class="line">    errChk (RunUserInterface ());</span><br><span class="line"></span><br><span class="line">Error:</span><br><span class="line">    <span class="comment">/* clean up */</span></span><br><span class="line">    DiscardPanel (panelHandle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//==============================================================================</span></span><br><span class="line"><span class="comment">// UI callback function prototypes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// HIFN Exit when the user dismisses the panel.</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> CVICALLBACK <span class="title">panelCB</span> <span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event == EVENT_CLOSE)</span><br><span class="line">        QuitUserInterface (<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CALL_OPEN</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_open, &amp;openbool);</span><br><span class="line"> <span class="keyword">if</span>(event == EVENT_LEFT_CLICK)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">if</span>(!openbool)</span><br><span class="line">  &#123;</span><br><span class="line">   openrs232();</span><br><span class="line">   <span class="keyword">if</span>(!RS232Error)</span><br><span class="line">   &#123;</span><br><span class="line">    SetCtrlAttribute (PANEL, PANEL_status, ATTR_OFF_COLOR, VAL_DK_GREEN);</span><br><span class="line">    SetXMode (comport, <span class="number">0</span>);</span><br><span class="line">                SetCTSMode (comport, <span class="number">0</span>);</span><br><span class="line">                SetComTime (comport, <span class="number">5</span>);</span><br><span class="line">    FlushInQ (comport);</span><br><span class="line">    FlushOutQ (comport);</span><br><span class="line">    comport_open=<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">    SetCtrlAttribute (PANEL, PANEL_status, ATTR_OFF_COLOR, VAL_DK_RED);</span><br><span class="line">    comport_open=<span class="number">0</span>;</span><br><span class="line">    DisplayRS232Error();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">   CloseCom(comport);</span><br><span class="line">   comport_open=<span class="number">0</span>;</span><br><span class="line">   SetCtrlAttribute (PANEL, PANEL_status, ATTR_OFF_COLOR, VAL_BLACK);</span><br><span class="line">   SetCtrlVal (PANEL,PANEL_CHECKBOX,<span class="number">0</span>);</span><br><span class="line">   SetCtrlAttribute (PANEL, PANEL_TIMER_send, ATTR_ENABLED, <span class="number">0</span>);</span><br><span class="line">   SetCtrlAttribute (PANEL, PANEL_TIMER, ATTR_ENABLED, <span class="number">0</span>);</span><br><span class="line">   checkval=<span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CALL_SEND</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event == EVENT_COMMIT) senddata();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CHECK</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> timeval;</span><br><span class="line"> <span class="keyword">double</span> time;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">if</span>(comport_open)</span><br><span class="line">  &#123;</span><br><span class="line">   GetCtrlVal (PANEL,PANEL_CHECKBOX,&amp;checkval);</span><br><span class="line">   GetCtrlVal (PANEL,PANEL_time,&amp;timeval);</span><br><span class="line">   time=timeval/<span class="number">1000</span>;</span><br><span class="line">   SetCtrlAttribute (PANEL,PANEL_TIMER_send, ATTR_INTERVAL,time);</span><br><span class="line">   SetCtrlAttribute (PANEL, PANEL_TIMER_send, ATTR_ENABLED, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">   MessagePopup (<span class="string">"錯誤"</span>, <span class="string">"自動發送錯誤, 請確保串口已經打開!"</span>);</span><br><span class="line">   SetCtrlVal (PANEL,PANEL_CHECKBOX,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">TIMERSEND</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (event)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> EVENT_TIMER_TICK:</span><br><span class="line">   <span class="keyword">if</span>(comport_open &amp;&amp; checkval==<span class="number">1</span>) senddata();</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">TimerCallback</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (event)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> EVENT_TIMER_TICK:</span><br><span class="line">   <span class="keyword">if</span>(comport_open) ReceiveData ();</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CLEARSEND</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="comment">//SetCtrlAttribute (PANEL, PANEL_SEND, ATTR_CTRL_VAL,'\0');</span></span><br><span class="line">  DefaultCtrl (PANEL, PANEL_SEND);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CLEARRECE</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="comment">//SetCtrlAttribute (PANEL, PANEL_RECEIVE, ATTR_CTRL_VAL,'\0');</span></span><br><span class="line">  DefaultCtrl (PANEL,PANEL_RECEIVE);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">CLEARNUM</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  SetCtrlVal (PANEL, PANEL_sendnum, <span class="number">0</span>);</span><br><span class="line">  SetCtrlVal (PANEL, PANEL_recenum, <span class="number">0</span>);</span><br><span class="line">  senddatanum=<span class="number">0</span>;</span><br><span class="line">  recedatanum=<span class="number">0</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">LOADSend</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">char</span> tempfilename[MAX_PATHNAME_LEN],</span><br><span class="line">      filebuff[<span class="number">200000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"> <span class="keyword">int</span> fileselect,filehandle;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  fileselect= FileSelectPopup (<span class="string">""</span>, <span class="string">"*.txt"</span>, <span class="string">""</span>,<span class="string">"選擇發送區加載文件"</span>, VAL_LOAD_BUTTON,<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, tempfilename);</span><br><span class="line">  <span class="keyword">if</span> (fileselect==VAL_EXISTING_FILE_SELECTED) <span class="comment">/*  0 VAL_NO_FILE_SELECTED  1 VAL_EXISTING_FILE_SELECTED   2 VAL_NEW_FILE_SELECTED   */</span></span><br><span class="line">   &#123;</span><br><span class="line">    filehandle=OpenFile (tempfilename, VAL_READ_ONLY, VAL_OPEN_AS_IS, VAL_ASCII);</span><br><span class="line">    ReadFile (filehandle,filebuff ,MAX_PATHNAME_LEN);</span><br><span class="line">    DefaultCtrl (PANEL,PANEL_SEND);</span><br><span class="line">    SetCtrlVal (PANEL, PANEL_SEND, filebuff);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  CVICALLBACK <span class="title">SAVERece</span><span class="params">(<span class="keyword">int</span> panel, <span class="keyword">int</span> control, <span class="keyword">int</span> event, <span class="keyword">void</span> *callbackData, <span class="keyword">int</span> eventData1, <span class="keyword">int</span> eventData2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">char</span> tempfilename[MAX_PATHNAME_LEN],</span><br><span class="line">      filebuff[<span class="number">200000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"> <span class="keyword">int</span> fileselect,filehandle;</span><br><span class="line"> <span class="keyword">if</span> (event == EVENT_COMMIT)</span><br><span class="line"> &#123;</span><br><span class="line">  fileselect= FileSelectPopup (<span class="string">""</span>, <span class="string">"*.txt"</span>, <span class="string">""</span>,<span class="string">"保存接收區文件"</span>, VAL_SAVE_BUTTON,<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, tempfilename);</span><br><span class="line">  <span class="keyword">if</span>(fileselect!=VAL_NO_FILE_SELECTED)</span><br><span class="line">  &#123;</span><br><span class="line">   filehandle=OpenFile (tempfilename, VAL_WRITE_ONLY, VAL_OPEN_AS_IS, VAL_ASCII);</span><br><span class="line">   GetCtrlVal (PANEL,PANEL_RECEIVE,filebuff);</span><br><span class="line">   WriteFile (filehandle,filebuff ,MAX_PATHNAME_LEN);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">openrs232</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_COMPORT, &amp;comport);</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_BAUDRATE, &amp;baudrate);</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_PARITY, &amp;parity);</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_DATABITS, &amp;databits);</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_STOPBITS, &amp;stopbits);</span><br><span class="line"> portindex=comport<span class="number">-1</span>;</span><br><span class="line"> GetLabelFromIndex (PANEL, PANEL_COMPORT, portindex,devicename);</span><br><span class="line"> DisableBreakOnLibraryErrors ();</span><br><span class="line"> RS232Error = OpenComConfig(comport,devicename,baudrate,parity,databits,stopbits,<span class="number">512</span>,<span class="number">512</span>);</span><br><span class="line"> SetCtrlAttribute (PANEL, PANEL_TIMER, ATTR_ENABLED, <span class="number">1</span>);</span><br><span class="line"> <span class="comment">//EnableBreakOnLibraryErrors ();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">senddata</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_RECEIVE, <span class="string">'\0'</span>);</span><br><span class="line"> GetCtrlVal (PANEL, PANEL_SEND,send_data);</span><br><span class="line"> stringsize = StringLength (send_data);</span><br><span class="line"> senddatanum+=stringsize;</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_sendnum, senddatanum);</span><br><span class="line"> bytes_sent = ComWrt (comport, send_data, stringsize);</span><br><span class="line"> RS232Error = ReturnRS232Err ();</span><br><span class="line"> <span class="keyword">if</span> (RS232Error)</span><br><span class="line">  DisplayRS232Error ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReceiveData</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>    readBuf[<span class="number">2000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span>     strLen;</span><br><span class="line"> strLen = GetInQLen (comport);</span><br><span class="line"> recedatanum+=strLen;</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_recenum, recedatanum);</span><br><span class="line"> ComRd (comport, readBuf, strLen);</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_RECEIVE, readBuf);</span><br><span class="line"> SetActiveCtrl (PANEL, PANEL_SEND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadctrlval</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_RECEIVE, <span class="string">"接收區"</span>);</span><br><span class="line"> SetCtrlVal (PANEL, PANEL_SEND, <span class="string">"發送區"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DisplayRS232Error</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ErrorMessage[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">switch</span> (RS232Error)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">default</span> :</span><br><span class="line">            <span class="keyword">if</span> (RS232Error &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                Fmt (ErrorMessage, <span class="string">"%s&lt;未知串口錯誤 %i"</span>, RS232Error);</span><br><span class="line">                MessagePopup (<span class="string">"串口錯誤信息"</span>, ErrorMessage);</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>  :</span><br><span class="line">            MessagePopup (<span class="string">"串口錯誤信息"</span>, <span class="string">"No errors."</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-2</span> :</span><br><span class="line">            Fmt (ErrorMessage, <span class="string">"%s"</span>, <span class="string">"沒打開串口"</span>);</span><br><span class="line">            MessagePopup (<span class="string">"串口錯誤信息"</span>, ErrorMessage);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-3</span> :</span><br><span class="line">            Fmt (ErrorMessage, <span class="string">"%s"</span>, <span class="string">"串口未打開.\n"</span></span><br><span class="line">                 <span class="string">"請打開串口."</span>);</span><br><span class="line">            MessagePopup (<span class="string">"串口錯誤信息"</span>, ErrorMessage);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">-7</span> :</span><br><span class="line">            Fmt (ErrorMessage, <span class="string">"%s"</span>, <span class="string">"串口被占用.\n"</span><span class="string">"請檢查串口!"</span>);</span><br><span class="line">            MessagePopup (<span class="string">"串口錯誤信息"</span>, ErrorMessage);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-99</span> :</span><br><span class="line">            Fmt (ErrorMessage, <span class="string">"%s"</span>, <span class="string">"超時錯誤.\n\n"</span></span><br><span class="line">                 <span class="string">"Either increase timeout value,\n"</span></span><br><span class="line">                 <span class="string">"       check COM Port setting, or\n"</span></span><br><span class="line">                 <span class="string">"       check device."</span>);</span><br><span class="line">            MessagePopup (<span class="string">"串口錯誤信息"</span>, ErrorMessage);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>用LabVIEW来控制爱普生机械手（LabVIEW Guide 1.0 Demo For Epson Robot）</title>
    <url>/2012/08/30/120830-labview-epson/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>本 Demo 是用 LabVIEW 通过 Epson 提供的 SpelNetLib.dll 来控制 Epson 机械手的运行以及相关操作，与官方提供的 VS Demo 功能一致。</p>
<h1 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h1><p><img src="/attach/epson01.png" alt="ui"></p>
<h1 id="LabVIEW-代码"><a href="#LabVIEW-代码" class="headerlink" title="LabVIEW 代码"></a>LabVIEW 代码</h1><p><img src="/attach/epson02.png" alt="code"></p>
<h1 id="相关文件"><a href="#相关文件" class="headerlink" title="相关文件"></a>相关文件</h1><pre><code>请参考Epson提供的VB Guide。</code></pre>]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>双网卡上不同网络，外网和内网</title>
    <url>/2012/08/07/120807-doublenet/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>双网卡进不同的网段，一个进内网，一个进外网</p>
<p>在 windows 中输入 cmd 进入 dos 命令行；<br>输入 route print 查看路由信息(双网卡最大的问题就是路由的选择)</p>
<p>在这里，我的 172.16.4.1 为内网，192.168.0.250 为外网</p>
<p>使用 route delete 0.0.0.0 ，将这 2 条路由信息删除并以</p>
<p>route add -p 0.0.0.0 mask 0.0.0.0 192.168.0.250 metric 1<br>route add -p 0.0.0.0 mask 255.255.252.0 172.16.4.1 metric 20</p>
<p>来设置即可！</p>
<p>route 命令的相关信息，具体请查看系统说明！</p>
<p>destination Specifies the host.<br>MASK Specifies that the next parameter is the ‘netmask’ va<br>netmask Specifies a subnet mask value for this route entry.<br>If not specified, it defaults to 255.255.255.255.<br>gateway Specifies gateway.<br>interface the interface number for the specified route.<br>METRIC specifies the metric, ie. cost for the destination.</p>
<h1 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h1><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">color</span> <span class="number">0</span>a</span><br><span class="line">route delete <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">route add -p <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> mask <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">250</span> metric <span class="number">1</span></span><br><span class="line">route add -p <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> mask <span class="number">255</span>.<span class="number">255</span>.<span class="number">252</span>.<span class="number">0</span> <span class="number">172</span>.<span class="number">16</span>.<span class="number">4</span>.<span class="number">1</span> metric <span class="number">20</span></span><br><span class="line">route <span class="built_in">print</span></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>bat</tag>
      </tags>
  </entry>
  <entry>
    <title>vb-串口程序</title>
    <url>/2012/06/15/120615-vb-comm/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><ul>
<li>使用 vb 编写，这类工具很多，练手用</li>
<li>使用 MSComm</li>
<li>串口调试工具</li>
<li>支持多语言</li>
<li>没有更多功能</li>
<li>相关<ol>
<li>GetSystemDefaultLCID（实现多语言的切换）</li>
<li>Timer（定时器，刷新数据）</li>
</ol>
</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"><span class="keyword">Dim</span> portopen <span class="keyword">As</span> <span class="built_in">Integer</span></span><br><span class="line"><span class="keyword">Dim</span> cmd_open <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> cmd_close <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> msg <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> GetSystemDefaultLCID <span class="keyword">Lib</span> <span class="string">"kernel32"</span> () <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Load()</span><br><span class="line"><span class="keyword">Dim</span> localid <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line">localid = GetSystemDefaultLCID</span><br><span class="line"><span class="keyword">Select</span> <span class="keyword">Case</span> localid</span><br><span class="line"><span class="keyword">Case</span> &amp;H404 <span class="comment">'繁体语言</span></span><br><span class="line">cmd_open = <span class="string">"打開"</span></span><br><span class="line">cmd_close = <span class="string">"關閉"</span></span><br><span class="line">msg = <span class="string">"串口未打開!"</span></span><br><span class="line">Form1.Caption = <span class="string">"串口調試(KB_Vision)"</span></span><br><span class="line">Label1.Caption = <span class="string">"端口號"</span></span><br><span class="line">Label2.Caption = <span class="string">"波特率"</span></span><br><span class="line">Label3.Caption = <span class="string">"數據位"</span></span><br><span class="line">Label4.Caption = <span class="string">"停止位"</span></span><br><span class="line">Label5.Caption = <span class="string">"較驗位"</span></span><br><span class="line">Command1.Caption = cmd_close</span><br><span class="line">Command2.Caption = <span class="string">"發送"</span></span><br><span class="line">send.<span class="keyword">Text</span> = <span class="string">"發送區"</span></span><br><span class="line">receive.<span class="keyword">Text</span> = <span class="string">"接收區"</span></span><br><span class="line">Check1.Caption = <span class="string">"自動發送"</span></span><br><span class="line"><span class="keyword">Case</span> &amp;H804 <span class="comment">'简体语言</span></span><br><span class="line">cmd_open = <span class="string">"打开"</span></span><br><span class="line">cmd_close = <span class="string">"关闭"</span></span><br><span class="line">msg = <span class="string">"串口没打开！"</span></span><br><span class="line">Form1.Caption = <span class="string">"串口调试(KB_Vision)"</span></span><br><span class="line">Label1.Caption = <span class="string">"端口号"</span></span><br><span class="line">Label2.Caption = <span class="string">"波特率"</span></span><br><span class="line">Label3.Caption = <span class="string">"数据位"</span></span><br><span class="line">Label4.Caption = <span class="string">"停止位"</span></span><br><span class="line">Label5.Caption = <span class="string">"校验位"</span></span><br><span class="line">Command1.Caption = cmd_close</span><br><span class="line">Command2.Caption = <span class="string">"发送"</span></span><br><span class="line">send.<span class="keyword">Text</span> = <span class="string">"发送区"</span></span><br><span class="line">receive.<span class="keyword">Text</span> = <span class="string">"接收区"</span></span><br><span class="line">Check1.Caption = <span class="string">"自动发送"</span></span><br><span class="line"><span class="keyword">Case</span> &amp;H409 <span class="comment">'English</span></span><br><span class="line">cmd_open = <span class="string">"Open"</span></span><br><span class="line">cmd_close = <span class="string">"Close"</span></span><br><span class="line">msg = <span class="string">"No comport open"</span></span><br><span class="line">Form1.Caption = <span class="string">"Comdebug(KB_Vision)"</span></span><br><span class="line">Label1.Caption = <span class="string">"Comport"</span></span><br><span class="line">Label2.Caption = <span class="string">"Baudrate"</span></span><br><span class="line">Label3.Caption = <span class="string">"Databits"</span></span><br><span class="line">Label4.Caption = <span class="string">"Stopbits"</span></span><br><span class="line">Label5.Caption = <span class="string">"Parity"</span></span><br><span class="line">Command1.Caption = cmd_close</span><br><span class="line">Command2.Caption = <span class="string">"Send"</span></span><br><span class="line">send.<span class="keyword">Text</span> = <span class="string">"SendText"</span></span><br><span class="line">receive.<span class="keyword">Text</span> = <span class="string">"ReceiveText"</span></span><br><span class="line">Check1.Caption = <span class="string">"Auto Send"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line">tip.Caption = <span class="string">""</span></span><br><span class="line">comport.ListIndex = <span class="number">0</span></span><br><span class="line">sendTimer.Enabled = <span class="literal">False</span></span><br><span class="line">receTimer.Enabled = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command1_Click()</span><br><span class="line"><span class="keyword">Dim</span> baudrateset <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> parityset <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> databitset <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> stopbitset <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> comset <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">baudrateset = baudrate.<span class="keyword">Text</span></span><br><span class="line">parityset = Left(parity.<span class="keyword">Text</span>, <span class="number">1</span>)</span><br><span class="line">databitset = databits.<span class="keyword">Text</span></span><br><span class="line">stopbitset = stopbits.<span class="keyword">Text</span></span><br><span class="line">comset = baudrateset + <span class="string">","</span> + parityset + <span class="string">","</span> + databitset + <span class="string">","</span> + stopbitset</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> showerr</span><br><span class="line"><span class="keyword">If</span> (portopen = <span class="number">0</span>) <span class="keyword">Then</span></span><br><span class="line">Command1.Caption = cmd_open</span><br><span class="line">portopen = <span class="number">1</span></span><br><span class="line">MSComm.CommPort = comport.ListIndex + <span class="number">1</span></span><br><span class="line">MSComm.Settings = comset</span><br><span class="line"><span class="comment">'Print MSComm.Settings</span></span><br><span class="line">MSComm.InputLen = <span class="number">0</span></span><br><span class="line">MSComm.InBufferSize = <span class="number">1024</span></span><br><span class="line">MSComm.InputMode = <span class="number">0</span></span><br><span class="line">MSComm.RThreshold = <span class="number">1</span></span><br><span class="line">MSComm.RTSEnable = <span class="literal">True</span></span><br><span class="line">MSComm.SThreshold = <span class="number">0</span></span><br><span class="line">MSComm.portopen = <span class="literal">True</span></span><br><span class="line">tip.Caption = <span class="string">"Ok"</span></span><br><span class="line">tip.ForeColor = RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">receTimer.Enabled = <span class="literal">True</span></span><br><span class="line">send.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">receive.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">portopen = <span class="number">0</span></span><br><span class="line">Command1.Caption = cmd_close</span><br><span class="line">tip.Caption = <span class="string">""</span></span><br><span class="line">tip.ForeColor = RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">receTimer.Enabled = <span class="literal">False</span></span><br><span class="line">MSComm.portopen = <span class="literal">False</span></span><br><span class="line">Check1.Value = <span class="number">0</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="comment">'err tip</span></span><br><span class="line">showerr:</span><br><span class="line"><span class="keyword">If</span> (portopen = <span class="number">1</span>) <span class="keyword">Then</span></span><br><span class="line">tip.Caption = <span class="string">"Err"</span></span><br><span class="line">tip.ForeColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">tip.Caption = <span class="string">""</span></span><br><span class="line">tip.ForeColor = RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command2_Click()</span><br><span class="line"><span class="keyword">If</span> (tip.Caption = <span class="string">"Ok"</span>) <span class="keyword">Then</span></span><br><span class="line">MSComm.Output = send.<span class="keyword">Text</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">MsgBox (msg)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check1_Click()</span><br><span class="line"><span class="keyword">If</span> Check1.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">sendTimer.Enabled = <span class="literal">True</span></span><br><span class="line">sendTimer.Interval = Time.<span class="keyword">Text</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">sendTimer.Enabled = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> sendTimer_Timer()</span><br><span class="line"><span class="keyword">If</span> (tip.Caption = <span class="string">"Ok"</span>) <span class="keyword">Then</span></span><br><span class="line">MSComm.Output = send.<span class="keyword">Text</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">MsgBox (msg)</span><br><span class="line">sendTimer.Enabled = <span class="literal">False</span></span><br><span class="line">Check1.Value = <span class="number">0</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> receTimer_Timer()</span><br><span class="line"><span class="keyword">If</span> (tip.Caption = <span class="string">"Ok"</span>) <span class="keyword">Then</span></span><br><span class="line">receive.<span class="keyword">Text</span> = receive.<span class="keyword">Text</span> + MSComm.Input</span><br><span class="line">receive.SelStart = Len(receive.<span class="keyword">Text</span>)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">DoEvents</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>vb</tag>
      </tags>
  </entry>
  <entry>
    <title>VB聊天工具</title>
    <url>/2012/06/12/120612-vb-chat/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><ul>
<li>基于 udp 开发</li>
<li>使用 vb 开发</li>
<li>仅支持点对点对话，不支持多人，不是聊天室</li>
<li>支持来消息提醒功能</li>
<li>支持发送对话表情</li>
<li>支持发送文件（TCP）</li>
<li>VB 编程练手 TCP 和 UDP</li>
<li>本人和老婆认识时做的 2 人聊天工具（公司不能上网）</li>
<li>TCP/IP Winsock 状态表示<br>(0) sckClosed：关闭状态<br>(1) sckOpen：打开状态<br>(2) sckListening：侦听状态<br>(3) sckConnectionPending：连接状态<br>(4) sckResolvingHost：解析主机中<br>(5) sckHostResolved：已解析主机<br>(6) sckConnecting：正在连接<br>(7) sckConnected：已经连接<br>(8) sckClosing：客户端正在关闭<br>(9) sckError：连接发生错误</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"><span class="keyword">Const</span> REG_SZ = <span class="number">1</span></span><br><span class="line"><span class="keyword">Const</span> HKEY_LOCAL_MACHINE = &amp;H80000002</span><br><span class="line"><span class="keyword">Const</span> WM_LBUTTONDOWN = &amp;H201</span><br><span class="line"></span><br><span class="line"><span class="comment">'API定义</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> RegOpenKey <span class="keyword">Lib</span> <span class="string">"advapi32.dll"</span> <span class="keyword">Alias</span> <span class="string">"RegOpenKeyA"</span> (<span class="keyword">ByVal</span> hKey <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpSubKey <span class="keyword">As</span> <span class="built_in">String</span>, phkResult <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> RegQueryValueEx <span class="keyword">Lib</span> <span class="string">"advapi32.dll"</span> <span class="keyword">Alias</span> <span class="string">"RegQueryValueExA"</span> (<span class="keyword">ByVal</span> hKey <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpValueName <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> lpReserved <span class="keyword">As</span> <span class="built_in">Long</span>, lpType <span class="keyword">As</span> <span class="built_in">Long</span>, lpData <span class="keyword">As</span> Any, lpcbData <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> FlashWindow <span class="keyword">Lib</span> <span class="string">"User32"</span> (<span class="keyword">ByVal</span> hWnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> bInvert <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> GetForegroundWindow <span class="keyword">Lib</span> <span class="string">"User32"</span> () <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> GetSystemDefaultLCID <span class="keyword">Lib</span> <span class="string">"kernel32"</span> () <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'定义变量</span></span><br><span class="line"><span class="keyword">Dim</span> info_ip <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> info_name <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> connect <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line"><span class="keyword">Dim</span> localid <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> a <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line"><span class="keyword">Dim</span> font_name, font_size, font_underline, font_strikethru, font_bold, font_italic, font_color</span><br><span class="line"><span class="keyword">Dim</span> onaccept <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line"><span class="keyword">Dim</span> onsend <span class="keyword">As</span> <span class="built_in">Boolean</span></span><br><span class="line"><span class="keyword">Dim</span> FileNumber <span class="keyword">As</span> <span class="built_in">Integer</span></span><br><span class="line"><span class="keyword">Dim</span> client_LenFile <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> client_ProBarLen <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> client_VarPlus <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> GetFileNum <span class="keyword">As</span> <span class="built_in">Integer</span></span><br><span class="line"><span class="keyword">Dim</span> server_LenFile <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> server_ProBarLen <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> server_VarPlus <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> client_Error(<span class="keyword">ByVal</span> Number <span class="keyword">As</span> <span class="built_in">Integer</span>, Description <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> Scode <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> Source <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpFile <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpContext <span class="keyword">As</span> <span class="built_in">Long</span>, CancelDisplay <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">    client.Close</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> server_Error(<span class="keyword">ByVal</span> Number <span class="keyword">As</span> <span class="built_in">Integer</span>, Description <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> Scode <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> Source <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpFile <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpContext <span class="keyword">As</span> <span class="built_in">Long</span>, CancelDisplay <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">    server.Close</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileclient_Error(<span class="keyword">ByVal</span> Number <span class="keyword">As</span> <span class="built_in">Integer</span>, Description <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> Scode <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> Source <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpFile <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpContext <span class="keyword">As</span> <span class="built_in">Long</span>, CancelDisplay <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">    fileclient.Close</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileserver_Error(<span class="keyword">ByVal</span> Number <span class="keyword">As</span> <span class="built_in">Integer</span>, Description <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> Scode <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> Source <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpFile <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> HelpContext <span class="keyword">As</span> <span class="built_in">Long</span>, CancelDisplay <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">    fileserver.Close</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Load()</span><br><span class="line"><span class="keyword">Dim</span> FPath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> fontpath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> skinpath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> skin <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> hKey <span class="keyword">As</span> <span class="built_in">Long</span>, ret <span class="keyword">As</span> <span class="built_in">Long</span>, lenData <span class="keyword">As</span> <span class="built_in">Long</span>, typeData <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> Name <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> S <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    onaccept = <span class="literal">False</span></span><br><span class="line">    onsend = <span class="literal">False</span></span><br><span class="line">    SendLabel.Caption = <span class="string">"Up:NaN"</span></span><br><span class="line">    ReceiveLabel.Caption = <span class="string">"Down:NaN"</span></span><br><span class="line">    <span class="keyword">Me</span>.Caption = <span class="string">"For"</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="comment">'设置加载位置至屏幕中心</span></span><br><span class="line">    <span class="keyword">Me</span>.Left = (Screen.Width - <span class="keyword">Me</span>.Width) / <span class="number">2</span></span><br><span class="line">    <span class="keyword">Me</span>.Top = (Screen.Height - <span class="keyword">Me</span>.Height) / <span class="number">2</span></span><br><span class="line">    <span class="comment">'加载皮肤</span></span><br><span class="line">    skinpath = App.path &amp; <span class="string">"\Data\skin.ini"</span></span><br><span class="line">    Open skinpath <span class="keyword">For</span> Input <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">    Input <span class="meta">#1, skin</span></span><br><span class="line">    Close <span class="meta">#1</span></span><br><span class="line">    Skin1.LoadSkin skin</span><br><span class="line">    Skin1.ApplySkin <span class="keyword">Me</span>.hWnd</span><br><span class="line">    <span class="comment">'调用自动调整控件大小模块</span></span><br><span class="line">    <span class="keyword">Call</span> ResizeInit(<span class="keyword">Me</span>)</span><br><span class="line">    <span class="comment">'图片缓存区域RTF</span></span><br><span class="line">    Richtemp.TextRTF = <span class="string">""</span></span><br><span class="line">    <span class="comment">'系统默认字体，S为显示系统默认的字体</span></span><br><span class="line">    <span class="keyword">If</span> lang = <span class="string">"chs"</span> <span class="keyword">Or</span> lang = <span class="string">"cht"</span> <span class="keyword">Then</span></span><br><span class="line">        Name = <span class="string">"GUIFont.Facename"</span></span><br><span class="line">        ret = RegOpenKey(HKEY_LOCAL_MACHINE, <span class="string">"SOFTWARE\Microsoft\Windows NT\CurrentVersion\GRE_Initialize"</span>, hKey)</span><br><span class="line">        <span class="keyword">If</span> ret = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">            ret = RegQueryValueEx(hKey, Name, <span class="number">0</span>, typeData, <span class="keyword">ByVal</span> vbNullString, lenData) <span class="comment">'注意ByVal千万别忘了</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        S = <span class="built_in">String</span>(lenData, Chr(<span class="number">0</span>))</span><br><span class="line">        ret = RegQueryValueEx(hKey, Name, <span class="number">0</span>, typeData, <span class="keyword">ByVal</span> S, lenData) <span class="comment">'注意ByVal千万别忘了</span></span><br><span class="line">        S = Left(S, InStr(S, Chr(<span class="number">0</span>)) - <span class="number">1</span>)</span><br><span class="line">        <span class="comment">'设置文本框的字体</span></span><br><span class="line">        record.Font = S</span><br><span class="line">        msg.Font = S</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    FPath = App.path &amp; <span class="string">"\Data\info.ini"</span></span><br><span class="line">    fontpath = App.path &amp; <span class="string">"\Data\font.ini"</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> errhandle</span><br><span class="line">    <span class="comment">'个人信息</span></span><br><span class="line">    <span class="keyword">If</span> Dir(FPath) = <span class="string">""</span> <span class="keyword">Then</span></span><br><span class="line">        Open FPath <span class="keyword">For</span> Output <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">        Write <span class="meta">#1, "127.0.0.1", "juan"</span></span><br><span class="line">        Close <span class="meta">#1</span></span><br><span class="line">        remoteip.<span class="keyword">Text</span> = <span class="string">"127.0.0.1"</span></span><br><span class="line">        nickname.<span class="keyword">Text</span> = <span class="string">"juan"</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        Open FPath <span class="keyword">For</span> Input <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">        Input <span class="meta">#1, info_ip, info_name</span></span><br><span class="line">        Close <span class="meta">#1</span></span><br><span class="line">        remoteip.<span class="keyword">Text</span> = info_ip</span><br><span class="line">        nickname.<span class="keyword">Text</span> = info_name</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="comment">'字体信息</span></span><br><span class="line">    <span class="keyword">If</span> Dir(fontpath) &lt;&gt; <span class="string">""</span> <span class="keyword">Then</span></span><br><span class="line">        Open fontpath <span class="keyword">For</span> Input <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">        Input <span class="meta">#1, font_name, font_size, font_underline, font_strikethru, font_bold, font_italic, font_color</span></span><br><span class="line">        Close <span class="meta">#1</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    record.Font.Size = font_size</span><br><span class="line">    msg.Font.Size = font_size</span><br><span class="line">    <span class="comment">'信息文本清空</span></span><br><span class="line">    record.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">    msg.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">With</span> StatusBar</span><br><span class="line">        .Panels(<span class="number">1</span>).<span class="keyword">Text</span> = <span class="string">"Local IP:"</span> + server.LocalIP</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">    <span class="comment">'打开监听端口</span></span><br><span class="line">    <span class="keyword">Call</span> setport</span><br><span class="line">    <span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line">errhandle:</span><br><span class="line">    MsgBox <span class="string">"load_Err:"</span> + Err.Description</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> lang() <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    localid = GetSystemDefaultLCID</span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> localid</span><br><span class="line">        <span class="keyword">Case</span> &amp;H404 <span class="comment">'繁体语言</span></span><br><span class="line">            lang = <span class="string">"cht"</span></span><br><span class="line">        <span class="keyword">Case</span> &amp;H804 <span class="comment">'简体语言</span></span><br><span class="line">            lang = <span class="string">"chs"</span></span><br><span class="line">        <span class="keyword">Case</span> &amp;H409 <span class="comment">'English</span></span><br><span class="line">            lang = <span class="string">"en"</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'设置client and server端口</span></span><br><span class="line"><span class="keyword">Sub</span> setport()</span><br><span class="line"><span class="keyword">With</span> server</span><br><span class="line">    .LocalPort = <span class="number">40000</span></span><br><span class="line">    .Listen</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">With</span> client</span><br><span class="line">    .LocalPort = <span class="number">40001</span></span><br><span class="line">    .RemotePort = <span class="number">40000</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">With</span> fileserver</span><br><span class="line">    .LocalPort = <span class="number">40002</span></span><br><span class="line">    .Listen</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">With</span> fileclient</span><br><span class="line">    .LocalPort = <span class="number">40003</span></span><br><span class="line">    .RemotePort = <span class="number">40002</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> clientconnect()</span><br><span class="line"><span class="keyword">With</span> client</span><br><span class="line">    .Close</span><br><span class="line">    .RemoteHost = remoteip.<span class="keyword">Text</span></span><br><span class="line">    .connect</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> fileclientconnect()</span><br><span class="line"><span class="keyword">With</span> fileclient</span><br><span class="line">    .Close</span><br><span class="line">    .RemoteHost = remoteip.<span class="keyword">Text</span></span><br><span class="line">    .connect</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Activate()</span><br><span class="line">    remoteip.SetFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'界面大小重置</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Resize()</span><br><span class="line">    <span class="keyword">Call</span> ResizeForm(<span class="keyword">Me</span>)</span><br><span class="line">    <span class="keyword">If</span> <span class="keyword">Me</span>.WindowState = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">        StatusBar.Panels(<span class="number">1</span>).Width = <span class="keyword">Me</span>.ScaleWidth * <span class="number">0.5</span></span><br><span class="line">        StatusBar.Panels(<span class="number">2</span>).Width = <span class="keyword">Me</span>.ScaleWidth * <span class="number">0.5</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'界面卸载</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Unload(Cancel <span class="keyword">As</span> <span class="built_in">Integer</span>)</span><br><span class="line">    server.Close</span><br><span class="line">    client.Close</span><br><span class="line">    fileserver.Close</span><br><span class="line">    fileclient.Close</span><br><span class="line">    <span class="keyword">Call</span> TrayRemoveIcon</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'字体</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Font_Click()</span><br><span class="line"><span class="keyword">Dim</span> FPath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    CommonDialog1.CancelError = <span class="literal">True</span></span><br><span class="line">    CommonDialog1.Flags = cdlCFBoth <span class="keyword">Or</span> cdlCFEffects</span><br><span class="line">    CommonDialog1.ShowFont</span><br><span class="line">    <span class="keyword">If</span> Err = cdlCancel <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Exit</span> <span class="keyword">Sub</span> <span class="comment">'对话框取消退出</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        font_name = CommonDialog1.FontName</span><br><span class="line">        font_size = CommonDialog1.FontSize</span><br><span class="line">        font_underline = CommonDialog1.FontUnderline</span><br><span class="line">        font_strikethru = CommonDialog1.FontStrikethru</span><br><span class="line">        font_bold = CommonDialog1.FontBold</span><br><span class="line">        font_italic = CommonDialog1.FontItalic</span><br><span class="line">        font_color = CommonDialog1.Color</span><br><span class="line">        <span class="comment">'保存字体信息</span></span><br><span class="line">        <span class="keyword">If</span> CommonDialog1.Action = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">            FPath = App.path &amp; <span class="string">"\Data\font.ini"</span></span><br><span class="line">            Open FPath <span class="keyword">For</span> Output <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">            Write <span class="meta">#1, font_name, font_size, font_underline, font_strikethru, font_bold, font_italic, font_color</span></span><br><span class="line">            Close <span class="meta">#1</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> min_Click()</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">Call</span> TrayAddIcon(<span class="keyword">Me</span>, Picture1, <span class="string">"For juan"</span>, NIIF_ICON_MASK)</span><br><span class="line">    <span class="keyword">If</span> min.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Me</span>.Visible = <span class="literal">False</span> <span class="comment">'让程序界面不可见</span></span><br><span class="line">        <span class="keyword">Call</span> TrayIcon(Picture1(<span class="number">1</span>).Picture)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_MouseMove(Button <span class="keyword">As</span> <span class="built_in">Integer</span>, Shift <span class="keyword">As</span> <span class="built_in">Integer</span>, x <span class="keyword">As</span> <span class="built_in">Single</span>, y <span class="keyword">As</span> <span class="built_in">Single</span>)</span><br><span class="line"><span class="keyword">Static</span> Message <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line"><span class="comment">'x   is   the   current   mouse   location   along   the   x-axis</span></span><br><span class="line">Message = x / Screen.TwipsPerPixelX</span><br><span class="line"><span class="keyword">If</span> <span class="keyword">Me</span>.Visible = <span class="literal">False</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Select</span> <span class="keyword">Case</span> Message</span><br><span class="line"><span class="comment">'   Left   double   click</span></span><br><span class="line"><span class="keyword">Case</span> WM_LBUTTONDOWN</span><br><span class="line">    min.Value = <span class="number">0</span></span><br><span class="line">    <span class="keyword">Me</span>.Visible = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">If</span> newmsgTimer.Enabled = <span class="literal">True</span> <span class="keyword">Then</span></span><br><span class="line">    newmsgTimer.Enabled = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Call</span> TrayRemoveIcon</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'托盘图标闪烁</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> newmsgTimer_Timer()</span><br><span class="line">    a = <span class="keyword">Not</span> a</span><br><span class="line">    <span class="keyword">If</span> a = <span class="literal">True</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Call</span> TrayIcon(Picture1(<span class="number">0</span>).Picture)</span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        <span class="keyword">Call</span> TrayIcon(Picture1(<span class="number">1</span>).Picture)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'client向server请求连接</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Request_Click()</span><br><span class="line"><span class="keyword">Dim</span> FPath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    connect = <span class="literal">True</span></span><br><span class="line">    FPath = App.path &amp; <span class="string">"\Data\info.ini"</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> errhandle</span><br><span class="line">    <span class="keyword">Call</span> clientconnect  <span class="comment">'文本信息连接</span></span><br><span class="line">    <span class="keyword">Call</span> fileclientconnect <span class="comment">'文件发送连接</span></span><br><span class="line">    <span class="keyword">If</span> info_ip &lt;&gt; remoteip.<span class="keyword">Text</span> <span class="keyword">Or</span> info_name &lt;&gt; nickname.<span class="keyword">Text</span> <span class="keyword">Then</span></span><br><span class="line">        Open FPath <span class="keyword">For</span> Output <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">        Write <span class="meta">#1, remoteip.Text, nickname.Text</span></span><br><span class="line">        Close <span class="meta">#1</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    msg.SetFocus</span><br><span class="line">    <span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line">errhandle:</span><br><span class="line">    MsgBox <span class="string">"request_connect_Err:"</span> + Err.Description</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'server连接请求</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> server_ConnectionRequest(<span class="keyword">ByVal</span> requestID <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line">    remoteip = server.RemoteHostIP</span><br><span class="line">    <span class="keyword">If</span> MsgBox(<span class="string">"request ip:"</span> + remoteip, vbOKCancel) = vbOK <span class="keyword">Then</span></span><br><span class="line">        remoteip.<span class="keyword">Text</span> = remoteip</span><br><span class="line">        <span class="keyword">If</span> server.State &lt;&gt; sckClosed <span class="keyword">Then</span></span><br><span class="line">             server.Close</span><br><span class="line">             server.Accept requestID</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'发送文本信息</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> send_Click()</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> errhandle</span><br><span class="line"><span class="keyword">Dim</span> sendtext <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> time <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> record_length <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> msg_length <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> faceid <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> facestart <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line">    time = Format(Now(), <span class="string">"hh:mm:ss"</span>)</span><br><span class="line">    <span class="comment">'format是格式化输出日期和时间格式函数,yyyy-mm-dd是完整显示年月日，hh:mm:ss是显示时分秒。</span></span><br><span class="line">    sendtext = Replace(msg.<span class="keyword">Text</span>, vbCrLf, <span class="string">""</span>)</span><br><span class="line">    sendtext = nickname.<span class="keyword">Text</span> &amp; <span class="string">" "</span> &amp; time &amp; <span class="string">":"</span> &amp; vbCrLf &amp; sendtext &amp; vbCrLf</span><br><span class="line">    record_length = Len(record.<span class="keyword">Text</span>)</span><br><span class="line">    msg_length = Len(sendtext)</span><br><span class="line">    record.SelStart = record_length</span><br><span class="line">    <span class="keyword">Call</span> AddText(record, sendtext, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">With</span> record</span><br><span class="line">        .SelStart = record_length</span><br><span class="line">        .SelLength = msg_length</span><br><span class="line">        <span class="comment">'Dim font_name, font_size, font_underline, font_strikethru, font_bold, font_italic, font_color</span></span><br><span class="line">        .SelFontName = font_name</span><br><span class="line">        .SelFontSize = font_size</span><br><span class="line">        .SelUnderline = font_underline</span><br><span class="line">        .SelStrikeThru = font_strikethru</span><br><span class="line">        .SelBold = font_bold</span><br><span class="line">        .SelItalic = font_italic</span><br><span class="line">        .SelColor = font_color</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">    msg.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">    <span class="comment">'表情图片</span></span><br><span class="line">    facestart = record.Find(<span class="string">"/ali"</span>, record_length)</span><br><span class="line">    <span class="keyword">If</span> facestart &gt; <span class="number">-1</span> <span class="keyword">Then</span></span><br><span class="line">        faceid = <span class="keyword">Mid</span>(record.<span class="keyword">Text</span>, facestart + <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">        record.SelStart = facestart</span><br><span class="line">        record.SelLength = <span class="number">7</span></span><br><span class="line">        <span class="keyword">Call</span> facepic(Richtemp, faceid)</span><br><span class="line">        record.SelText = Richtemp.TextRTF</span><br><span class="line">        <span class="keyword">Call</span> rich_backspace(record)</span><br><span class="line">        Richtemp.TextRTF = <span class="string">""</span></span><br><span class="line">        msg.SetFocus</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    record.SelStart = Len(record.<span class="keyword">Text</span>)</span><br><span class="line">    client.SendData sendtext</span><br><span class="line">    <span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line">errhandle:</span><br><span class="line">    MsgBox Err.Description</span><br><span class="line">    Request.Enabled = <span class="literal">True</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'server接收数据</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> server_DataArrival(<span class="keyword">ByVal</span> bytesTotal <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="keyword">Dim</span> receivetext <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> forehwnd <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> facestart <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> faceid <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> record_length <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    server.GetData receivetext</span><br><span class="line">    record_length = Len(record.<span class="keyword">Text</span>)</span><br><span class="line">    record.SelStart = record_length</span><br><span class="line">    <span class="keyword">Call</span> AddText(record, receivetext, <span class="string">""</span>)</span><br><span class="line">    facestart = record.Find(<span class="string">"/ali"</span>, record_length)</span><br><span class="line">    <span class="keyword">If</span> facestart &gt; <span class="number">-1</span> <span class="keyword">Then</span></span><br><span class="line">        faceid = <span class="keyword">Mid</span>(record.<span class="keyword">Text</span>, facestart + <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">        record.SelStart = facestart</span><br><span class="line">        record.SelLength = <span class="number">7</span></span><br><span class="line">        <span class="keyword">Call</span> facepic(Richtemp, faceid)</span><br><span class="line">        record.SelText = Richtemp.TextRTF</span><br><span class="line">        <span class="keyword">Call</span> rich_backspace(record)</span><br><span class="line">        Richtemp.TextRTF = <span class="string">""</span></span><br><span class="line">        msg.SetFocus</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    record.SelStart = Len(record.<span class="keyword">Text</span>)</span><br><span class="line">    forehwnd = GetForegroundWindow()</span><br><span class="line">    <span class="keyword">If</span> <span class="keyword">Me</span>.hWnd &lt;&gt; forehwnd <span class="keyword">Then</span></span><br><span class="line">        Timer.Enabled = <span class="literal">True</span></span><br><span class="line">        Timer.Interval = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> min.Value = <span class="number">1</span> <span class="keyword">And</span> newmsgTimer.Enabled = <span class="literal">False</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">With</span> newmsgTimer</span><br><span class="line">            .Enabled = <span class="literal">True</span></span><br><span class="line">            .Interval = <span class="number">500</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> servertimer_Timer()</span><br><span class="line">    StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Connect Status"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">    <span class="keyword">If</span> client.State = <span class="number">7</span> <span class="keyword">Or</span> client.State = <span class="number">6</span> <span class="keyword">Or</span> fileclient.State = <span class="number">7</span> <span class="keyword">Or</span> fileclient.State = <span class="number">6</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">If</span> client.State = <span class="number">7</span> <span class="keyword">And</span> fileclient.State = <span class="number">7</span> <span class="keyword">Then</span></span><br><span class="line">        connect = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        Request.Enabled = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">If</span> server.State = <span class="number">7</span> <span class="keyword">And</span> fileserver.State = <span class="number">7</span> <span class="keyword">Then</span></span><br><span class="line">            remoteip.Enabled = <span class="literal">False</span></span><br><span class="line">            nickname.Enabled = <span class="literal">False</span></span><br><span class="line">            StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Connect OK!"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">        <span class="keyword">Else</span></span><br><span class="line">            <span class="keyword">If</span> client.State = <span class="number">7</span> <span class="keyword">And</span> fileclient.State = <span class="number">7</span> <span class="keyword">Then</span></span><br><span class="line">                StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Server Ok!"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">            <span class="keyword">Else</span></span><br><span class="line">                StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Connecting!"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        <span class="keyword">If</span> server.State &lt;&gt; <span class="number">2</span> <span class="keyword">And</span> server.State &lt;&gt; <span class="number">7</span> <span class="keyword">And</span> fileserver.State &lt;&gt; <span class="number">2</span> <span class="keyword">And</span> fileserver.State &lt;&gt; <span class="number">7</span> <span class="keyword">Then</span></span><br><span class="line">            server.Close</span><br><span class="line">            server.Listen</span><br><span class="line">            fileserver.Close</span><br><span class="line">            fileserver.Listen</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        <span class="keyword">If</span> connect = <span class="literal">True</span> <span class="keyword">Then</span></span><br><span class="line">            <span class="keyword">If</span> client.State &lt;&gt; <span class="number">6</span> <span class="keyword">Then</span></span><br><span class="line">                <span class="keyword">Call</span> clientconnect</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">            <span class="keyword">If</span> fileclient.State &lt;&gt; <span class="number">6</span> <span class="keyword">Then</span></span><br><span class="line">                <span class="keyword">Call</span> fileclientconnect</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">            StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Connect retry!"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">        <span class="keyword">Else</span></span><br><span class="line">            <span class="keyword">If</span> client.State = <span class="number">8</span> <span class="keyword">Or</span> fileclient.State = <span class="number">8</span> <span class="keyword">Then</span></span><br><span class="line">                client.Close</span><br><span class="line">                fileclient.Close</span><br><span class="line">                server.Close</span><br><span class="line">                fileserver.Close</span><br><span class="line">                Request.Enabled = <span class="literal">True</span></span><br><span class="line">                remoteip.Enabled = <span class="literal">True</span></span><br><span class="line">                nickname.Enabled = <span class="literal">True</span></span><br><span class="line">                StatusBar.Panels(<span class="number">2</span>).<span class="keyword">Text</span> = <span class="string">"Connect Closed!"</span> &amp; <span class="string">"-"</span> &amp; server.State &amp; client.State &amp; fileserver.State &amp; fileclient.State</span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> client.State = sckClosing <span class="keyword">Then</span></span><br><span class="line">        client.Close</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> server.State = sckClosing <span class="keyword">Then</span></span><br><span class="line">        server.Close</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> fileclient.State = sckClosing <span class="keyword">Then</span></span><br><span class="line">        fileclient.Close</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> fileserver.State = sckClosing <span class="keyword">Then</span></span><br><span class="line">        fileserver.Close</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> skin_Click()</span><br><span class="line"><span class="keyword">Dim</span> path <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> skinpath <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    skinpath = App.path &amp; <span class="string">"\Data\skin.ini"</span></span><br><span class="line">    <span class="keyword">With</span> CommonDialog1</span><br><span class="line">        .CancelError = <span class="literal">True</span></span><br><span class="line">        .DialogTitle = <span class="string">"Select Skin"</span></span><br><span class="line">        <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> cancelerr</span><br><span class="line">        .Filter = <span class="string">"Skin(*.skn)|*.skn"</span></span><br><span class="line">        .InitDir = App.path &amp; <span class="string">"\Data\Skins"</span></span><br><span class="line">        .ShowOpen</span><br><span class="line">        path = .FileName</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">    Open skinpath <span class="keyword">For</span> Output <span class="keyword">As</span> <span class="meta">#1</span></span><br><span class="line">    Write <span class="meta">#1, path</span></span><br><span class="line">    Close <span class="meta">#1</span></span><br><span class="line">    Skin1.RemoveSkin <span class="keyword">Me</span>.hWnd</span><br><span class="line">    Skin1.LoadSkin path</span><br><span class="line">    Skin1.ApplySkin <span class="keyword">Me</span>.hWnd</span><br><span class="line">cancelerr:</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Timer_Timer()</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">Call</span> FlashWindow(<span class="keyword">Me</span>.hWnd, <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">If</span> <span class="keyword">Me</span>.WindowState &lt;&gt; vbMinimized <span class="keyword">Then</span></span><br><span class="line">        Timer.Enabled = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> msg_KeyUp(KeyCode <span class="keyword">As</span> <span class="built_in">Integer</span>, Shift <span class="keyword">As</span> <span class="built_in">Integer</span>)</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> KeyCode = <span class="number">13</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Call</span> send_Click</span><br><span class="line">        msg.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'截图调用</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command1_Click()</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line"><span class="keyword">Dim</span> path <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">    path = App.path &amp; <span class="string">"\Data\Printscreen.exe"</span></span><br><span class="line">    Shell path</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileclient_DataArrival(<span class="keyword">ByVal</span> bytesTotal <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="keyword">Dim</span> wskcommand <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> cmdarr() <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">Dim</span> filebyte() <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">If</span> onaccept <span class="keyword">Then</span></span><br><span class="line">    fileclient.GetData filebyte, vbArray + vbByte</span><br><span class="line">    Put <span class="meta">#FileNumber, , filebyte</span></span><br><span class="line">    <span class="comment">'------------进度显示----------</span></span><br><span class="line">    client_VarPlus = client_VarPlus + (UBound(filebyte) + <span class="number">1</span>)</span><br><span class="line">    ReceiveLabel.Caption = <span class="string">"Down:"</span> &amp; Left(Str((client_VarPlus / client_ProBarLen) * <span class="number">100</span>), <span class="number">4</span>) &amp; <span class="string">"%"</span></span><br><span class="line">    <span class="comment">'------------------------------</span></span><br><span class="line">    client_LenFile = client_LenFile - (UBound(filebyte) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">If</span> client_LenFile = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">        onaccept = <span class="literal">False</span></span><br><span class="line">        Close <span class="meta">#FileNumber</span></span><br><span class="line">        MsgBox <span class="string">"receive ok!"</span>, vbInformation, <span class="string">"Tips"</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">fileclient.GetData wskcommand</span><br><span class="line">cmdarr = Split(wskcommand, <span class="string">","</span>)</span><br><span class="line"><span class="keyword">If</span> cmdarr(<span class="number">0</span>) = <span class="string">"SendFile"</span> <span class="keyword">Then</span></span><br><span class="line">    <span class="keyword">If</span> MsgBox(<span class="string">"Do you want to receive file from remote client?"</span>, vbQuestion + vbYesNo, <span class="string">"File Tips"</span>) = vbYes <span class="keyword">Then</span></span><br><span class="line">    <span class="keyword">With</span> CommonDialog1</span><br><span class="line">        .CancelError = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> saveerr</span><br><span class="line">        .DialogTitle = <span class="string">"Save to..."</span></span><br><span class="line">        .FileName = cmdarr(<span class="number">1</span>)</span><br><span class="line">        .Filter = <span class="string">"All Files(*.*)|*.*"</span></span><br><span class="line">        .Flags = &amp;H4 <span class="keyword">Or</span> &amp;H2</span><br><span class="line">        .ShowSave</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">    fileclient.SendData <span class="string">"OkSend"</span></span><br><span class="line">    client_LenFile = Val(cmdarr(<span class="number">2</span>))</span><br><span class="line">    client_ProBarLen = client_LenFile</span><br><span class="line">    client_VarPlus = <span class="number">0</span></span><br><span class="line">    onaccept = <span class="literal">True</span></span><br><span class="line">    FileNumber = FreeFile</span><br><span class="line">    Open CommonDialog1.FileName <span class="keyword">For</span> <span class="keyword">Binary</span> <span class="keyword">As</span> <span class="meta">#FileNumber</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">    fileclient.SendData <span class="string">"NoThanks"</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line">saveerr:</span><br><span class="line">    fileclient.SendData <span class="string">"NoThanks"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'文件服务响应连接请求</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileserver_ConnectionRequest(<span class="keyword">ByVal</span> requestID <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line">    <span class="keyword">If</span> fileserver.State &lt;&gt; sckClosed <span class="keyword">Then</span></span><br><span class="line">        fileserver.Close</span><br><span class="line">        fileserver.Accept requestID</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'文件服务server响应</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileserver_DataArrival(<span class="keyword">ByVal</span> bytesTotal <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="keyword">Dim</span> wskchat <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">fileserver.GetData wskchat</span><br><span class="line"><span class="keyword">If</span> wskchat = <span class="string">"NoThanks"</span> <span class="keyword">Then</span></span><br><span class="line">    MsgBox <span class="string">"Refused"</span>, vbExclamation, <span class="string">"server"</span></span><br><span class="line">    <span class="keyword">ElseIf</span> wskchat = <span class="string">"OkSend"</span> <span class="keyword">Then</span></span><br><span class="line">    MsgBox <span class="string">"accept"</span> &amp; vbCrLf &amp; vbCrLf &amp; <span class="string">"Click OK to receive"</span>, vbInformation, <span class="string">"server"</span></span><br><span class="line">    GetFileNum = FreeFile</span><br><span class="line">    server_LenFile = FileLen(Text1.<span class="keyword">Text</span>)</span><br><span class="line">    server_ProBarLen = server_LenFile</span><br><span class="line">    server_VarPlus = <span class="number">0</span></span><br><span class="line">    Open Text1.<span class="keyword">Text</span> <span class="keyword">For</span> <span class="keyword">Binary</span> <span class="keyword">As</span> <span class="meta">#GetFileNum</span></span><br><span class="line">    onsend = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">Call</span> TCPSendFile(fileserver, GetFileNum, splitfile)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'文件服务winsock发送完成</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> fileserver_SendComplete()</span><br><span class="line"><span class="keyword">If</span> onsend <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">If</span> <span class="number">0</span> = server_LenFile <span class="keyword">Then</span></span><br><span class="line">    Close <span class="meta">#GetFileNum</span></span><br><span class="line">    onsend = <span class="literal">False</span></span><br><span class="line">    MsgBox <span class="string">"send complete!"</span>, vbInformation, <span class="string">"server"</span></span><br><span class="line">    <span class="keyword">Else</span>: <span class="keyword">Call</span> TCPSendFile(fileserver, GetFileNum, splitfile)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'文件分割</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> splitfile() <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> getcount <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">If</span> server_LenFile &gt;= <span class="number">8192</span> <span class="keyword">Then</span></span><br><span class="line">    getcount = <span class="number">8192</span></span><br><span class="line">    server_LenFile = server_LenFile - getcount</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">    getcount = server_LenFile</span><br><span class="line">    server_LenFile = server_LenFile - getcount</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">server_VarPlus = server_VarPlus + getcount</span><br><span class="line">SendLabel.Caption = <span class="string">"Up:"</span> &amp; Left(Str((server_VarPlus / server_ProBarLen) * <span class="number">100</span>), <span class="number">4</span>) &amp; <span class="string">"%"</span></span><br><span class="line">splitfile = getcount</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'发送文件</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> TCPSendFile(objWinSock <span class="keyword">As</span> Winsock, FileNumber <span class="keyword">As</span> <span class="built_in">Integer</span>, SendLen <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line">    <span class="keyword">Dim</span> filebyte() <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line">    <span class="keyword">ReDim</span> filebyte(SendLen - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">Get</span> <span class="meta">#FileNumber, , filebyte</span></span><br><span class="line">    objWinSock.SendData filebyte</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'请求发送</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command2_Click()</span><br><span class="line"><span class="keyword">With</span> CommonDialog1</span><br><span class="line">    .CancelError = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> openerr</span><br><span class="line">    .DialogTitle = <span class="string">"Open"</span></span><br><span class="line">    .Filter = <span class="string">"All Files(*.*)|*.*"</span></span><br><span class="line">    .Flags = &amp;H4</span><br><span class="line">    .InitDir = App.path</span><br><span class="line">    .ShowOpen</span><br><span class="line">    Text1.<span class="keyword">Text</span> = .FileName</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">fileserver.SendData <span class="string">"SendFile,"</span> &amp; Dir(Text1.<span class="keyword">Text</span>) &amp; <span class="string">","</span> &amp; FileLen(Text1.<span class="keyword">Text</span>)</span><br><span class="line">openerr:</span><br><span class="line"><span class="keyword">If</span> Err.Number = <span class="number">32755</span> <span class="keyword">Or</span> Err.Number = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">MsgBox Err.Description &amp; Err.Number</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>vb</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW可重入</title>
    <url>/2012/03/11/120311-labview-reentrant/</url>
    <content><![CDATA[<h1 id="LabVIEW-可重入"><a href="#LabVIEW-可重入" class="headerlink" title="LabVIEW 可重入"></a>LabVIEW 可重入</h1><ol>
<li><p>LabVIEW 新建的 VI 中，默认为不可重入，它只有一份数据空间，在同一时刻只能有一个调用方运行该 VI，其他调用方则必须“等轮到自己”。<br>使用非可重入子 VI 的理由：<br>节省硬件空间（资源）。非可重入 VI 只使用硬件的一个空间。如果您 FPGA 应用中空间是一个重要问题，您可以将可重复利用的代码写入到非可重入子 VI 中以节省空间。<br>在一个 VI 中只有一个子 VI 的实例。当只有一个子 VI 实例时，您的选择就没有任何区别。因此，请保留默认设置。<br>非可重入子 VI 可以用来在独立循环间存储以及传输数据。由于该子 VI 的所有调用者都使用相同的门资源，因此最后一个调用子 VI 而得到的值可以用在下一个调用者中。</p>
</li>
<li><p>LabVIEW 的 VI 可以设置为可重入</p>
<p>如果选择了在实例间共享副本， 该 VI 就会有一个数据空间池(也称为副本池)。在调用 VI 开始时，最初只创建两个副本。一个调用方将使用这两个数据空间之一，但不一定是哪个。后来的调用方也可能使用不同的实例。当数据池中的数据空间(副本)少于同时调用方的数量时，将会创建新的数据空间(副本)并将它们添加到池中。“实例间共享副本”中的“之间共享”一词意味着随着时间的推移，这些数据空间可以被多个调用方使用。如果该子 VI 有 20 个调用方，但这 20 个调用方中只有 2 个会同时运行，那么池中就将只有两个数据空间，这两个空间会在 20 个调用方间被“共享”。这种可重入方式的优点是能优化存储空间的使用。只根据当前需求创建必要数量的副本。</p>
<p>相比之下，如果选择了预分配副本选项，将会为每一个调用方创建一个私有的数据空间(和副本)。如果该 VI 有 20 个调用方，就将在调用 VI 开始时创建 20 个副本并将它们添加到池中。如果调用模式像上面描述的一样，可能每次只有两个调用方同时运行。当每个调用方使用同一子 VI 的副本很重要时(例如，如果子 VI 需要在每次调用后保持数据)，那么就使用这种可重入 VI。. 在这种情况下共享副本类型将无法工作，因为您无法知道最后一次调用的是子 VI 的那个实例和将使用的是哪个实例，且存储的信息将会在子 VI 间发生无法预知的“串扰”。“预分配”意味着每次调用时，都会为该调用方创建一个数据空间和副本。预分配发生在 VI 运行前。<br>如果您希望同时打开同一 VI 的多个前面板，可重入子 VI 选项就无法做到。为了打开一个 VI 的多个实例，有两种方法可供选择：<br>如果您希望多次打开的是一个顶层 VI， 可以将该顶层 VI 复制到一个临时路径下并取不同的名字，然后再打开这个新的文件实例。但子 VI 就没有必要使用复制，仅顶层 VI 需要使用这种复制的方法。您可以使用 VI 服务器打开并运行副本。<br>第二种方法是将多实例面板放入一个模板 VI 中，然后每次从该模板 VI 打开文件。VI 模板是扩展名为.vit 的 VI。您可以从文件»新建»基于模板下面的模板创建一个新 VI。这将创建一个新的 VI 实例，它有自己的存储空间。<br>您可以使用 VI 服务器打开 VI 和 VI 模板。VI 服务器用于动态加载并运行 VI。对于带有子 VI 的情况，只有加载顶层 VI 时子 VI 才被加载。当您动态加载一个 VI，而不是将它作为子 VI 时，它的代码将不会被加载直到 VI 服务器调用该子 VI。这会节省内存和启动时间。</p>
</li>
</ol>
<h1 id="使用可重入子-VI-的理由："><a href="#使用可重入子-VI-的理由：" class="headerlink" title="使用可重入子 VI 的理由："></a>使用可重入子 VI 的理由：</h1><p>您的子 VI 有两个及更多的循环。在并行循环中将子 VI 设置为非可重入可导致循环要等待每次的执行，而无论子 VI 被同一时间调用还是正在运行。这会在维护实时性上导致无法预料的抖动。这会降低运行速率。<br>空间没有限制，而速度是重要的。您的程序相对较小，但是需要以较高速率保持实时性，或者需要快速运行。<br>并行线程需要有它们自己实例的子 VI，以保证子 VI 的调用者之间不会出现数据传输的情况。</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>彩色图像的四种模型以及转化为黑白图像</title>
    <url>/2011/12/08/111208-color-bw/</url>
    <content><![CDATA[<p>彩色图像的四种模型：RGB、HSL、HSV、HSI。（YUV）<br>RGB：Red（红）、Green（绿）、Blue（蓝）<br>HSL：Hue（色调）、Saturation（饱和度 ）、Luminance（亮度 ）<br>HSV：Hue（色调）、Saturation（饱和度 ）、Value（亮度 ）<br>HSI：Hue（色调）、Saturation（饱和度 ）、Intensity（亮度 ）</p>
<p>资料来源：百度百科(RGB\HSL\HSV\HSI)</p>
<h1 id="HSL-与-RGB-转换"><a href="#HSL-与-RGB-转换" class="headerlink" title="HSL 与 RGB 转换"></a>HSL 与 RGB 转换</h1><p>a) RGB→HSL 的算法描述。</p>
<p>步骤 1：把 RGB 值转成【0，1】中数值。</p>
<p>步骤 2：找出 R,G 和 B 中的最大值。<br>　　步骤 3：设 L=(maxcolor + mincolor)/2</p>
<p>步骤 4：如果最大和最小的颜色值相同，即表示灰色，那么 S 定义为 0，而 H 未定义并在程序中通常写成 0。</p>
<p>步骤 5：否则，测试 L：</p>
<p>If L&lt;0.5, S=(maxcolor-mincolor)/(maxcolor + mincolor)</p>
<p>If L&gt;=0.5, S=(maxcolor-mincolor)/(2.0-maxcolor-mincolor)</p>
<p>步骤 6: If R=maxcolor, H=(G-B)/(maxcolor-mincolor)</p>
<p>If G=maxcolor, H=2.0+(B-R)/(maxcolor-mincolor)</p>
<p>If B=maxcolor, H=4.0+(R-G)/(maxcolor-mincolor)</p>
<p>步骤 7：从第 6 步的计算看，H 分成 0 ～ 6 区域。RGB 颜色空间是一个立方体而 HSL 颜色空间是两个六角形锥体，其中的 L 是 RGB 立方体的主对角线。因此，RGB 立方体的顶点：红、黄、绿、青、蓝和品红就成为 HSL 六角形的顶点，而数值 0 ～ 6 就告诉我们 H 在哪个部分。H=H*60.0,如果 H 为负值，则加 360。</p>
<p>b) HSL→RGB 的算法描述。</p>
<p>步骤 1：If S=0,表示灰色，定义 R,G 和 B 都为 L.</p>
<p>步骤 2：否则，测试 L:</p>
<p>If L&lt;0.5,temp2=L*(1.0+S)</p>
<p>If L&gt;=0.5,temp2=L+S-L*S</p>
<p>步骤 3：temp1=2.0*-temp2</p>
<p>步骤 4：把 H 转换到 0 ～ 1。</p>
<p>步骤 5：对于 R,G,B，计算另外的临时值 temp3。方法如下：</p>
<p>for R, temp3=H+1.0/3.0</p>
<p>for G, temp3=H</p>
<p>for B, temp3=H-1.0/3.0</p>
<p>if temp3&lt;0, temp3=temp3+1.0</p>
<p>if temp3&gt;1, temp3=temp3-1.0</p>
<p>步骤 6：对于 R,G,B 做如下测试：</p>
<p>If 6.0<em>temp3&lt;1,color=temp1+(temp2-temp1)</em>6.0*temp3</p>
<p>Else if 2.0*temp3&lt;1,color=temp2</p>
<p>Else if 3.0*temp3&lt;2,</p>
<p>color=temp1+(temp2-temp1)<em>((2.0/3.0)-temp3)</em>6.0</p>
<p>Else color=temp1</p>
<h1 id="HSV-与-RGB-转换"><a href="#HSV-与-RGB-转换" class="headerlink" title="HSV 与 RGB 转换"></a>HSV 与 RGB 转换</h1><ol>
<li>RGB 转化到 HSV 的算法</li>
</ol>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">max</span>=<span class="built_in">max</span>(R,G,B)<span class="number">2</span>:</span><br><span class="line"></span><br><span class="line"><span class="built_in">min</span>=<span class="built_in">min</span>(R,G,B)</span><br><span class="line"></span><br><span class="line">V=<span class="built_in">max</span>(R,G,B)<span class="number">11</span></span><br><span class="line"></span><br><span class="line">:</span><br><span class="line"></span><br><span class="line">S=(<span class="built_in">max</span>-<span class="built_in">min</span>)/max3:</span><br><span class="line"></span><br><span class="line">ifR = <span class="built_in">max</span>,H = (G-B)/(<span class="built_in">max</span>-<span class="built_in">min</span>)\* <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ifG = <span class="built_in">max</span>,H = <span class="number">120</span>+ (B-R)/(<span class="built_in">max</span>-<span class="built_in">min</span>)\* <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ifB = <span class="built_in">max</span>,H = <span class="number">240</span> + (R-G)/(<span class="built_in">max</span>-<span class="built_in">min</span>)\* <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ifH &lt; <span class="number">0</span>,H = H+ <span class="number">360</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>HSV 转化到 RGB 的算法</li>
</ol>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> s = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">R=G=B=V</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">H /= <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">i</span> = INTEGER(H)</span><br><span class="line"></span><br><span class="line">f = H - <span class="built_in">i</span></span><br><span class="line"></span><br><span class="line">a = V \* ( <span class="number">1</span> - s )</span><br><span class="line"></span><br><span class="line">b = V _ ( <span class="number">1</span> - s _ f )</span><br><span class="line"></span><br><span class="line">c = V _ ( <span class="number">1</span> - s _ (<span class="number">1</span> - f ) )</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(<span class="built_in">i</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: R = V; G = c; B = a;</span><br><span class="line">　　 <span class="keyword">case</span> <span class="number">1</span>: R = b; G = v; B = a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>: R = a; G = v; B = c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>: R = a; G = b; B = v;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>: R = c; G = a; B = v;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>: R = v; G = a; B = b;</span><br></pre></td></tr></table></figure>

<h1 id="HSI-与-RGB-转换"><a href="#HSI-与-RGB-转换" class="headerlink" title="HSI 与 RGB 转换"></a>HSI 与 RGB 转换</h1><p>1、 球体变换公式：<br>令 M=max(R,G,B) m=min(R,G,B)，其中 r g b 至少有一个为 0 或 1，则有：</p>
<p>(1)明度</p>
<pre><code>I=(M+m)/2</code></pre><p>(2)饱和度</p>
<p>当 M=m 时，S=0</p>
<p>当 M≠m 时，I≤0.5，则 S=(M-m)/(M+m)</p>
<p>当 M≠m 时，I&gt;0.5，则 S=(M-m)/(2-M-m)</p>
<p>(3)色度</p>
<p>当 S=0 时，H=0；</p>
<p>当 S≠0，R=M，则 H=60(2+b-g)，这时色度位于黄和品红之间；</p>
<p>当 S≠0，G=M，则 H=60(4+r-b)，这时色度位于青和黄色之间；</p>
<p>当 S≠0，B=M，则 H=60(6+g-r)，这时色度位于品红和青之间；</p>
<p>2、三角变换公式：</p>
<p>(1)明度</p>
<p>I=(R+G+B)/3</p>
<p>(2)色度</p>
<p>S=1-min{R+B+G}/I</p>
<p>(3)色度</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>Vision</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW Additional Installers Page Blank and Disabled</title>
    <url>/2011/12/08/111208-labview-setup-err/</url>
    <content><![CDATA[<h1 id="LabVIEW-生成安装文件时如下错误："><a href="#LabVIEW-生成安装文件时如下错误：" class="headerlink" title="LabVIEW 生成安装文件时如下错误："></a>LabVIEW 生成安装文件时如下错误：</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CDK_CreateNewWizard_Invoke.vi.ProxyCaller &gt;&gt; CDK_CreateNewWizard_Invoke.vi &gt;&gt; CDK_InstallerConfiguration_Editor.vi &gt;&gt; CDK_Build_Invoke.vi &gt;&gt; CDK_Engine_Main.vi &gt;&gt; CDK_Engine_PreBuild.vi &gt;&gt; CDK_Validate_DistParts.vi &gt;&gt; CDK_DistParts_GetInstalledProducts.vi &gt;&gt; NI_MDF.lvlib:MDFCommon_Open.vi</span><br></pre></td></tr></table></figure>

<p>可能原因是 labview 进行了相关升级或者第三方插件安装。</p>
<h1 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h1><ol>
<li>把 labview 在控制面板里面修复</li>
<li>注册表</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\National Instruments\Common\Installer\MDF]</span><br><span class="line">&quot;CommonAppDataBin&quot;=&quot;C:\\Documents and Settings\\All Users\\Application Data\\National Instruments\\MDF\\Bin\\&quot;</span><br><span class="line">&quot;CommonAppDataProductCache&quot;=&quot;C:\\Documents and Settings\\All Users\\Application Data\\National Instruments\\MDF\\ProductCache\\&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>可以把生成安装文件记录下来进行相关分析</p>
<ol>
<li>Check C:\Program Files\National Instruments\Shared\MDF\Manifests to see if it contains files</li>
<li>Enable CDK.EnableLog=true in the LabVIEW.ini file, restart LabVIEW, launch the installer build rule editor again. Retrieve log file from current user’s temp folder. Log file name matches build spec name (e.g. My Installer.log).</li>
</ol>
<p>检查安装目录下的文件是否存在，将 LabVIEW.ini 里面的 CDK.EnableLog 设置为 true，记录日志。</p>
</li>
</ol>
<p><a href="http://search.ni.com/nisearch/app/main/p/bot/no/ap/global/lang/zhs/pg/4/q/Additional%20Installers/scope/en%2Czh-CN/" target="_blank" rel="noopener">http://search.ni.com/nisearch/app/main/p/bot/no/ap/global/lang/zhs/pg/4/q/Additional%20Installers/scope/en%2Czh-CN/</a></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW飞天忍者猫</title>
    <url>/2011/11/15/111115-labview-cat/</url>
    <content><![CDATA[<h1 id="程序介绍"><a href="#程序介绍" class="headerlink" title="程序介绍"></a>程序介绍</h1><ol>
<li>打开文件夹“Cat”里面的 Main.vi,程序设置为“打开自动运行”;</li>
<li>运行将进入加载界面，加载完成后进入游戏界面；</li>
<li>点击“游戏开始”，将开始游戏；</li>
<li>游戏方法：按“SPACE”将进入跳跃；按“SHIFT+SPACE”跳跃的更高，可穿越障碍。</li>
</ol>
<h1 id="评定"><a href="#评定" class="headerlink" title="评定"></a>评定</h1><p>基本功能：（50’）</p>
<p>简化为“控制目标跨越障碍的运动（跳过沟壑）”</p>
<ol>
<li>目标（如：猫）的运动；</li>
<li>随着目标的运动，在前进的方向上会有障碍（如有一定宽度的间隙）出现；</li>
<li>目标可以通过键盘进行人为的控制（如跳跃）以跨越该障碍；</li>
</ol>
<p>附加功能：</p>
<ol>
<li>随着跨越障碍的增多，难度增加（如速度加快）；（20）</li>
<li>不同起始难度的选择；（20）</li>
<li>键盘或鼠标都可以使用；（10）</li>
<li>跨越障碍数的计分并显示；（10）</li>
<li>障碍的变化（如间隙的宽度等）；（10）</li>
<li>在前进的方向上有其他额外辅助得分的手段（如增加金钱的获取等）；（30）</li>
<li>优秀的界面设计（界面的美化，菜单的设计等等）；（10）</li>
<li>良好的程序说明；（10）</li>
<li>允许玩家暂停或重新开始任务；（15）</li>
<li>允许玩家保存退出游戏并在下次继续；（15）</li>
<li>游戏结束时 top10 玩家的显示；（10）</li>
<li>多人游戏；（20）</li>
<li>………………</li>
</ol>
<h1 id="画面"><a href="#画面" class="headerlink" title="画面"></a>画面</h1><p><img src="/attach/flycat.jpg" alt="flycat"></p>
<h1 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h1><p>有需求联系<a href="mailto:tosobright@qq.com" target="_blank" rel="noopener">Email</a></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW界面设计 LabVIEW Dock</title>
    <url>/2011/11/15/111115-labview-dock/</url>
    <content><![CDATA[<h1 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h1><ol>
<li><p>打开 Main.vi 进入程序主界面；</p>
</li>
<li><p>程序自动加载自带的快捷方式以及更新天气。<br>2.1 已设置 6 个快捷方式<br>2.2 天气使用的是 Google 的 API，不要多次连接哦，否则它会屏蔽<br>你的 IP 的啊，到时候就会更新失败</p>
</li>
<li><p>更新：点击将更新快捷方式、走马灯以及天气（不要一直点哦，小心被<br>Google 加入黑名单）</p>
</li>
<li><p>设置：<br>4.1 天气设置</p>
<p>这里有城市可以选择，选择后，点击 OK，将更新所选择城市的天气。<br>（这里的 VI 可以从 Google 的 API 借口获取城市列表，我为了防止 Google 把我们拉入黑名单，就将我获取的城市的 XML 文件保存了，这就不用从网络重新获取了，大家也可以更改为网络获取，不过这个貌似不会怎么更新）</p>
<p>4.2 快捷键</p>
<p>快捷键：默认的，不可更新，Shortcut 1→Shortcut 2<br>名称：快捷方式的名称<br>图标：快捷方式显示的图片（要求：PNG 格式，最好为 52<em>52</em>32，<br>制作图标 PNG，可以使用 IcoFX，功能强大）<br>命令与快命令：<br>这里有 2 种，一种为快命令，只要输入需求的应用程序支持的扩展名，<br>并将快命令设置为 Ture 即可；另一种就是 DOS 命令了。<br>最后，每设置完成一个 Shortcut 后，记得点击“Set“来保存参数。</p>
<p>4.3 走马灯</p>
<p>文本为显示文字，步长为循环的速度，大小写为字符的大小写切换。</p>
<p>4.4 系统<br> 皮肤：程序背景图片（800*100，PNG 格式）</p>
<p>5 关闭：</p>
<p>单击退出程序，并恢复系统任务栏，不从这里关闭，系统任务栏将不可见。</p>
<p>6Labview 快捷键以及 6 个快捷键：</p>
<p>这里设置的是双击打开，6 个快捷键可以自由拖拽并自行保存。</p>
<p>7 天气</p>
<p>从 Google 的 API 获取。显示项目有城市、温度（摄氏）、湿度以及风向。</p>
</li>
</ol>
<h1 id="Dock"><a href="#Dock" class="headerlink" title="Dock"></a>Dock</h1><p><img src="/attach/dock.png" alt="dock"></p>
<h1 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h1><p>有需求联系<a href="mailto:tosobright@qq.com" target="_blank" rel="noopener">Email</a></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>天下最不能等的是孝顺</title>
    <url>/2011/11/04/111104-piety/</url>
    <content><![CDATA[<p>&emsp;&emsp;据说美国人只认钱，把亲情孝悌之类看得很淡，可咱们国家是讲究并重视孝道的，羊羔跪乳、乌鸦反哺一直被人们所称道。孝顺的人多被人赞扬，孝顺的事常被人赞同。《水浒传》中，假李鬼撞上真李逵，原本遭杀无疑，但一句“家中有 80 岁老母”，便被放了一条活路。最近报道，有个打爹骂娘的不肖之子，逼得爹娘难以生存，竟一失手杀了儿子。法院审理期间，全村百姓竟联名上书，请求宽恕二位老人，一致谴责不孝子的恶行。人心是秤，定盘星总是在“孝顺”上。</p>
<p>&emsp;&emsp;有些人并非不赞同孝顺，而认为孝顺是可以等一等、缓一缓的事情。譬如，上学读书时，认为父母年轻力壮，挣钱供给儿女读书应该，用不着儿女孝顺。参加工作后，认为爹娘无病无灾，个人结婚生子，拉家带口，顾不上孝顺。人到中年后，孩子尚未成家，工作忙忙活活，社交应酬繁忙，没机会孝顺。转眼人过半百，鬓染白霜，身体有病，腿懒脚迟，无能力孝顺。凡此种种，一推再拖，不承认不孝顺，只说是没条件、没办法、没能力、没机会，似乎孝顺必得要具备什么条件、拉开什么架势、等待什么时机才能够去做。</p>
<p>&emsp;&emsp;孝顺怎么能够等待呢？我不止一次地耳闻目睹，有些人在老人过世后痛心疾首、捶胸顿足，自责在老人活着的时候没有如何如何。父母仙逝方知孝，委实是晚了，早干什么去了？长大成人、娶妻生子了，更应该体会到父母养育的恩德，即便父母此时健康无病，也应该抽出时间携妻带子常回家看看。父母不图你捎多少东西财物，就是愿意子孙绕膝、全家欢聚，享受天伦之乐。这点时间你都“忙得抽不出来”，还说什么孝顺？父母年老多病之日，更是想儿、盼儿之时，也是儿女的尽孝之机。有的人借口没有时间，有的人以为给老人寄去一些钱物就代替了孝心。“不孝顺”的下场只能怪自己，怨不得别人。</p>
<p>&emsp;&emsp;孝顺不孝顺，并不取决于钱的多少，最重要的是亲情，是父母精神心理上的满足和愉悦。简单说，爹娘老了，一碗热水捧到老人面前就是孝顺。</p>
<p>&emsp;&emsp;孝顺就是孝顺，原本没有什么大道理可讲。孝顺不难，让老人高兴、满意、顺心就是孝顺。父恩比山高，母恩比海深。孝顺不可等待，应当时刻持守、终身力行，至少要做到问心无愧。</p>
]]></content>
      <categories>
        <category>Diary</category>
      </categories>
  </entry>
  <entry>
    <title>实现LabVIEW制作的安装程序的卸载！</title>
    <url>/2011/07/28/110728-labview-uninstall/</url>
    <content><![CDATA[<h1 id="LabVIEW-安装程序的卸载命令"><a href="#LabVIEW-安装程序的卸载命令" class="headerlink" title="LabVIEW 安装程序的卸载命令"></a>LabVIEW 安装程序的卸载命令</h1><p>labview 安装程序的卸载命令，读取注册表中自己制作的安装程序的卸载命令！</p>
<p><img src="/attach/201172621495899.jpg" alt="uninstall"></p>
<p>这样大家就可以调用这个 VI 来实现程序的卸载了！</p>
<p><img src="/attach/201172621553126.jpg" alt="cmd"></p>
<h1 id="实现类似其他安装程式的卸载"><a href="#实现类似其他安装程式的卸载" class="headerlink" title="实现类似其他安装程式的卸载"></a>实现类似其他安装程式的卸载</h1><p><img src="/attach/201172821117133.jpg" alt="qq"></p>
<ul>
<li>首先，我们建立个工程，添加 Main.vi</li>
<li>再建立个 uninstall，同样 Build 个应用程序！</li>
</ul>
<p><img src="/attach/201172821657145.jpg" alt="project"></p>
<ul>
<li><p>之后就是建立 install 程序</p>
<p><img src="/attach/2011728211412182.jpg" alt="set"></p>
</li>
<li><p>ProductName 这个就是我们要进行卸载的 labview 产品名称！</p>
<p><img src="/attach/2011728211812115.jpg" alt="set1"></p>
<p><img src="/attach/2011728211824188.jpg" alt="set2"></p>
<p><img src="/attach/2011728211831175.jpg" alt="set3"></p>
</li>
<li><p>这样就可以 Build 了！</p>
</li>
<li><p>其他信息自己添就可以了！</p>
</li>
<li><p>注意在 uninstall 里面的 ProductName 要和上面的名称相同！并把界面关闭！</p>
</li>
</ul>
<p><img src="/attach/2011728212221124.jpg" alt="set4"></p>
<h1 id="来看看效果把！"><a href="#来看看效果把！" class="headerlink" title="来看看效果把！"></a>来看看效果把！</h1><p><img src="/attach/2011728212450157.jpg" alt="set5"></p>
<ul>
<li>这个就是调用卸载的效果图片</li>
</ul>
<p><img src="/attach/201172821261119.jpg" alt="set6"></p>
<ul>
<li>用上面的 VI 得到的命令就是下图</li>
</ul>
<p><img src="/attach/2011728212824124.jpg" alt="set7"></p>
<p>好了，介绍结束，知道怎么使用上面的 VI 了把</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW6.1运行在ubuntu上（问题）</title>
    <url>/2011/07/24/110724-labview-ubuntu/</url>
    <content><![CDATA[<p>安装：<br>sudo alien *.rpm<br>双击安装即可！</p>
<p><a href="http://digital.ni.com/public.nsf/allkb/A48092A8F10BE02E862569CA005CB625" target="_blank" rel="noopener">http://digital.ni.com/public.nsf/allkb/A48092A8F10BE02E862569CA005CB625</a></p>
<p><a href="http://digital.ni.com/public.nsf/allkb/A2D53C8E0D88380B86256EBD005B31D2" target="_blank" rel="noopener">http://digital.ni.com/public.nsf/allkb/A2D53C8E0D88380B86256EBD005B31D2</a></p>
<p>toso@ubuntu:~$ cd usr/local/lv61</p>
<p>toso@ubuntu:/usr/local/lv61$ su root</p>
<p>密码：</p>
<p>root@ubuntu:/usr/local/lv61# ldconfig</p>
<p>root@ubuntu:/usr/local/lv61# ls</p>
<p>Activity examples labview manuals resource user.lib</p>
<p>AppLibs help libLVMesaGL.so.3 menus serpdrv vi.lib</p>
<p>cintools instr.lib linux project templates www</p>
<p>root@ubuntu:/usr/local/lv61# cp libLVMesaGL.so.3 /usr/local/lib</p>
<p>root@ubuntu:/usr/local/lv61# cp libLVMesaGL.so.3 /usr/lib</p>
<p>root@ubuntu:/usr/local/lv61# ./labview</p>
<p>LabVIEW caught fatal signal</p>
<p>6.1 - Received SIGSEGV</p>
<p>Reason: address not mapped to object</p>
<p>Attempt to reference address: 0x75756ea5</p>
<p>段错误</p>
<p>root@ubuntu:/usr/local/lv61# ./labview</p>
<p>root@ubuntu:/usr/local/lv61# mount</p>
<p>/dev/loop0 on / type ext4 (rw,errors=remount-ro,commit=0)</p>
<p>proc on /proc type proc (rw,noexec,nosuid,nodev)</p>
<p>none on /sys type sysfs (rw,noexec,nosuid,nodev)</p>
<p>fusectl on /sys/fs/fuse/connections type fusectl (rw)</p>
<p>none on /sys/kernel/debug type debugfs (rw)</p>
<p>none on /sys/kernel/security type securityfs (rw)</p>
<p>none on /dev type devtmpfs (rw,mode=0755)</p>
<p>none on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)</p>
<p>none on /dev/shm type tmpfs (rw,nosuid,nodev)</p>
<p>none on /var/run type tmpfs (rw,nosuid,mode=0755)</p>
<p>none on /var/lock type tmpfs (rw,noexec,nosuid,nodev)</p>
<p>/dev/sda8 on /host type fuseblk (rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other,blksize=4096)</p>
<p>binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)</p>
<p>gvfs-fuse-daemon on /home/toso/.gvfs type fuse.gvfs-fuse-daemon (rw,nosuid,nodev,user=toso)</p>
<p>/dev/sda2 on /media/Win7 type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>/dev/sda5 on /media/Program type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>/dev/sda6 on /media/Document type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>/dev/sda7 on /media/Work type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>/dev/sda4 on /media/Winxp type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>/dev/sda9 on /media/Game type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096,default_permissions)</p>
<p>root@ubuntu:/usr/local/lv61# tune2fs -O ^dir_index /dev/loop0</p>
<p>tune2fs 1.41.14 (22-Dec-2010)</p>
<p>root@ubuntu:/usr/local/lv61# ./labview</p>
<p><img src="/attach/201172413272150.png" alt="LabVIEW"></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW 调用 VB 创建的 dll 动态链接库</title>
    <url>/2011/06/25/110625-labview-vb-dll/</url>
    <content><![CDATA[<h1 id="创建-DLL-文件（方法来自网络）"><a href="#创建-DLL-文件（方法来自网络）" class="headerlink" title="创建 DLL 文件（方法来自网络）"></a>创建 DLL 文件（方法来自网络）</h1><p>VB 编译文件实际上采取了两次编译的方法</p>
<ol>
<li>首先是调用 c2.exe 产生 OBJ 文件</li>
<li>然后调用 Link.exe 连接。</li>
</ol>
<p>如果在 link 的时候添加 EXPORT 选项，实际上是可以输出函数的。但是，在 VB 的工程选项中将这些屏蔽了，VB 在 Build 完成后会将 OBJ 文件删除，这样就无法通过 Link 来输出函数了。<br>这里，可以使用一个小软件来阻止 VB 将 OBJ 文件删除，如图：</p>
<p><img src="/attach/VBLINK.jpg" alt="LabVIEW"></p>
<p>这个 link.exe 是用来替换 VB 中的 link.exe;而原来的 link.exe 改名为 link2.exe。<br>我们这里来创建个 dll 文件，添加个模块，在里面添加代码如下：<br>Public Function sysfont(ByVal a As Long, ByVal b As Long) As Long<br>sysfont = a + b<br>End Function<br>当我们创建了个 dll 工程后，进行生成 dll 文件时，就会弹出上图的编译对话框，我们就可以将该工程文件夹中的 Class1.OBJ、Module1.OBJ 和工程 1.OBJ 复制出来！<br>这里点击确定可以生成无输出函数的 dll 文件，点击取消则不会生成，不过会提示相应的错误信息！<br>将上面的 3 个文件提取出来后，就可以下面的批处理文件来生成 dll 文件了！<br>Link2.exe “E:\桌面\vb_dll\Class1.obj” “E:\桌面\vb_dll\Module1.obj” “E:\桌面\vb_dll\工程 1.obj” “D:\Microsoft Visual Studio\VB98\VBAEXE6.LIB” /ENTRY:__vbaS /EXPORT:sysfont /OUT:”E:\桌面\vb_dll\ProjectOK.dll” /BASE:0x11000000 /SUBSYSTEM:WINDOWS,4.0 /VERSION:1.0 /Dll /INCREMENTAL:NO /OPT:REF /MERGE:.rdata=.text /IGNORE:4078<br>pause&amp;.<br>我们可以把上面的代码保存成 link.bat 然后将里面的路径和函数名修改即可自动生成了！</p>
<h1 id="LabVIEW-的调用"><a href="#LabVIEW-的调用" class="headerlink" title="LabVIEW 的调用"></a>LabVIEW 的调用</h1><p>生成了 dll 文件后，就可以使用调用库函数节点了！</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p><a href="/attach/DLL-VB.zip">DLL 工程以及相应工具</a><br><a href="/attach/labview_example.zip">LabVIEW 调用例子</a></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
        <tag>vb</tag>
        <tag>dll</tag>
      </tags>
  </entry>
  <entry>
    <title>duanwu</title>
    <url>/2011/06/06/110606-duanwu/</url>
    <content><![CDATA[<h1 id="端午节快乐"><a href="#端午节快乐" class="headerlink" title="端午节快乐"></a>端午节快乐</h1><p><a href="http://news.shm.com.cn/2011-06/05/content_3491425_2.htm" target="_blank" rel="noopener">来自网络</a></p>
<ol>
<li><p>我是棕叶你是米，一层一层裹住你；你是牙齿我是米，香香甜甜粘住你；棕子里有多少米，代表我有多想你。记得给我发消息，不然棕子噎死你！</p>
</li>
<li><p>知道我想啥吗？想你知道为啥想你吗？因为喜欢。你知道为啥喜 欢你吗？因为你的味道。知道为啥有味道吗？因为你是粽子，提前祝端午节快乐！</p>
</li>
<li><p>端午是夕阳中远山的剪影，你还停在我的画布中；只是我怕，今天疾驶而过，明天飞奔地来，而所有昨天的细节，早已支离破碎……</p>
</li>
<li><p>喜讯：端午节当天，手机号头两位数字是 13 的用户，可以到街边小摊上免费领取粽子，当然，事先要抹上烫伤膏以防被摊主的开水泼到。</p>
</li>
<li><p>端午节来了，我送你一枚粽子，友情是外皮，里面第一层是祝福，第二层是幸福，第三层是心想事成，对了，第四层当然就是你写的欠条，快还钱给我！</p>
</li>
<li><p>相思日久留片心，竹子折半必人为，白去一直心等勺，目中偷走心一片，生死为了等一下，直下二点忘情水，身上立下十条心，故约无边寻芳草。</p>
</li>
<li><p>秘诀：将手机用粽叶包好，放在锅里煮 60 分钟，手机电池续电能力将延长两倍，信号增强，并且打电话时能闻到粽子香味。</p>
</li>
<li><p>粽子香，香厨房；艾叶香，香满堂；桃枝插在大门上，出门一望麦儿黄；这儿端阳，那儿端阳，处处端阳处处祥。祝福亲爱的朋友端午节快乐！</p>
</li>
<li><p>如果一朵花代表一个祝福，我送给你整个春天！如果一朵白云代表一份幸运，我送给你整个天空！愿我能把世上最好的祝福带给你，祝端午节快乐！</p>
</li>
<li><p>朋友不一定合情合理，但一定知心知意；不一定形影不离，但一定心心相惜；不一定常常联络，但一定放在心上；身为朋友的我，祝你端午节快乐。</p>
</li>
<li><p>人生无需惊天动地，快乐就好；友谊无需甜言蜜语，想着就好；金钱无需车载斗量，够用就好；朋友无需遍及天下，有你就好，祝端午节快乐！</p>
</li>
<li><p>天使说只要站在用心画的九十九朵郁金香前许愿，上帝就会听到。我把花画满整个房间，终于上帝对我说：许愿吧。我说：要看短信的人端午节快乐！</p>
</li>
<li><p>其实天很蓝，阴云总要散，其实海不宽，此岸到彼岸，其实梦很浅，万物皆自然，其实泪也甜，祝你心如愿，我的想法很简单，只要你快乐！祝端午节开心！</p>
</li>
<li><p>走过山山水水，脚下高高低低；经历风风雨雨，还要寻寻觅觅；生活忙忙碌碌，获得多多少少，失去点点滴滴，重要的是开开心心！祝端午节快乐！</p>
</li>
<li><p>睁开眼晴时，希望你能看到我祝福，祝你有个阳光般的心情；闭上眼睛前，要你收到我的问候，晚上做个好梦，祝端午节快乐！</p>
</li>
<li><p>你是多愁善感的乌鸦，你是活蹦乱跳的青蛙，你是洁白的地瓜，你是我心中火红的大虾，我想祝福看我短信的傻瓜：永远流着幸福的哈拉，祝端午节快乐！</p>
</li>
<li><p>一笑忧愁跑，二笑烦恼消，三笑心情好，四笑不变老，五笑兴致高，六笑幸福绕，七笑快乐到，八笑收入好，九笑步步高，十全十美乐逍遥，端午节快乐！</p>
</li>
<li><p>今日端午，让我托诗人的福，请你多吃些粽子；让我驾一叶龙舟，满载祝福驶向你；让我挂一把艾蒿在你门前，愿你平安；让我为你斟一杯雄黄酒，盼你安康。</p>
</li>
<li><p>桃儿红，杏儿黄，五月初五是端阳，粽子香，包五粮，剥个粽子裹上糖，幸福生活万年长，祝您端午节快乐！</p>
</li>
<li><p>一千朵玫瑰给你，要你好好爱自己；一千只纸鹤给你，烦恼永远离开你；一千颗幸运星给你，好运一直围绕你！祝端午节愉快！</p>
</li>
<li><p>睁开眼晴时，希望你能看到我祝福，祝你有个阳光般的心情；闭上眼睛前，要你收到我的问候，晚上做个好梦，祝端午节快乐！</p>
</li>
<li><p>每一片花瓣，都带有我真挚的祝福，款款关怀，绵绵祝福，声声问候，拜托清风传送，愿鲜花与绿叶结伴，点缀你绚丽的人生，愿你端午节快乐！</p>
</li>
<li><p>总希望快乐将你围绕；总盼望幸福把你拥抱；总期望健康与你同在；总奢望能为你做的更多。祝福你，我亲爱的朋友，端午节快乐。</p>
</li>
<li><p>我是粽叶你是米，一层一层裹住你；你是牙齿我是米，香香甜甜粘住你；粽子里有多少米，代表我有多想你；记得给我回短信，不然粽子噎着你！端午快乐！</p>
</li>
<li><p>送给你一阵轻风，带着我的问候；送给你一缕月光，映着我的影像；送给你一片白云，浸透我的温暖；送给你一条短信，连接你我友谊，祝端午节快乐。</p>
</li>
<li><p>让阳光走进你的窗，让快乐飞到你身旁！在开心中抽根愉悦的线，为你织件好运衣裳；在幸福里磨根如意的针，为你缝上永远吉祥，祝端午节快乐！</p>
</li>
<li><p>落日余辉，映着彩霞，迎着微风，向着天际。丝丝柔柔的微风，传去了节日的祝辞，飘向远方的你，愿你度过这美好的一切，端午节快乐！</p>
</li>
<li><p>粽子香，香厨房；艾叶香，香满堂；桃枝插在大门上，出门一望麦儿黄；这儿端阳，那儿端阳，处处都端阳。祝福亲爱的朋友端午节快乐！</p>
</li>
<li><p>你是那绿豆，我就是那多情的王八，我温柔地凝望你——眼泪吧嗒；你是那天鹅，我就是那热烈的癞蛤蟆，小夜曲唱了一整夜——呱呱呱！</p>
</li>
<li><p>愿你每天用大海的胸怀面对，用小猪的感觉熟睡，用南非的阳光晒背，用盖茨的美元消费，用布什的千金陪醉，用拉登的方法逃税！祝端午快乐！</p>
</li>
</ol>
<p>送你一个粽子，含量成分:100%纯关心；配料:甜蜜+快乐+开心+宽容+忠诚=幸福；保质期:一辈子；保存方法:珍惜。</p>
<ol start="31">
<li><p>如果一朵花代表一个祝福，我送给你整个春天！如果一朵白云代表一份幸运，我送给你整个天空！愿我能把世上最好的祝福带给你，祝端午节快乐！</p>
</li>
<li><p>大家都夸你敏而好学，学什么像什么，我记得那天你学刘德华唱歌，真的很像耶。端午节来了，我想你也应该给大家模仿一下屈原跳江自杀，如何？</p>
</li>
<li><p>一千朵玫瑰给你，要你好好爱自己；一千只纸鹤给你，烦恼永远离开你；一千颗幸运星给你，好运一直围绕你！祝端午节愉快！</p>
</li>
<li><p>粽子香，香厨房；艾叶香，香满堂；桃枝插在大门上，出门一望麦儿黄；这儿端阳，那儿端阳，处处端阳处处祥。祝福亲爱的朋友端午节快乐！</p>
</li>
<li><p>五月五，是端阳，民俗节日不能忘；荡起浆，推开浪，龙舟下水喜洋洋；艾草青，粽米香，快乐祝福冠群芳；戴香包，喝雄黄，驱邪防病保健康。端午快乐！</p>
</li>
<li><p>家和睦，人似仙，潇洒走人间；酒当歌，曲轻弹，霓霞舞翩翩；花儿美，碧水涟，日月彩云间；梦成真，福禄全，祝愿开心每一天；祝端午节快乐！</p>
</li>
<li><p>端午已至，奉上粽子。配料：五颗快乐枣，一把关心米，三钱友情水，用幽默捆扎，由手机送达。保质期：五月初五前。保存法：请按存储键。</p>
</li>
<li><p>缘分，让我遇见你；开心，让我认识你；牵挂，让我想起你；友谊，让我们在一起；信息，让我不得不发给你；祝愿你一切都如意，端午节快乐！</p>
</li>
<li><p>有一种快乐漂漂洒洒，有一种自在平平淡淡，有一种幸福安安静静，有一种拥有实实在在，有一种友谊长长久久，有一个你，我天天祝福，祝端午节快乐！</p>
</li>
<li><p>今天端午节！我收集世上一切美好的东西为原料，用无忧为外衣，以我的真心祝福为丝带为你包了一个特别的粽子送给你！吃了它你永远快乐，幸福。</p>
</li>
<li><p>愿你每天用大海的胸怀面对，用小猪的感觉熟睡，用南非的阳光晒背，用盖茨的美元消费，用拉登的方法逃税！祝端午快乐！</p>
</li>
<li><p>粽子香，香厨房；艾叶香，香满堂；桃枝插在大门上，出门一望麦儿黄；这儿端阳，那儿端阳，处处端阳处处祥。祝福亲爱的朋友端午节快乐！</p>
</li>
<li><p>在友谊旅途上，有时你看不到我在你身旁；不是我把你遗忘，更不是让你一人走；是我选择走在你身后，当你不小心跌倒，我就跑上去踩…端午节快乐！</p>
</li>
<li><p>知道我想啥吗？想你！知道为啥想你吗？因为喜欢你！知道为啥喜欢你吗？因为你有味道！知道为啥有味道吗？因为你是粽子。祝你端午节快乐哟！</p>
</li>
<li><p>你的衣服整洁环保. 身体晶莹柔软. 皮肤洁白光滑. 内心丰富多彩. 身材匀称. 棱角分明. 气息芬芳。我真地喜欢你，亲爱的粽子！</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Diary</category>
      </categories>
  </entry>
  <entry>
    <title>LabVIEW99</title>
    <url>/2011/05/27/110527-labview-99/</url>
    <content><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><ul>
<li>使用 LabVIEW 打印出 99 乘法口诀</li>
<li>结果显示为 9 行 9 列的字符数组</li>
</ul>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><ol>
<li>利用 双 for 循环实现</li>
<li>内循环生成行，使用条件终止循环</li>
<li>外循环生成列</li>
<li>双循环索引生成结果，2 维数组</li>
</ol>
<h1 id="LabVIEW-实现"><a href="#LabVIEW-实现" class="headerlink" title="LabVIEW 实现"></a>LabVIEW 实现</h1><p><img src="/attach/99cfkj.png" alt="LabVIEW-99"></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW水仙花实现</title>
    <url>/2011/05/27/110527-labview-shuixianhua/</url>
    <content><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>打印出所有的“水仙花数”<br>所谓“水仙花数”是指一个三位数，其各位数字立方和等于该数本身。<br>例如：153 是一个“水仙花数”，因为 153=1 的三次方＋ 5 的三次方＋ 3 的三次方。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>利用 for 循环控制 100-999 个数，每个数分解出个位，十位，百位。</p>
<h1 id="C-程序实现"><a href="#C-程序实现" class="headerlink" title="C 程序实现"></a>C 程序实现</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> i,j,k,n;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"'water flower'number is:"</span>);</span><br><span class="line">  <span class="keyword">for</span>(n=<span class="number">100</span>;n&lt;<span class="number">1000</span>;n++)</span><br><span class="line">    &#123;</span><br><span class="line">    i=n/<span class="number">100</span>;</span><br><span class="line">    j=(n-i*<span class="number">100</span>)/<span class="number">10</span>;</span><br><span class="line">    k=n%<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span>(i*i*i+j*j*j+k*k*k==n)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="LabVIEW-实现"><a href="#LabVIEW-实现" class="headerlink" title="LabVIEW 实现"></a>LabVIEW 实现</h1><p><img src="/attach/shuixianhua.png" alt="LabVIEW水仙花"></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW冒泡排序</title>
    <url>/2011/05/27/110527-labview-maopao/</url>
    <content><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>实现冒泡排序算法</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>两两比较待排序记录的关键字，发现两个记录的次序相反时即进行交换，直到没有反序的记录为止。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>比较相邻的元素。如果第一个比第二个大，就交换他们两个。<br>对每一对相邻元素做同样的工作，从开始第一对到结尾的最后一对。在这一点，最后的元素应该会是最大的数。<br>针对所有的元素重复以上的步骤，除了最后一个。<br>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</p>
<h1 id="C-程序实现"><a href="#C-程序实现" class="headerlink" title="C 程序实现"></a>C 程序实现</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> i,j,temp;</span><br><span class="line">  <span class="keyword">int</span> a[<span class="number">10</span>];</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    <span class="built_in">scanf</span> (<span class="string">"%d,"</span>,&amp;a[i]);</span><br><span class="line">  <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;=<span class="number">9</span>;j++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">10</span>-j;i++)</span><br><span class="line">      <span class="keyword">if</span> (a[i]&gt;a[i+<span class="number">1</span>])</span><br><span class="line">      &#123;</span><br><span class="line">        temp=a[i];</span><br><span class="line">        a[i]=a[i+<span class="number">1</span>];</span><br><span class="line">        a[i+<span class="number">1</span>]=temp;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;<span class="number">11</span>;i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%5d,"</span>,a[i] );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="LabVIEW-实现"><a href="#LabVIEW-实现" class="headerlink" title="LabVIEW 实现"></a>LabVIEW 实现</h1><p><img src="/attach/maopao.png" alt="LabVIEW水仙花"></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>browser-vb</title>
    <url>/2011/05/04/110504-browser-vb/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>使用 VB 编写浏览器，调用 WebBrowser 控件</p>
<ul>
<li>网址导航</li>
<li>输入网址记录</li>
<li>多窗口</li>
<li>首页导航</li>
<li>页面的前进和后退</li>
<li>窗体的自适应</li>
<li>页面的刷新和停止</li>
</ul>
<p>还有更多功能，结合控件属性可以实现</p>
<h1 id="窗体"><a href="#窗体" class="headerlink" title="窗体"></a>窗体</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line">VERSION <span class="number">5.00</span></span><br><span class="line"><span class="built_in">Object</span> = <span class="string">"&#123;EAB22AC0-30C1-11CF-A7EB-0000C05BAE0B&#125;#1.1#0"</span>; <span class="string">"shdocvw.dll"</span></span><br><span class="line">Begin VB.Form Form1</span><br><span class="line">   Caption         =   <span class="string">"=YY="</span></span><br><span class="line">   ClientHeight    =   <span class="number">6390</span></span><br><span class="line">   ClientLeft      =   <span class="number">60</span></span><br><span class="line">   ClientTop       =   <span class="number">450</span></span><br><span class="line">   ClientWidth     =   <span class="number">9795</span></span><br><span class="line">   Icon            =   <span class="string">"Form1.frx"</span>:<span class="number">0000</span></span><br><span class="line">   LinkTopic       =   <span class="string">"Form1"</span></span><br><span class="line">   ScaleHeight     =   <span class="number">6390</span></span><br><span class="line">   ScaleWidth      =   <span class="number">9795</span></span><br><span class="line">   StartUpPosition =   <span class="number">3</span>  <span class="comment">'窗口缺省</span></span><br><span class="line">   WindowState     =   <span class="number">2</span>  <span class="comment">'Maximized</span></span><br><span class="line">   Begin SHDocVwCtl.WebBrowser WebBrowser1</span><br><span class="line">      Height          =   <span class="number">3495</span></span><br><span class="line">      Left            =   <span class="number">120</span></span><br><span class="line">      TabIndex        =   <span class="number">11</span></span><br><span class="line">      Top             =   <span class="number">480</span></span><br><span class="line">      Width           =   <span class="number">9255</span></span><br><span class="line">      ExtentX         =   <span class="number">16325</span></span><br><span class="line">      ExtentY         =   <span class="number">6165</span></span><br><span class="line">      ViewMode        =   <span class="number">0</span></span><br><span class="line">      Offline         =   <span class="number">0</span></span><br><span class="line">      Silent          =   <span class="number">0</span></span><br><span class="line">      RegisterAsBrowser=   <span class="number">0</span></span><br><span class="line">      RegisterAsDropTarget=   <span class="number">1</span></span><br><span class="line">      AutoArrange     =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      NoClientEdge    =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      AlignLeft       =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      NoWebView       =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      HideFileNames   =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      SingleClick     =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      SingleSelection =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      NoFolders       =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      Transparent     =   <span class="number">0</span>   <span class="comment">'False</span></span><br><span class="line">      ViewID          =   <span class="string">"&#123;0057D0E0-3573-11CF-AE69-08002B2E1262&#125;"</span></span><br><span class="line">      Location        =   <span class="string">"http:///"</span></span><br><span class="line">   <span class="keyword">End</span></span><br><span class="line">   Begin VB.Frame Frame1</span><br><span class="line">      Height          =   <span class="number">460</span></span><br><span class="line">      Left            =   <span class="number">120</span></span><br><span class="line">      TabIndex        =   <span class="number">0</span></span><br><span class="line">      Top             =   <span class="number">0</span></span><br><span class="line">      Width           =   <span class="number">9255</span></span><br><span class="line">      Begin VB.CommandButton Command9</span><br><span class="line">         Caption         =   <span class="string">"下"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">2760</span></span><br><span class="line">         TabIndex        =   <span class="number">12</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">300</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command8</span><br><span class="line">         Caption         =   <span class="string">"首"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">2400</span></span><br><span class="line">         TabIndex        =   <span class="number">10</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">375</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command7</span><br><span class="line">         Caption         =   <span class="string">"清"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">8760</span></span><br><span class="line">         TabIndex        =   <span class="number">9</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">375</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command6</span><br><span class="line">         Caption         =   <span class="string">"X"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">2160</span></span><br><span class="line">         TabIndex        =   <span class="number">8</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">255</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command5</span><br><span class="line">         Caption         =   <span class="string">"刷新"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">1560</span></span><br><span class="line">         TabIndex        =   <span class="number">6</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">615</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command4</span><br><span class="line">         Caption         =   <span class="string">"==&gt;"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">1080</span></span><br><span class="line">         TabIndex        =   <span class="number">5</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">495</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command3</span><br><span class="line">         Caption         =   <span class="string">"&lt;=="</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">600</span></span><br><span class="line">         TabIndex        =   <span class="number">4</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">495</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command2</span><br><span class="line">         Caption         =   <span class="string">"New"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">120</span></span><br><span class="line">         TabIndex        =   <span class="number">3</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">495</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.ComboBox Combo1</span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">3720</span></span><br><span class="line">         TabIndex        =   <span class="number">2</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">4335</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.CommandButton Command1</span><br><span class="line">         Caption         =   <span class="string">"转至"</span></span><br><span class="line">         Height          =   <span class="number">300</span></span><br><span class="line">         Left            =   <span class="number">8160</span></span><br><span class="line">         TabIndex        =   <span class="number">1</span></span><br><span class="line">         Top             =   <span class="number">120</span></span><br><span class="line">         Width           =   <span class="number">615</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.Line Line1</span><br><span class="line">         BorderColor     =   &amp;H80000011&amp;</span><br><span class="line">         X1              =   <span class="number">3120</span></span><br><span class="line">         X2              =   <span class="number">3120</span></span><br><span class="line">         Y1              =   <span class="number">120</span></span><br><span class="line">         Y2              =   <span class="number">420</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">      Begin VB.Label Label1</span><br><span class="line">         Alignment       =   <span class="number">2</span>  <span class="comment">'Center</span></span><br><span class="line">         AutoSize        =   <span class="number">-1</span>  <span class="comment">'True</span></span><br><span class="line">         Caption         =   <span class="string">"地址"</span></span><br><span class="line">         Height          =   <span class="number">180</span></span><br><span class="line">         Left            =   <span class="number">3240</span></span><br><span class="line">         TabIndex        =   <span class="number">7</span></span><br><span class="line">         Top             =   <span class="number">180</span></span><br><span class="line">         Width           =   <span class="number">375</span></span><br><span class="line">      <span class="keyword">End</span></span><br><span class="line">   <span class="keyword">End</span></span><br><span class="line"><span class="keyword">End</span></span><br><span class="line">Attribute VB_Name = <span class="string">"Form1"</span></span><br><span class="line">Attribute VB_GlobalNameSpace = <span class="literal">False</span></span><br><span class="line">Attribute VB_Creatable = <span class="literal">False</span></span><br><span class="line">Attribute VB_PredeclaredId = <span class="literal">True</span></span><br><span class="line">Attribute VB_Exposed = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"><span class="keyword">Dim</span> <span class="keyword">WithEvents</span> Web_V1 <span class="keyword">As</span> SHDocVwCtl.WebBrowser_V1</span><br><span class="line">Attribute Web_V1.VB_VarHelpID = <span class="number">-1</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Const</span> SplitWord = vbCrLf</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> SetWindowPos <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> hWndInsertAfter <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> x <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> y <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> cx <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> cy <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> wFlags <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> combo1_KeyPress(KeyAscii <span class="keyword">As</span> <span class="built_in">Integer</span>)</span><br><span class="line">  <span class="keyword">If</span> KeyAscii = <span class="number">13</span> <span class="keyword">Then</span></span><br><span class="line">  Command1_Click</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command1_Click()</span><br><span class="line">  WebBrowser1.Navigate Combo1.<span class="keyword">Text</span></span><br><span class="line">  <span class="keyword">If</span> Combo1.ListIndex &lt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">  Combo1.AddItem Combo1.<span class="keyword">Text</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command2_Click()</span><br><span class="line">  <span class="keyword">Dim</span> NewForm <span class="keyword">As</span> Form1</span><br><span class="line">  <span class="keyword">Set</span> NewForm = <span class="keyword">New</span> Form1</span><br><span class="line">  NewForm.Show</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command9_Click()</span><br><span class="line">  <span class="keyword">If</span> Command9.Caption = <span class="string">"下"</span> <span class="keyword">Then</span></span><br><span class="line">  Command9.Caption = <span class="string">"上"</span></span><br><span class="line">  SetWindowPos <span class="keyword">Me</span>.hwnd, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span></span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">  Command9.Caption = <span class="string">"下"</span></span><br><span class="line">  SetWindowPos <span class="keyword">Me</span>.hwnd, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Load()</span><br><span class="line">  <span class="keyword">Dim</span> s <span class="keyword">As</span> <span class="built_in">String</span>, ss() <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">  <span class="keyword">Dim</span> i <span class="keyword">As</span> <span class="built_in">Integer</span></span><br><span class="line">  WebBrowser1.Navigate <span class="string">"http://www.baidu.com"</span></span><br><span class="line">  <span class="keyword">Set</span> Web_V1 = WebBrowser1.<span class="built_in">Object</span></span><br><span class="line">  s = GetSetting(<span class="string">"OldUrl"</span>, <span class="string">"OldUrl"</span>, <span class="string">"OldUrl"</span>, <span class="string">""</span>)</span><br><span class="line">  <span class="keyword">If</span> s &lt;&gt; <span class="string">""</span> <span class="keyword">Then</span></span><br><span class="line">  ss = Split(s, SplitWord)</span><br><span class="line">  Combo1.Clear</span><br><span class="line">  <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> UBound(ss)</span><br><span class="line">  Combo1.AddItem ss(i)</span><br><span class="line">  <span class="keyword">Next</span></span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">  Combo1.AddItem <span class="string">"www.baidu.com"</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  Combo1.ListIndex = <span class="number">0</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_QueryUnload(Cancel <span class="keyword">As</span> <span class="built_in">Integer</span>, UnloadMode <span class="keyword">As</span> <span class="built_in">Integer</span>)</span><br><span class="line">  <span class="keyword">Dim</span> i <span class="keyword">As</span> <span class="built_in">Integer</span></span><br><span class="line">  <span class="keyword">Dim</span> s <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line">  <span class="keyword">With</span> Combo1</span><br><span class="line">  <span class="keyword">If</span> .ListCount &gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">  s = .List(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">For</span> i = <span class="number">1</span> <span class="keyword">To</span> .ListCount - <span class="number">1</span></span><br><span class="line">  s = s &amp; SplitWord &amp; .List(.ListIndex)</span><br><span class="line">  <span class="keyword">Next</span></span><br><span class="line">  SaveSetting <span class="string">"OldUrl"</span>, <span class="string">"OldUrl"</span>, <span class="string">"OldUrl"</span>, s</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command3_Click()</span><br><span class="line">  <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> <span class="comment">'如果出错</span></span><br><span class="line">  <span class="keyword">If</span> Err.Number &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">  WebBrowser1.GoBack</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command4_Click()</span><br><span class="line">  <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> <span class="comment">'如果出错</span></span><br><span class="line">  <span class="keyword">If</span> Err.Number &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">  WebBrowser1.GoForward</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command5_Click()</span><br><span class="line">  WebBrowser1.Refresh</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command6_Click()</span><br><span class="line">  WebBrowser1.<span class="keyword">Stop</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command8_Click()</span><br><span class="line">  WebBrowser1.Navigate <span class="string">"http://www.baidu.com"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command7_Click()</span><br><span class="line">  <span class="keyword">With</span> Combo1</span><br><span class="line">  <span class="keyword">If</span> .ListIndex &gt;= <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">If</span> .ListCount &gt; <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">  Combo1.RemoveItem .ListIndex</span><br><span class="line">  .ListIndex = <span class="number">0</span></span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">  MsgBox <span class="string">"至少应保留一个网址"</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Resize()</span><br><span class="line">  <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">  <span class="keyword">If</span> <span class="keyword">Me</span>.WindowState = vbMinimized <span class="keyword">Then</span> <span class="keyword">Exit</span> <span class="keyword">Sub</span> <span class="comment">'最小化时跳过</span></span><br><span class="line">  Frame1.Width = Width - <span class="number">340</span></span><br><span class="line">  Command7.Left = Frame1.Width - Command7.Width - <span class="number">100</span></span><br><span class="line">  Command1.Left = Command7.Left - Command1.Width</span><br><span class="line">  Combo1.Width = Frame1.Width - <span class="number">4800</span></span><br><span class="line">  WebBrowser1.Width = Frame1.Width</span><br><span class="line">  WebBrowser1.Height = Height - <span class="number">1100</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> WebBrowser1_DownloadComplete()</span><br><span class="line">  Combo1.<span class="keyword">Text</span> = WebBrowser1.LocationURL</span><br><span class="line">  Caption = <span class="string">"=YY="</span> + WebBrowser1.LocationName</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> WebBrowser1_NewWindow2(ppDisp <span class="keyword">As</span> <span class="built_in">Object</span>, Cancel <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line">  <span class="keyword">Dim</span> NewForm <span class="keyword">As</span> Form1</span><br><span class="line">  <span class="keyword">Set</span> NewForm = <span class="keyword">New</span> Form1</span><br><span class="line">  NewForm.Show</span><br><span class="line">  NewForm.WebBrowser1.RegisterAsBrowser = <span class="literal">True</span> <span class="comment">'防止名称相同</span></span><br><span class="line">  <span class="keyword">Set</span> ppDisp = NewForm.WebBrowser1.<span class="built_in">Object</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>vb</tag>
        <tag>browser</tag>
      </tags>
  </entry>
  <entry>
    <title>使用VB修改游戏内存参数（完美世界）</title>
    <url>/2011/04/06/110406-wanmei-vbwg/</url>
    <content><![CDATA[<h1 id="使用-API-介绍"><a href="#使用-API-介绍" class="headerlink" title="使用 API 介绍"></a>使用 API 介绍</h1><p>这里的代码提供的是使用 vb 修改游戏的内存数据，供大家参考<br>代码主要使用了</p>
<ul>
<li>窗体查找函数（FindWindow）</li>
<li>进程获取函数 （GetWindowThreadProcessId）</li>
<li>进程打开函数 （OpenProcess）</li>
<li>读取进程内存 （ReadProcessMemory）</li>
<li>写进程内存 （WriteProcessMemory）</li>
</ul>
<h1 id="代码-demo"><a href="#代码-demo" class="headerlink" title="代码 demo"></a>代码 demo</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">'--------------------------------定义------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Dim</span> hwd <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">' 储存 FindWindow 函数返回的句柄</span></span><br><span class="line"><span class="keyword">Dim</span> pid <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> hProcess <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存放进程句柄</span></span><br><span class="line"><span class="keyword">Dim</span> base <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存放人物基地址</span></span><br><span class="line"><span class="keyword">Dim</span> name_temp <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> mz(<span class="number">31</span>) <span class="keyword">As</span> <span class="built_in">Byte</span> <span class="comment">'名字</span></span><br><span class="line"><span class="keyword">Dim</span> hp <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存储生命值</span></span><br><span class="line"><span class="keyword">Dim</span> hpmax <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存储生命最大值</span></span><br><span class="line"><span class="keyword">Dim</span> mp <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存储真气值</span></span><br><span class="line"><span class="keyword">Dim</span> mpmax <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'存储真气最大值</span></span><br><span class="line"><span class="keyword">Dim</span> dengji <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'等级</span></span><br><span class="line"><span class="keyword">Dim</span> xiuzhen <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'修真</span></span><br><span class="line"><span class="keyword">Dim</span> money <span class="keyword">As</span> <span class="built_in">Long</span> <span class="comment">'金钱</span></span><br><span class="line"><span class="keyword">Dim</span> exp <span class="keyword">As</span> <span class="built_in">Double</span> <span class="comment">'经验</span></span><br><span class="line"><span class="keyword">Dim</span> yuanshen <span class="keyword">As</span> <span class="built_in">Double</span> <span class="comment">'元神</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'-------------------------配置--------------------------------</span></span><br><span class="line"><span class="keyword">Dim</span> ft <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, ft1 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, ft2 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span></span><br><span class="line"><span class="keyword">Dim</span> yc <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, yc1 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, yc2 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span></span><br><span class="line"><span class="keyword">Dim</span> cq <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, cq1 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, cq2 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span></span><br><span class="line"><span class="keyword">Dim</span> sy <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, sy1 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span>, sy2 <span class="keyword">As</span> <span class="built_in">String</span> _ <span class="number">255</span></span><br><span class="line"><span class="keyword">Dim</span> zft <span class="keyword">As</span> <span class="built_in">Long</span>, zft1 <span class="keyword">As</span> <span class="built_in">Long</span>, zft2 <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> zyc <span class="keyword">As</span> <span class="built_in">Long</span>, zyc1 <span class="keyword">As</span> <span class="built_in">Long</span>, zyc2 <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> zcq <span class="keyword">As</span> <span class="built_in">Long</span>, zcq1 <span class="keyword">As</span> <span class="built_in">Long</span>, zcq2 <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Dim</span> zsy <span class="keyword">As</span> <span class="built_in">Long</span>, zsy1 <span class="keyword">As</span> <span class="built_in">Long</span>, zsy2 <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'--------------------窗口代码------------------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Timer1_Timer()</span><br><span class="line">hwd = FindWindow(<span class="string">"ElementClient Window"</span>, <span class="string">"Element Client"</span>) <span class="comment">'获取窗口</span></span><br><span class="line">GetWindowThreadProcessId hwd, pid <span class="comment">'获取进程</span></span><br><span class="line">hProcess = OpenProcess(PROCESS_ALL_ACCESS, <span class="literal">False</span>, pid)</span><br><span class="line"></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> &amp;H92764C, base, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H20, base, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'一级基址</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H5CC, name_temp, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'得到角色名</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> name_temp, mz(<span class="number">0</span>), <span class="number">32</span>, <span class="number">0</span>&amp;</span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H450, hp, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'得到生命值</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H478, hpmax, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'得到生命最大值</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H454, mp, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'得到真气值</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H47C, mpmax, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'得到真气最大值</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H448, dengji, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'等级</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H270, xiuzhen, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'修真</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H2D4, money, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'金钱</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H458, exp, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'经验</span></span><br><span class="line">ReadProcessMemory hProcess, <span class="keyword">ByVal</span> base + &amp;H464, yuanshen, <span class="number">4</span>, <span class="number">0</span>&amp; <span class="comment">'元神</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> hwd = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">Label15.Caption = <span class="string">"游戏未启动"</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">Label15.Caption = <span class="string">"游戏启动成功"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Unload(Cancel <span class="keyword">As</span> <span class="built_in">Integer</span>) <span class="comment">'退出 恢复</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4555473</span>, <span class="number">-2033774220</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4329880</span>, <span class="number">1155093371</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4215305</span>, <span class="number">232311257</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4216567</span>, <span class="number">1317602165</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4593432</span>, <span class="number">-125600140</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"></span><br><span class="line">CloseHandle hProcess</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'---------------启动代码------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command1_Click() <span class="comment">'OPEN</span></span><br><span class="line">CommonDialog1.ShowOpen</span><br><span class="line">Text1.<span class="keyword">Text</span> = CommonDialog1.FileName</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command2_Click()</span><br><span class="line"><span class="keyword">If</span> InStr(<span class="number">1</span>, Text1.<span class="keyword">Text</span>, <span class="string">"elementclient"</span>) &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span> <span class="comment">'目录比较</span></span><br><span class="line">RPath = CommonDialog1.FileName</span><br><span class="line">Shell RPath &amp; <span class="string">" game:cpw"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">MsgBox <span class="string">"请选择路径！"</span>, vbInformation <span class="comment">'错误后，窗口信息弹出</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command3_Click() <span class="comment">'SET</span></span><br><span class="line">Shell <span class="string">"notepad.exe set.ini"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command4_Click() <span class="comment">'HELP</span></span><br><span class="line">Shell <span class="string">"notepad.exe help.ini"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check1_Click() <span class="comment">'隐藏游戏窗口</span></span><br><span class="line"><span class="keyword">If</span> Check1.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">i = ShowWindow(hwd, SW_HIDE)</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">i = ShowWindow(hwd, SW_SHOW)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check2_Click() <span class="comment">'隐藏辅助窗口</span></span><br><span class="line"><span class="keyword">If</span> Check2.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">cSysTray1.InTray = <span class="literal">True</span> <span class="comment">'隐藏到任务栏</span></span><br><span class="line"><span class="keyword">Me</span>.Visible = <span class="literal">False</span> <span class="comment">'让程序界面不可见</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> CsysTray1_MouseDown(Button <span class="keyword">As</span> <span class="built_in">Integer</span>, Id <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="keyword">Me</span>.WindowState = <span class="number">0</span> <span class="comment">'程序回复到 Normal 状态</span></span><br><span class="line"><span class="keyword">Me</span>.Visible = <span class="literal">True</span> <span class="comment">'从任务栏中清除图标</span></span><br><span class="line">cSysTray1.InTray = <span class="literal">False</span> <span class="comment">'令程序界面可见</span></span><br><span class="line">Check2.Value = <span class="number">0</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Timer2_Timer()</span><br><span class="line">Label14.Caption = StrConv(mz, vbFromUnicode)</span><br><span class="line">Label2.Caption = hp &amp; <span class="string">"/"</span> &amp; hpmax</span><br><span class="line">Label4.Caption = mp &amp; <span class="string">"/"</span> &amp; mpmax</span><br><span class="line">Label6.Caption = yuanshen</span><br><span class="line">Label10.Caption = dengji</span><br><span class="line">Label11.Caption = money</span><br><span class="line">Label20.Caption = exp</span><br><span class="line">Label21.Caption = xiuzhen</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'--------------工具代码------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span>'多开----------------------------</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command5_Click()</span><br><span class="line">TimesNow = Now()</span><br><span class="line">SetWindowText hwd, <span class="string">"YY 完美"</span> &amp; TimesNow</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span>'自动加点------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span>彩色发言-------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span><span class="doctag">'''</span>自动喊世界------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'------------------挂机代码------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Command6_Click()</span><br><span class="line">Form2.Show</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'------------------技能代码------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'------------------BT 代码--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check3_Click() <span class="comment">'飞天</span></span><br><span class="line"><span class="keyword">If</span> Check3.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4555473</span>, <span class="number">-2033774217</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4555473</span>, <span class="number">-2033774220</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check4_Click() <span class="comment">'穿墙</span></span><br><span class="line"><span class="keyword">If</span> Check4.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4215305</span>, <span class="number">232311258</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4215305</span>, <span class="number">232311257</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check5_Click() <span class="comment">'隐藏</span></span><br><span class="line"><span class="keyword">If</span> Check5.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4329880</span>, <span class="number">1155093483</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4329880</span>, <span class="number">1155093371</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check6_Click() <span class="comment">'无限视野</span></span><br><span class="line"><span class="keyword">If</span> Check6.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4216567</span>, <span class="number">1317602166</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4216567</span>, <span class="number">1317602165</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check7_Click() <span class="comment">'空中漫步</span></span><br><span class="line"><span class="keyword">If</span> Check7.Value = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4593432</span>, <span class="number">-125600137</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">WriteProcessMemory hProcess, <span class="keyword">ByVal</span> <span class="number">4593432</span>, <span class="number">-125600140</span>, <span class="number">4</span>, <span class="number">0</span>&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Check8_Click() <span class="comment">'无限跳跃</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> check9_click() <span class="comment">'小号入仙魔</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'-------------------关于代码------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Label16_Click()</span><br><span class="line">url = <span class="string">"http://taosha126.ys168.com/"</span></span><br><span class="line">Shell <span class="string">"explorer "</span> &amp; url, <span class="number">0</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Label16_MouseMove(Button <span class="keyword">As</span> <span class="built_in">Integer</span>, Shift <span class="keyword">As</span> <span class="built_in">Integer</span>, X <span class="keyword">As</span> <span class="built_in">Single</span>, Y <span class="keyword">As</span> <span class="built_in">Single</span>)</span><br><span class="line">Label16.ForeColor = &amp;H0&amp;</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'-------------------菜单代码------------------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> 使用说明\_Click()</span><br><span class="line">Shell <span class="string">"notepad.exe help.ini"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> 退出\_Click()</span><br><span class="line">Unload Form1</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> 打开\_Click()</span><br><span class="line">CommonDialog1.ShowOpen</span><br><span class="line">Text1.<span class="keyword">Text</span> = CommonDialog1.FileName</span><br><span class="line"><span class="keyword">If</span> InStr(<span class="number">1</span>, Text1.<span class="keyword">Text</span>, <span class="string">"elementclient"</span>) &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span> <span class="comment">'目录比较</span></span><br><span class="line">RPath = CommonDialog1.FileName</span><br><span class="line">Shell RPath &amp; <span class="string">" game:cpw"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> 关于\_Click()</span><br><span class="line">frmAbout.Show</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> 配置\_Click()</span><br><span class="line">Shell <span class="string">"notepad.exe set.ini"</span>, vbNormalFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>vb</tag>
      </tags>
  </entry>
  <entry>
    <title>vb修改游戏常用模块</title>
    <url>/2011/04/06/110406-game-vbmodule/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>修改 PC 游戏内存参数常用的 API 函数</p>
<ul>
<li>FindWindow</li>
<li>FindWindowEx</li>
<li>GetWindowThreadProcessId</li>
<li>OpenProcess</li>
<li>CloseHandle</li>
<li>ReadProcessMemory</li>
<li>WriteProcessMemory</li>
<li>SendMessage</li>
<li>PostMessage</li>
<li>keybd_event</li>
<li>Sleep</li>
<li>GetPrivateProfileString</li>
<li>ShowWindow</li>
<li>SetForegroundWindow</li>
<li>mouse_event</li>
<li>SetWindowText</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="comment">'---------------声明函数-----------------------</span></span><br><span class="line"><span class="comment">'得到窗体句柄的函数,FindWindow函数用来返回符合指定的类名( ClassName )和窗口名( WindowTitle )的窗口句柄</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> FindWindow <span class="keyword">Lib</span> <span class="string">"user32"</span> <span class="keyword">Alias</span> <span class="string">"FindWindowA"</span> (<span class="keyword">ByVal</span> lpClassName <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> lpWindowName <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'得到窗体控件句柄的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> FindWindowEx <span class="keyword">Lib</span> <span class="string">"user32"</span> <span class="keyword">Alias</span> <span class="string">"FindWindowExA"</span> (<span class="keyword">ByVal</span> hWnd1 <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> hWnd2 <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpsz1 <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> lpsz2 <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'得到进程标识符的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> GetWindowThreadProcessId <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, lpdwProcessId <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'得到目标进程句柄的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> OpenProcess <span class="keyword">Lib</span> <span class="string">"kernel32"</span> (<span class="keyword">ByVal</span> dwDesiredAccess <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> bInheritHandle <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> dwProcessId <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'关闭句柄的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> CloseHandle <span class="keyword">Lib</span> <span class="string">"kernel32"</span> (<span class="keyword">ByVal</span> hObject <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'读取进程内存的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> ReadProcessMemory <span class="keyword">Lib</span> <span class="string">"kernel32.dll"</span> (<span class="keyword">ByVal</span> hProcess <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpBaseAddress <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByRef</span> lpBuffer <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> nSize <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByRef</span> lpNumberOfBytesWritten <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> WriteProcessMemory <span class="keyword">Lib</span> <span class="string">"kernel32"</span> (<span class="keyword">ByVal</span> hProcess <span class="keyword">As</span> <span class="built_in">Long</span>, lpBaseAddress <span class="keyword">As</span> Any, lpBuffer <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> nSize <span class="keyword">As</span> <span class="built_in">Long</span>, lpNumberOfBytesWritten <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'-----------发送信息的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> SendMessage <span class="keyword">Lib</span> <span class="string">"user32"</span> <span class="keyword">Alias</span> <span class="string">"SendMessageA"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> wMsg <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> wParam <span class="keyword">As</span> <span class="built_in">Long</span>, lParam <span class="keyword">As</span> Any) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> PostMessage <span class="keyword">Lib</span> <span class="string">"user32"</span> <span class="keyword">Alias</span> <span class="string">"PostMessageA"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> wMsg <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> wParam <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lParam <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="keyword">Declare</span> <span class="keyword">Sub</span> keybd_event <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> bVk <span class="keyword">As</span> <span class="built_in">Byte</span>, <span class="keyword">ByVal</span> bScan <span class="keyword">As</span> <span class="built_in">Byte</span>, <span class="keyword">ByVal</span> dwFlags <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> dwExtraInfo <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="comment">'延迟函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Sub</span> Sleep <span class="keyword">Lib</span> <span class="string">"kernel32"</span> (<span class="keyword">ByVal</span> dwMilliseconds <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="comment">'读取配置文件的函数</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> GetPrivateProfileString <span class="keyword">Lib</span> <span class="string">"kernel32"</span> <span class="keyword">Alias</span> <span class="string">"GetPrivateProfileStringA"</span> (<span class="keyword">ByVal</span> lpApplicationName <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> lpKeyName <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> lpDefault <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> lpReturnedString <span class="keyword">As</span> <span class="built_in">String</span>, <span class="keyword">ByVal</span> nSize <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpFileName <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'隐藏游戏窗口用</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> ShowWindow <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> nCmdShow <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="comment">'将窗口设为系统的前台窗口。这个函数可用于改变用户目前正在操作的应用程序</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> SetForegroundWindow <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"><span class="comment">'模拟一次鼠标事件</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Sub</span> mouse_event <span class="keyword">Lib</span> <span class="string">"user32"</span> (<span class="keyword">ByVal</span> dwFlags <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> dx <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> dy <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> cButtons <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> dwExtraInfo <span class="keyword">As</span> <span class="built_in">Long</span>)</span><br><span class="line"><span class="comment">'设置窗口的标题文字或控件的内容</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Declare</span> <span class="keyword">Function</span> SetWindowText <span class="keyword">Lib</span> <span class="string">"user32"</span> <span class="keyword">Alias</span> <span class="string">"SetWindowTextA"</span> (<span class="keyword">ByVal</span> hwnd <span class="keyword">As</span> <span class="built_in">Long</span>, <span class="keyword">ByVal</span> lpString <span class="keyword">As</span> <span class="built_in">String</span>) <span class="keyword">As</span> <span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Const</span> PROCESS_ALL_ACCESS = &amp;H1F0FFF</span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Const</span> SW_HIDE = <span class="number">0</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Const</span> SW_SHOW = <span class="number">5</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Const</span> SW_SHOWDEFAULT = <span class="number">10</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>vb</tag>
      </tags>
  </entry>
  <entry>
    <title>LabVIEW算法-数组的90°旋转</title>
    <url>/2011/01/25/110125-labview-Array90/</url>
    <content><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>二维数组的选择-90 度逆时针旋转</p>
<h1 id="LabVIEW-实现"><a href="#LabVIEW-实现" class="headerlink" title="LabVIEW 实现"></a>LabVIEW 实现</h1><p><img src="/attach/array90.png" alt="LabVIEW-Array90"></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>LabVIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>E附件(failed to load kernel library)</title>
    <url>/2010/01/14/100114-Efile/</url>
    <content><![CDATA[<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p><img src="/attach/Efile-error.jpg" alt="E 附件"></p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>出现这种情况的，绝大多数是由于该程序大概是用 E 语言编写的<br>方法: 1.删除 C:\Documents and Settings\Administrator\Local Settings\Temp 中的 E_4 即可 2.你把 E 语言安装了看看,哪个附件就有了!!!</p>
<h1 id="附件使用"><a href="#附件使用" class="headerlink" title="附件使用"></a>附件使用</h1><p>对于附件的使用，把附件的文件放到你要使用的程序文件夹中即可了！<br>安装了易语言的话，就不需要 E 附件了，它里面含有所有 E 语言类程序运行所需要的基本库！</p>
<h1 id="附件地址"><a href="#附件地址" class="headerlink" title="附件地址"></a>附件地址</h1><p><a href="http://taosha126.ys168.com/" target="_blank" rel="noopener">附件下载</a></p>
]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>E</tag>
      </tags>
  </entry>
  <entry>
    <title>BAT-IP</title>
    <url>/2010/01/13/100113-BAT-IP/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>双网卡网络接入，切换 IP</p>
<p>其中：netsh int ip set add 解释：</p>
<table>
<thead>
<tr>
<th>接口名称</th>
<th>自动或静态</th>
<th>IP 地址</th>
<th>子网掩码</th>
<th>网关</th>
<th>接口跃点数</th>
</tr>
</thead>
<tbody><tr>
<td>本地连接</td>
<td>static/dhcp</td>
<td>192.168.5.10</td>
<td>255.255.255.0</td>
<td>192.168.0.1</td>
<td>0</td>
</tr>
</tbody></table>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">COLOR</span> <span class="number">0</span>A</span><br><span class="line"><span class="built_in">echo</span> 电信/校内互换！</span><br><span class="line">:<span class="built_in">start</span></span><br><span class="line"><span class="built_in">echo</span> <span class="number">1</span>.电信网</span><br><span class="line"><span class="built_in">echo</span> <span class="number">2</span>.校内网</span><br><span class="line"><span class="built_in">echo</span> <span class="number">3</span>.退出</span><br><span class="line"><span class="built_in">echo</span> 请输入选择，并回车！:</span><br><span class="line"><span class="built_in">set</span> /p UserChoice=</span><br><span class="line"><span class="keyword">if</span> "<span class="variable">%UserChoice%</span>"=="<span class="number">1</span>" <span class="keyword">goto</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> "<span class="variable">%UserChoice%</span>"=="<span class="number">2</span>" <span class="keyword">goto</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> "<span class="variable">%UserChoice%</span>"=="<span class="number">3</span>" <span class="keyword">goto</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">echo</span> 请选择你所需要的网络!</span><br><span class="line"><span class="keyword">goto</span> <span class="built_in">start</span></span><br><span class="line">:<span class="number">1</span></span><br><span class="line"><span class="built_in">echo</span> 你选择了电信网!</span><br><span class="line"><span class="built_in">echo</span> 正在设置ip,子网,DNS,请稍候......</span><br><span class="line">netsh int ip <span class="built_in">set</span> add name="本地连接" dhcp</span><br><span class="line">netsh int ip <span class="built_in">set</span> dns name="本地连接" dhcp</span><br><span class="line"><span class="built_in">echo</span> 设置完毕!</span><br><span class="line"><span class="keyword">goto</span> <span class="number">3</span></span><br><span class="line">:<span class="number">2</span></span><br><span class="line"><span class="built_in">echo</span> 你选择了校内网！</span><br><span class="line"><span class="built_in">echo</span> 正在设置ip,子网,DNS,请稍候......</span><br><span class="line">netsh int ip <span class="built_in">set</span> add name="本地连接" static <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">15</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span> <span class="number">0</span></span><br><span class="line">netsh int ip <span class="built_in">set</span> dns name="本地连接" static <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">2</span></span><br><span class="line"><span class="built_in">echo</span> 设置完毕!</span><br><span class="line"><span class="built_in">echo</span> 正在调用校内客户端......</span><br><span class="line"><span class="built_in">start</span> "" "C:\Program Files\Edu Supplicant\supplicant.exe"</span><br><span class="line"><span class="keyword">goto</span> <span class="number">3</span></span><br><span class="line">:<span class="number">3</span></span><br></pre></td></tr></table></figure>

<h1 id="DNS-切换"><a href="#DNS-切换" class="headerlink" title="DNS 切换"></a>DNS 切换</h1><p>对于 DNS 的备用的使用见下面：</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> 正在设置 ip,子网,DNS,请稍候......</span><br><span class="line">netsh int ip <span class="built_in">set</span> add name="本地连接" static <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">15</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span> <span class="number">0</span></span><br><span class="line">netsh int ip <span class="built_in">set</span> dns name="本地连接" source=static <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">2</span></span><br><span class="line">netsh int ip add dns name="本地连接" <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">3</span> index=<span class="number">2</span> 此为备用 DNS 的设置！</span><br><span class="line"><span class="built_in">echo</span> 设置完毕!</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>bat</tag>
      </tags>
  </entry>
</search>
